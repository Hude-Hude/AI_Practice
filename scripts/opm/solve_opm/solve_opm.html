<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.26">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Solving a Static Oligopoly Pricing Model</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="solve_opm_files/libs/clipboard/clipboard.min.js"></script>
<script src="solve_opm_files/libs/quarto-html/quarto.js" type="module"></script>
<script src="solve_opm_files/libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="solve_opm_files/libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="solve_opm_files/libs/quarto-html/popper.min.js"></script>
<script src="solve_opm_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="solve_opm_files/libs/quarto-html/anchor.min.js"></script>
<link href="solve_opm_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="solve_opm_files/libs/quarto-html/quarto-syntax-highlighting-587c61ba64f3a5504c4d52d930310e48.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="solve_opm_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="solve_opm_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="solve_opm_files/libs/bootstrap/bootstrap-d6a003b94517c951b2d65075d42fb01b.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="quarto-light">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#instruction" id="toc-instruction" class="nav-link active" data-scroll-target="#instruction">Instruction</a></li>
  <li><a href="#model-setup" id="toc-model-setup" class="nav-link" data-scroll-target="#model-setup">Model Setup</a>
  <ul class="collapse">
  <li><a href="#demand-logit-model" id="toc-demand-logit-model" class="nav-link" data-scroll-target="#demand-logit-model">Demand: Logit Model</a></li>
  <li><a href="#market-shares" id="toc-market-shares" class="nav-link" data-scroll-target="#market-shares">Market Shares</a></li>
  <li><a href="#cost-structure" id="toc-cost-structure" class="nav-link" data-scroll-target="#cost-structure">Cost Structure</a></li>
  </ul></li>
  <li><a href="#equilibrium-conditions" id="toc-equilibrium-conditions" class="nav-link" data-scroll-target="#equilibrium-conditions">Equilibrium Conditions</a>
  <ul class="collapse">
  <li><a href="#bertrand-nash-equilibrium" id="toc-bertrand-nash-equilibrium" class="nav-link" data-scroll-target="#bertrand-nash-equilibrium">Bertrand-Nash Equilibrium</a></li>
  <li><a href="#first-order-conditions" id="toc-first-order-conditions" class="nav-link" data-scroll-target="#first-order-conditions">First-Order Conditions</a></li>
  <li><a href="#logit-share-derivatives" id="toc-logit-share-derivatives" class="nav-link" data-scroll-target="#logit-share-derivatives">Logit Share Derivatives</a></li>
  <li><a href="#matrix-formulation" id="toc-matrix-formulation" class="nav-link" data-scroll-target="#matrix-formulation">Matrix Formulation</a></li>
  <li><a href="#markup-equation" id="toc-markup-equation" class="nav-link" data-scroll-target="#markup-equation">Markup Equation</a></li>
  </ul></li>
  <li><a href="#analytical-benchmarks" id="toc-analytical-benchmarks" class="nav-link" data-scroll-target="#analytical-benchmarks">Analytical Benchmarks</a>
  <ul class="collapse">
  <li><a href="#single-product-firms" id="toc-single-product-firms" class="nav-link" data-scroll-target="#single-product-firms">Single-Product Firms</a></li>
  <li><a href="#symmetric-equilibrium" id="toc-symmetric-equilibrium" class="nav-link" data-scroll-target="#symmetric-equilibrium">Symmetric Equilibrium</a></li>
  <li><a href="#comparative-statics" id="toc-comparative-statics" class="nav-link" data-scroll-target="#comparative-statics">Comparative Statics</a></li>
  <li><a href="#cost-pass-through" id="toc-cost-pass-through" class="nav-link" data-scroll-target="#cost-pass-through">Cost Pass-Through</a></li>
  <li><a href="#product-differentiation-scenarios" id="toc-product-differentiation-scenarios" class="nav-link" data-scroll-target="#product-differentiation-scenarios">Product Differentiation Scenarios</a></li>
  </ul></li>
  <li><a href="#solution-method" id="toc-solution-method" class="nav-link" data-scroll-target="#solution-method">Solution Method</a>
  <ul class="collapse">
  <li><a href="#fixed-point-iteration-on-markups" id="toc-fixed-point-iteration-on-markups" class="nav-link" data-scroll-target="#fixed-point-iteration-on-markups">Fixed-Point Iteration on Markups</a></li>
  <li><a href="#damped-iteration" id="toc-damped-iteration" class="nav-link" data-scroll-target="#damped-iteration">Damped Iteration</a></li>
  <li><a href="#convergence-criterion" id="toc-convergence-criterion" class="nav-link" data-scroll-target="#convergence-criterion">Convergence Criterion</a></li>
  <li><a href="#type-definitions" id="toc-type-definitions" class="nav-link" data-scroll-target="#type-definitions">Type Definitions</a></li>
  <li><a href="#algorithm" id="toc-algorithm" class="nav-link" data-scroll-target="#algorithm">Algorithm</a></li>
  <li><a href="#subroutines" id="toc-subroutines" class="nav-link" data-scroll-target="#subroutines">Subroutines</a></li>
  <li><a href="#convergence-properties" id="toc-convergence-properties" class="nav-link" data-scroll-target="#convergence-properties">Convergence Properties</a></li>
  <li><a href="#verification-plan" id="toc-verification-plan" class="nav-link" data-scroll-target="#verification-plan">Verification Plan</a></li>
  </ul></li>
  <li><a href="#implementation" id="toc-implementation" class="nav-link" data-scroll-target="#implementation">Implementation</a>
  <ul class="collapse">
  <li><a href="#setup" id="toc-setup" class="nav-link" data-scroll-target="#setup">Setup</a></li>
  <li><a href="#model-parameters" id="toc-model-parameters" class="nav-link" data-scroll-target="#model-parameters">Model Parameters</a></li>
  <li><a href="#solve-equilibrium" id="toc-solve-equilibrium" class="nav-link" data-scroll-target="#solve-equilibrium">Solve Equilibrium</a></li>
  <li><a href="#verify-against-analytical-benchmark" id="toc-verify-against-analytical-benchmark" class="nav-link" data-scroll-target="#verify-against-analytical-benchmark">Verify Against Analytical Benchmark</a></li>
  </ul></li>
  <li><a href="#results" id="toc-results" class="nav-link" data-scroll-target="#results">Results</a></li>
  <li><a href="#comparative-statics-1" id="toc-comparative-statics-1" class="nav-link" data-scroll-target="#comparative-statics-1">Comparative Statics</a>
  <ul class="collapse">
  <li><a href="#scenario-1-symmetrichomogeneous-products-baseline-1" id="toc-scenario-1-symmetrichomogeneous-products-baseline-1" class="nav-link" data-scroll-target="#scenario-1-symmetrichomogeneous-products-baseline-1">Scenario 1: Symmetric/Homogeneous Products (Baseline)</a></li>
  <li><a href="#scenario-2-quality-differentiation-only-1" id="toc-scenario-2-quality-differentiation-only-1" class="nav-link" data-scroll-target="#scenario-2-quality-differentiation-only-1">Scenario 2: Quality Differentiation Only</a></li>
  <li><a href="#scenario-3-cost-differentiation-only-1" id="toc-scenario-3-cost-differentiation-only-1" class="nav-link" data-scroll-target="#scenario-3-cost-differentiation-only-1">Scenario 3: Cost Differentiation Only</a></li>
  <li><a href="#scenario-4-vertical-differentiation" id="toc-scenario-4-vertical-differentiation" class="nav-link" data-scroll-target="#scenario-4-vertical-differentiation">Scenario 4: Vertical Differentiation</a></li>
  <li><a href="#scenario-5-general-heterogeneous-products-1" id="toc-scenario-5-general-heterogeneous-products-1" class="nav-link" data-scroll-target="#scenario-5-general-heterogeneous-products-1">Scenario 5: General Heterogeneous Products</a></li>
  </ul></li>
  <li><a href="#diagnosis-evaluation-against-io-theory" id="toc-diagnosis-evaluation-against-io-theory" class="nav-link" data-scroll-target="#diagnosis-evaluation-against-io-theory">Diagnosis: Evaluation Against IO Theory</a></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion">Conclusion</a></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Solving a Static Oligopoly Pricing Model</h1>
<p class="subtitle lead">Bertrand Competition with Differentiated Products</p>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="instruction" class="level2">
<h2 class="anchored" data-anchor-id="instruction">Instruction</h2>
<p><strong>Goal</strong>: Replicate the structure of <code>scripts/solve_mdp/solve_mdp.qmd</code>, but replace the Markov Decision Process with a <strong>static oligopoly pricing model</strong> in which multiple firms set prices simultaneously to maximize period profits. The objective is to design and document a solver that:</p>
<ul>
<li>Specifies firm demand (e.g., logit demand with market share as a function of own price and rivals’ prices)</li>
<li>Defines marginal costs and strategic interaction assumptions (Bertrand competition with differentiated products)</li>
<li>Derives the Nash equilibrium first-order conditions for optimal prices</li>
<li>Implements a numerical fixed-point or contraction mapping routine that solves for equilibrium prices and markups under the chosen demand system</li>
</ul>
<p><strong>Required Components</strong>:</p>
<ol type="1">
<li><strong>Model primitives</strong>: Demand parameters, cost structure, number of firms/products, and any demand and cost shifters.</li>
<li><strong>Equilibrium algorithm</strong>: Specify how to numerically solve the nonlinear system of first-order conditions (FOCs) characterizing the static Nash equilibrium in prices.</li>
<li><strong>Verification plan</strong>: Outline how juniors should validate convergence (e.g., norm of FOC residuals, comparison to analytical benchmarks in symmetric cases).</li>
<li><strong>Documentation</strong>: Describe expected figures/tables (e.g., comparative statics over demand elasticities, passthrough analyses) without implementing them.</li>
</ol>
<p><strong>Deliverable</strong>: An executable Quarto report and rendered html report that mirrors the MDP solver report while focusing entirely on the static oligopoly pricing equilibrium problem.</p>
<hr>
</section>
<section id="model-setup" class="level2">
<h2 class="anchored" data-anchor-id="model-setup">Model Setup</h2>
<p>We consider a static oligopoly pricing model with:</p>
<ul>
<li><strong>Products</strong>: <span class="math inline">\(J\)</span> differentiated products indexed by <span class="math inline">\(j = 1, \ldots, J\)</span>, plus an outside option <span class="math inline">\(j = 0\)</span></li>
<li><strong>Firms</strong>: <span class="math inline">\(F\)</span> firms, where firm <span class="math inline">\(f\)</span> owns a subset of products <span class="math inline">\(\mathcal{J}_f \subseteq \{1, \ldots, J\}\)</span></li>
<li><strong>Market size</strong>: Normalized to <span class="math inline">\(M = 1\)</span> (equilibrium prices are independent of market size)</li>
<li><strong>Competition</strong>: Bertrand (simultaneous price setting)</li>
</ul>
<section id="demand-logit-model" class="level3">
<h3 class="anchored" data-anchor-id="demand-logit-model">Demand: Logit Model</h3>
<p>Consumer <span class="math inline">\(i\)</span>’s indirect utility from product <span class="math inline">\(j\)</span> is: <span class="math display">\[
u_{ij} = \delta_j - \alpha p_j + \varepsilon_{ij}
\]</span></p>
<p>where:</p>
<ul>
<li><span class="math inline">\(\delta_j\)</span> = mean utility of product <span class="math inline">\(j\)</span> (captures quality, characteristics)</li>
<li><span class="math inline">\(\alpha &gt; 0\)</span> = price sensitivity coefficient</li>
<li><span class="math inline">\(p_j\)</span> = price of product <span class="math inline">\(j\)</span></li>
<li><span class="math inline">\(\varepsilon_{ij} \sim\)</span> Type-I Extreme Value (iid across consumers and products)</li>
</ul>
<p>The outside option provides utility <span class="math inline">\(u_{i0} = \varepsilon_{i0}\)</span> (normalized to zero mean utility).</p>
</section>
<section id="market-shares" class="level3">
<h3 class="anchored" data-anchor-id="market-shares">Market Shares</h3>
<p>Under the logit assumption, the market share of product <span class="math inline">\(j\)</span> is: <span class="math display">\[
s_j(p) = \frac{\exp(\delta_j - \alpha p_j)}{1 + \sum_{k=1}^{J} \exp(\delta_k - \alpha p_k)}
\]</span></p>
<p>The outside option share is: <span class="math display">\[
s_0(p) = \frac{1}{1 + \sum_{k=1}^{J} \exp(\delta_k - \alpha p_k)}
\]</span></p>
</section>
<section id="cost-structure" class="level3">
<h3 class="anchored" data-anchor-id="cost-structure">Cost Structure</h3>
<p>Each product <span class="math inline">\(j\)</span> has constant marginal cost <span class="math inline">\(c_j\)</span>. Firm <span class="math inline">\(f\)</span>’s profit is: <span class="math display">\[
\pi_f(p) = \sum_{j \in \mathcal{J}_f} (p_j - c_j) \cdot s_j(p)
\]</span></p>
</section>
</section>
<section id="equilibrium-conditions" class="level2">
<h2 class="anchored" data-anchor-id="equilibrium-conditions">Equilibrium Conditions</h2>
<section id="bertrand-nash-equilibrium" class="level3">
<h3 class="anchored" data-anchor-id="bertrand-nash-equilibrium">Bertrand-Nash Equilibrium</h3>
<p>In a Bertrand-Nash equilibrium, each firm <span class="math inline">\(f\)</span> chooses prices for its products to maximize profit, taking rivals’ prices as given: <span class="math display">\[
\max_{\{p_j\}_{j \in \mathcal{J}_f}} \sum_{j \in \mathcal{J}_f} (p_j - c_j) \cdot s_j(p)
\]</span></p>
</section>
<section id="first-order-conditions" class="level3">
<h3 class="anchored" data-anchor-id="first-order-conditions">First-Order Conditions</h3>
<p>The FOC for product <span class="math inline">\(j\)</span> owned by firm <span class="math inline">\(f\)</span> is: <span class="math display">\[
\frac{\partial \pi_f}{\partial p_j} = s_j + \sum_{k \in \mathcal{J}_f} (p_k - c_k) \cdot \frac{\partial s_k}{\partial p_j} = 0
\]</span></p>
</section>
<section id="logit-share-derivatives" class="level3">
<h3 class="anchored" data-anchor-id="logit-share-derivatives">Logit Share Derivatives</h3>
<p>For the logit model, the share derivatives have closed-form expressions:</p>
<p><strong>Own-price effect</strong> (negative): <span class="math display">\[
\frac{\partial s_j}{\partial p_j} = -\alpha s_j (1 - s_j)
\]</span></p>
<p><strong>Cross-price effect</strong> (positive, for <span class="math inline">\(k \neq j\)</span>): <span class="math display">\[
\frac{\partial s_k}{\partial p_j} = \alpha s_k s_j
\]</span></p>
</section>
<section id="matrix-formulation" class="level3">
<h3 class="anchored" data-anchor-id="matrix-formulation">Matrix Formulation</h3>
<p>Define the following matrices:</p>
<ul>
<li><strong>Ownership matrix</strong> <span class="math inline">\(\Omega\)</span>: <span class="math inline">\(\Omega_{jk} = 1\)</span> if products <span class="math inline">\(j\)</span> and <span class="math inline">\(k\)</span> are owned by the same firm, <span class="math inline">\(0\)</span> otherwise</li>
<li><strong>Share derivative matrix</strong> <span class="math inline">\(\Delta\)</span>: <span class="math inline">\(\Delta_{jk} = -\frac{\partial s_j}{\partial p_k}\)</span></li>
</ul>
<p>For logit demand: <span class="math display">\[
\Delta_{jk} = \begin{cases}
\alpha s_j (1 - s_j) &amp; \text{if } j = k \\
-\alpha s_j s_k &amp; \text{if } j \neq k
\end{cases}
\]</span></p>
</section>
<section id="markup-equation" class="level3">
<h3 class="anchored" data-anchor-id="markup-equation">Markup Equation</h3>
<p>The system of FOCs can be written compactly as: <span class="math display">\[
s - (\Omega \odot \Delta)(p - c) = 0
\]</span></p>
<p>where <span class="math inline">\(\odot\)</span> denotes element-wise (Hadamard) product.</p>
<p>Solving for the equilibrium markup: <span class="math display">\[
p - c = (\Omega \odot \Delta)^{-1} s
\]</span></p>
<p>This is the <strong>markup equation</strong>: equilibrium prices equal marginal cost plus a markup that depends on:</p>
<ol type="1">
<li><strong>Market shares</strong> <span class="math inline">\(s\)</span> — higher shares imply more market power</li>
<li><strong>Price sensitivity</strong> <span class="math inline">\(\alpha\)</span> — higher sensitivity reduces markups</li>
<li><strong>Ownership structure</strong> <span class="math inline">\(\Omega\)</span> — multi-product firms internalize cannibalization</li>
</ol>
</section>
</section>
<section id="analytical-benchmarks" class="level2">
<h2 class="anchored" data-anchor-id="analytical-benchmarks">Analytical Benchmarks</h2>
<section id="single-product-firms" class="level3">
<h3 class="anchored" data-anchor-id="single-product-firms">Single-Product Firms</h3>
<p>When each firm owns exactly one product (<span class="math inline">\(\Omega = I\)</span>), the FOC for product <span class="math inline">\(j\)</span> simplifies to: <span class="math display">\[
s_j - \alpha s_j (1 - s_j) \eta_j = 0
\]</span></p>
<p>Solving for the markup: <span class="math display">\[
\eta_j = \frac{1}{\alpha (1 - s_j)}
\]</span></p>
<p><strong>Interpretation</strong>: Markup is inversely proportional to:</p>
<ul>
<li>Price sensitivity <span class="math inline">\(\alpha\)</span></li>
<li>“Competitive pressure” <span class="math inline">\((1 - s_j)\)</span> = probability of losing customer to other products</li>
</ul>
</section>
<section id="symmetric-equilibrium" class="level3">
<h3 class="anchored" data-anchor-id="symmetric-equilibrium">Symmetric Equilibrium</h3>
<p>For identical products (<span class="math inline">\(\delta_j = \delta\)</span>, <span class="math inline">\(c_j = c\)</span> for all <span class="math inline">\(j\)</span>) with single-product firms, the symmetric equilibrium has <span class="math inline">\(s_j = s\)</span> for all <span class="math inline">\(j\)</span>: <span class="math display">\[
s = \frac{\exp(\delta - \alpha p)}{1 + J \exp(\delta - \alpha p)}
\]</span></p>
<p>With markup <span class="math inline">\(\eta = \frac{1}{\alpha(1-s)}\)</span>.</p>
<p>As <span class="math inline">\(J \to \infty\)</span>: <span class="math inline">\(s \to 0\)</span>, so <span class="math inline">\(\eta \to \frac{1}{\alpha}\)</span> (competitive limit).</p>
</section>
<section id="comparative-statics" class="level3">
<h3 class="anchored" data-anchor-id="comparative-statics">Comparative Statics</h3>
<table class="caption-top table">
<colgroup>
<col style="width: 14%">
<col style="width: 10%">
<col style="width: 32%">
<col style="width: 27%">
<col style="width: 14%">
</colgroup>
<thead>
<tr class="header">
<th>Parameter</th>
<th>Change</th>
<th>Effect on Markup <span class="math inline">\(\eta\)</span></th>
<th>Effect on Price <span class="math inline">\(p\)</span></th>
<th>Intuition</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><span class="math inline">\(\alpha\)</span> ↑</td>
<td>More price sensitive</td>
<td><span class="math inline">\(\eta\)</span> ↓</td>
<td><span class="math inline">\(p\)</span> ↓</td>
<td>Elastic demand → less market power</td>
</tr>
<tr class="even">
<td><span class="math inline">\(\delta_j\)</span> ↑</td>
<td>Higher quality</td>
<td><span class="math inline">\(\eta_j\)</span> ↑</td>
<td><span class="math inline">\(p_j\)</span> ↑</td>
<td>Higher <span class="math inline">\(s_j\)</span> → more inelastic residual demand</td>
</tr>
<tr class="odd">
<td><span class="math inline">\(c_j\)</span> ↑</td>
<td>Higher cost</td>
<td>—</td>
<td><span class="math inline">\(p_j\)</span> ↑</td>
<td>Cost pass-through</td>
</tr>
<tr class="even">
<td><span class="math inline">\(J\)</span> ↑</td>
<td>More competitors</td>
<td><span class="math inline">\(\eta\)</span> ↓</td>
<td><span class="math inline">\(p\)</span> ↓</td>
<td>Lower shares → more competition</td>
</tr>
<tr class="odd">
<td>Merger</td>
<td><span class="math inline">\(\Omega_{jk}: 0 \to 1\)</span></td>
<td><span class="math inline">\(\eta_j, \eta_k\)</span> ↑</td>
<td><span class="math inline">\(p_j, p_k\)</span> ↑</td>
<td>Internalize cannibalization</td>
</tr>
</tbody>
</table>
</section>
<section id="cost-pass-through" class="level3">
<h3 class="anchored" data-anchor-id="cost-pass-through">Cost Pass-Through</h3>
<p>For single-product firms with logit demand, the pass-through rate measures how much of a cost increase is passed to consumers: <span class="math display">\[
\rho_j = \frac{\partial p_j}{\partial c_j}
\]</span></p>
<p>Differentiating the equilibrium condition yields: <span class="math display">\[
\rho_j = \frac{1}{1 + \alpha s_j \eta_j}
\]</span></p>
<p>Substituting <span class="math inline">\(\eta_j = \frac{1}{\alpha(1-s_j)}\)</span>: <span class="math display">\[
\rho_j = \frac{1}{1 + \frac{s_j}{1-s_j}} = 1 - s_j
\]</span></p>
<p><strong>Result</strong>: Pass-through <span class="math inline">\(\rho_j = 1 - s_j &lt; 1\)</span>.</p>
<p><strong>Interpretation</strong>:</p>
<ul>
<li>Firms with <strong>higher market share</strong> absorb more of cost increases (<span class="math inline">\(\rho_j\)</span> lower)</li>
<li>Firms with <strong>lower market share</strong> pass through more to consumers (<span class="math inline">\(\rho_j\)</span> closer to 1)</li>
<li>In the competitive limit (<span class="math inline">\(s_j \to 0\)</span>): <span class="math inline">\(\rho_j \to 1\)</span> (full pass-through)</li>
</ul>
</section>
<section id="product-differentiation-scenarios" class="level3">
<h3 class="anchored" data-anchor-id="product-differentiation-scenarios">Product Differentiation Scenarios</h3>
<p>Products can be differentiated through the <strong>demand side</strong> (quality <span class="math inline">\(\delta\)</span>) and/or <strong>supply side</strong> (cost <span class="math inline">\(c\)</span>). Below we analyze different scenarios:</p>
<section id="scenario-1-symmetrichomogeneous-products-baseline" class="level4">
<h4 class="anchored" data-anchor-id="scenario-1-symmetrichomogeneous-products-baseline">Scenario 1: Symmetric/Homogeneous Products (Baseline)</h4>
<p><strong>Setup</strong>: <span class="math inline">\(\delta_j = \delta\)</span> and <span class="math inline">\(c_j = c\)</span> for all <span class="math inline">\(j\)</span></p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Parameter</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Mean utility</td>
<td><span class="math inline">\(\delta_j = \delta\)</span> (identical)</td>
</tr>
<tr class="even">
<td>Marginal cost</td>
<td><span class="math inline">\(c_j = c\)</span> (identical)</td>
</tr>
</tbody>
</table>
<p><strong>Equilibrium Properties</strong>:</p>
<ul>
<li>All products have equal shares: <span class="math inline">\(s_j = s = \frac{e^{\delta - \alpha p}}{1 + J e^{\delta - \alpha p}}\)</span></li>
<li>All products have equal markups: <span class="math inline">\(\eta_j = \eta = \frac{1}{\alpha(1-s)}\)</span></li>
<li>All products have equal prices: <span class="math inline">\(p_j = p = c + \eta\)</span></li>
</ul>
<p><strong>Use case</strong>: Theoretical benchmarks, isolating effects of <span class="math inline">\(\alpha\)</span>, <span class="math inline">\(J\)</span>, or ownership changes.</p>
<hr>
</section>
<section id="scenario-2-quality-differentiation-only" class="level4">
<h4 class="anchored" data-anchor-id="scenario-2-quality-differentiation-only">Scenario 2: Quality Differentiation Only</h4>
<p><strong>Setup</strong>: <span class="math inline">\(\delta_j\)</span> varies, <span class="math inline">\(c_j = c\)</span> constant</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Parameter</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Mean utility</td>
<td><span class="math inline">\(\delta_1 &lt; \delta_2 &lt; \delta_3\)</span> (quality gradient)</td>
</tr>
<tr class="even">
<td>Marginal cost</td>
<td><span class="math inline">\(c_j = c\)</span> (identical)</td>
</tr>
</tbody>
</table>
<p><strong>Example</strong>: Digital goods, software products (zero marginal cost, quality varies)</p>
<p><strong>Equilibrium Properties</strong>:</p>
<ul>
<li>Higher quality → higher share: <span class="math inline">\(\delta_j &gt; \delta_k \Rightarrow s_j &gt; s_k\)</span></li>
<li>Higher share → higher markup: <span class="math inline">\(s_j &gt; s_k \Rightarrow \eta_j &gt; \eta_k\)</span></li>
<li>Higher quality → higher price: <span class="math inline">\(\delta_j &gt; \delta_k \Rightarrow p_j &gt; p_k\)</span></li>
</ul>
<p><strong>Key insight</strong>: Quality leaders charge higher prices despite identical costs because their higher market share gives them more market power.</p>
<hr>
</section>
<section id="scenario-3-cost-differentiation-only" class="level4">
<h4 class="anchored" data-anchor-id="scenario-3-cost-differentiation-only">Scenario 3: Cost Differentiation Only</h4>
<p><strong>Setup</strong>: <span class="math inline">\(\delta_j = \delta\)</span> constant, <span class="math inline">\(c_j\)</span> varies</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Parameter</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Mean utility</td>
<td><span class="math inline">\(\delta_j = \delta\)</span> (identical)</td>
</tr>
<tr class="even">
<td>Marginal cost</td>
<td><span class="math inline">\(c_1 &lt; c_2 &lt; c_3\)</span> (efficiency gradient)</td>
</tr>
</tbody>
</table>
<p><strong>Example</strong>: Commodity markets with heterogeneous production efficiency</p>
<p><strong>Equilibrium Properties</strong>:</p>
<ul>
<li>Lower cost → lower price: <span class="math inline">\(c_j &lt; c_k \Rightarrow p_j &lt; p_k\)</span></li>
<li>Lower price → higher share: <span class="math inline">\(p_j &lt; p_k \Rightarrow s_j &gt; s_k\)</span></li>
<li>Higher share → higher markup: <span class="math inline">\(s_j &gt; s_k \Rightarrow \eta_j &gt; \eta_k\)</span></li>
</ul>
<p><strong>Key insight</strong>: Cost-efficient firms gain market share, which increases their markup, partially offsetting the cost advantage in prices.</p>
<hr>
</section>
<section id="scenario-4-vertical-differentiation-quality-cost-correlation" class="level4">
<h4 class="anchored" data-anchor-id="scenario-4-vertical-differentiation-quality-cost-correlation">Scenario 4: Vertical Differentiation (Quality-Cost Correlation)</h4>
<p><strong>Setup</strong>: <span class="math inline">\(\delta_j\)</span> and <span class="math inline">\(c_j\)</span> positively correlated (higher quality costs more)</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Parameter</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Mean utility</td>
<td><span class="math inline">\(\delta_1 &lt; \delta_2 &lt; \delta_3\)</span></td>
</tr>
<tr class="even">
<td>Marginal cost</td>
<td><span class="math inline">\(c_1 &lt; c_2 &lt; c_3\)</span> (correlated with <span class="math inline">\(\delta\)</span>)</td>
</tr>
</tbody>
</table>
<p><strong>Example</strong>: Economy vs.&nbsp;premium cars, budget vs.&nbsp;luxury hotels</p>
<p><strong>Equilibrium Properties</strong>:</p>
<ul>
<li>Price ordering follows quality: <span class="math inline">\(p_1 &lt; p_2 &lt; p_3\)</span></li>
<li>Share ordering depends on <span class="math inline">\((\delta_j - \alpha p_j)\)</span>: quality advantage vs.&nbsp;price disadvantage</li>
<li>Markup ordering: generally <span class="math inline">\(\eta_1 &lt; \eta_2 &lt; \eta_3\)</span> if quality effect dominates</li>
</ul>
<p><strong>Key insight</strong>: Premium products charge higher prices due to both higher costs and higher markups. The price gap exceeds the cost gap.</p>
<hr>
</section>
<section id="scenario-5-general-heterogeneous-products" class="level4">
<h4 class="anchored" data-anchor-id="scenario-5-general-heterogeneous-products">Scenario 5: General Heterogeneous Products</h4>
<p><strong>Setup</strong>: <span class="math inline">\(\delta_j\)</span> and <span class="math inline">\(c_j\)</span> vary independently</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Parameter</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Mean utility</td>
<td><span class="math inline">\(\delta_j\)</span> varies (not ordered)</td>
</tr>
<tr class="even">
<td>Marginal cost</td>
<td><span class="math inline">\(c_j\)</span> varies (not correlated with <span class="math inline">\(\delta\)</span>)</td>
</tr>
</tbody>
</table>
<p><strong>Example</strong>: Diverse product markets with varied positioning</p>
<p><strong>Equilibrium Properties</strong>:</p>
<ul>
<li>No simple ordering of prices, shares, or markups</li>
<li>Products with high <span class="math inline">\(\delta\)</span> and low <span class="math inline">\(c\)</span> are “dominant” (high share, high profit)</li>
<li>Products with low <span class="math inline">\(\delta\)</span> and high <span class="math inline">\(c\)</span> may exit or have minimal share</li>
</ul>
<p><strong>Comparative statics</strong> in this scenario:</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Product Type</th>
<th><span class="math inline">\(\delta\)</span></th>
<th><span class="math inline">\(c\)</span></th>
<th>Share</th>
<th>Markup</th>
<th>Price</th>
<th>Profit</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Dominant</td>
<td>High</td>
<td>Low</td>
<td>High</td>
<td>High</td>
<td>Moderate</td>
<td>High</td>
</tr>
<tr class="even">
<td>Premium</td>
<td>High</td>
<td>High</td>
<td>Moderate</td>
<td>High</td>
<td>High</td>
<td>Moderate</td>
</tr>
<tr class="odd">
<td>Value</td>
<td>Low</td>
<td>Low</td>
<td>Moderate</td>
<td>Low</td>
<td>Low</td>
<td>Low</td>
</tr>
<tr class="even">
<td>Weak</td>
<td>Low</td>
<td>High</td>
<td>Low</td>
<td>Low</td>
<td>Moderate</td>
<td>Very Low</td>
</tr>
</tbody>
</table>
<hr>
</section>
<section id="summary-sources-of-product-asymmetry" class="level4">
<h4 class="anchored" data-anchor-id="summary-sources-of-product-asymmetry">Summary: Sources of Product Asymmetry</h4>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Scenario</th>
<th><span class="math inline">\(\delta\)</span></th>
<th><span class="math inline">\(c\)</span></th>
<th>Key Driver of Price Differences</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1. Symmetric</td>
<td>Same</td>
<td>Same</td>
<td>None (benchmark)</td>
</tr>
<tr class="even">
<td>2. Quality only</td>
<td>Varies</td>
<td>Same</td>
<td>Markup differences (demand side)</td>
</tr>
<tr class="odd">
<td>3. Cost only</td>
<td>Same</td>
<td>Varies</td>
<td>Cost differences (supply side)</td>
</tr>
<tr class="even">
<td>4. Vertical</td>
<td>Correlated</td>
<td>Correlated</td>
<td>Both (premium positioning)</td>
</tr>
<tr class="odd">
<td>5. General</td>
<td>Independent</td>
<td>Independent</td>
<td>Complex interactions</td>
</tr>
</tbody>
</table>
<p><strong>Implementation note</strong>: The current solver handles all scenarios—simply pass different <code>delta</code> and <code>costs</code> vectors. The comparative statics section below demonstrates Scenario 1 (symmetric baseline). Extended analysis with heterogeneous products is marked for future implementation.</p>
</section>
</section>
</section>
<section id="solution-method" class="level2">
<h2 class="anchored" data-anchor-id="solution-method">Solution Method</h2>
<section id="fixed-point-iteration-on-markups" class="level3">
<h3 class="anchored" data-anchor-id="fixed-point-iteration-on-markups">Fixed-Point Iteration on Markups</h3>
<p>The markup equation defines a fixed-point problem. Define the markup <span class="math inline">\(\eta_j = p_j - c_j\)</span>. Given prices <span class="math inline">\(p = c + \eta\)</span>, the equilibrium markup satisfies: <span class="math display">\[
\eta = (\Omega \odot \Delta(c + \eta))^{-1} s(c + \eta)
\]</span></p>
<p>This suggests the <strong>fixed-point iteration</strong>: <span class="math display">\[
\eta^{(k+1)} = (\Omega \odot \Delta(p^{(k)}))^{-1} s(p^{(k)})
\]</span> where <span class="math inline">\(p^{(k)} = c + \eta^{(k)}\)</span>.</p>
</section>
<section id="damped-iteration" class="level3">
<h3 class="anchored" data-anchor-id="damped-iteration">Damped Iteration</h3>
<p>For stability, we use <strong>damping</strong> (convex combination of old and new): <span class="math display">\[
\eta^{(k+1)} = (1 - \lambda) \eta^{(k)} + \lambda \left[ (\Omega \odot \Delta(p^{(k)}))^{-1} s(p^{(k)}) \right]
\]</span> where <span class="math inline">\(\lambda \in (0, 1]\)</span> is the damping factor. Smaller <span class="math inline">\(\lambda\)</span> improves stability at the cost of slower convergence.</p>
</section>
<section id="convergence-criterion" class="level3">
<h3 class="anchored" data-anchor-id="convergence-criterion">Convergence Criterion</h3>
<p>Iterate until the markup change is small: <span class="math display">\[
\| \eta^{(k+1)} - \eta^{(k)} \|_\infty &lt; \varepsilon
\]</span></p>
</section>
<section id="type-definitions" class="level3">
<h3 class="anchored" data-anchor-id="type-definitions">Type Definitions</h3>
<pre><code>TYPE DEFINITIONS
────────────────
Scalar      = Float                      # Single real number
Vector[J]   = Array[Float, J]            # 1D array of J floats
Matrix[J,J] = Array[Float, J, J]         # 2D array of shape (J, J)</code></pre>
</section>
<section id="algorithm" class="level3">
<h3 class="anchored" data-anchor-id="algorithm">Algorithm</h3>
<pre><code>ALGORITHM: SOLVE_EQUILIBRIUM_PRICES
───────────────────────────────────
INPUT:
  δ            : Vector[J]       # Mean utilities
  α            : Scalar          # Price sensitivity
  c            : Vector[J]       # Marginal costs
  Ω            : Matrix[J,J]     # Ownership matrix
  λ            : Scalar          # Damping factor (default: 1.0)
  ε            : Scalar          # Convergence tolerance
  K            : Int             # Maximum iterations

OUTPUT:
  p            : Vector[J]       # Equilibrium prices
  η            : Vector[J]       # Equilibrium markups
  s            : Vector[J]       # Equilibrium market shares
  converged    : Bool            # Convergence flag

PROCEDURE:
  # Initialize markups (start from marginal cost pricing)
  η : Vector[J] ← zeros(J)
  
  FOR k = 1 TO K:
    # Current prices
    p : Vector[J] ← c + η
    
    # Compute market shares
    s : Vector[J] ← COMPUTE_SHARES(δ, α, p)
    
    # Compute share derivative matrix
    Δ : Matrix[J,J] ← COMPUTE_DELTA(α, s)
    
    # Compute new markups from FOC
    η_new : Vector[J] ← SOLVE_MARKUP_EQUATION(Ω, Δ, s)
    
    # Damped update
    η_update : Vector[J] ← (1 - λ) * η + λ * η_new
    
    # Check convergence
    IF max(|η_update - η|) &lt; ε:
      η ← η_update
      p ← c + η
      s ← COMPUTE_SHARES(δ, α, p)
      RETURN (p, η, s, converged=True)
    
    η ← η_update
  
  # Did not converge
  p ← c + η
  s ← COMPUTE_SHARES(δ, α, p)
  RETURN (p, η, s, converged=False)</code></pre>
</section>
<section id="subroutines" class="level3">
<h3 class="anchored" data-anchor-id="subroutines">Subroutines</h3>
<pre><code>SUBROUTINE: COMPUTE_SHARES
──────────────────────────
INPUT:
  δ      : Vector[J]             # Mean utilities
  α      : Scalar                # Price sensitivity
  p      : Vector[J]             # Prices
OUTPUT:
  s      : Vector[J]             # Market shares

  # Compute mean utilities net of price
  v : Vector[J] ← δ - α * p
  
  # Numerically stable softmax
  v_max : Scalar ← max(v)
  exp_v : Vector[J] ← exp(v - v_max)
  denom : Scalar ← exp(-v_max) + sum(exp_v)
  
  s : Vector[J] ← exp_v / denom
  RETURN s</code></pre>
<pre><code>SUBROUTINE: COMPUTE_DELTA
─────────────────────────
INPUT:
  α      : Scalar                # Price sensitivity
  s      : Vector[J]             # Market shares
OUTPUT:
  Δ      : Matrix[J,J]           # Share derivative matrix

  # Δ_jk = -∂s_j/∂p_k
  FOR j = 1 TO J:
    FOR k = 1 TO J:
      IF j = k:
        Δ[j,k] ← α * s[j] * (1 - s[j])    # Own-price
      ELSE:
        Δ[j,k] ← -α * s[j] * s[k]          # Cross-price
  
  RETURN Δ</code></pre>
<pre><code>SUBROUTINE: SOLVE_MARKUP_EQUATION
─────────────────────────────────
INPUT:
  Ω      : Matrix[J,J]           # Ownership matrix
  Δ      : Matrix[J,J]           # Share derivative matrix
  s      : Vector[J]             # Market shares
OUTPUT:
  η      : Vector[J]             # Markups

  # Compute Ω ⊙ Δ (element-wise product)
  A : Matrix[J,J] ← Ω ⊙ Δ
  
  # Solve linear system: A * η = s
  η : Vector[J] ← SOLVE_LINEAR_SYSTEM(A, s)
  
  RETURN η</code></pre>
</section>
<section id="convergence-properties" class="level3">
<h3 class="anchored" data-anchor-id="convergence-properties">Convergence Properties</h3>
<p>The fixed-point iteration converges when the mapping is a <strong>contraction</strong>. Key factors affecting convergence:</p>
<ol type="1">
<li><strong>Price sensitivity <span class="math inline">\(\alpha\)</span></strong>: Higher <span class="math inline">\(\alpha\)</span> → more elastic demand → smaller markups → faster convergence</li>
<li><strong>Market concentration</strong>: More products owned by same firm → larger markups → slower convergence</li>
<li><strong>Damping <span class="math inline">\(\lambda\)</span></strong>: Smaller <span class="math inline">\(\lambda\)</span> → more stable but slower</li>
</ol>
</section>
<section id="verification-plan" class="level3">
<h3 class="anchored" data-anchor-id="verification-plan">Verification Plan</h3>
<p>To validate the solver:</p>
<ol type="1">
<li><strong>FOC residuals</strong>: Check <span class="math inline">\(\| s + (\Omega \odot \Delta)(p - c) \|_\infty &lt; \varepsilon\)</span></li>
<li><strong>Symmetric benchmark</strong>: For symmetric products with single-product firms, verify <span class="math inline">\(\eta_j = \frac{1}{\alpha(1 - s_j)}\)</span></li>
<li><strong>Monopoly benchmark</strong>: Single firm owning all products should yield monopoly prices</li>
<li><strong>Comparative statics</strong>: Higher <span class="math inline">\(\alpha\)</span> → lower markups; merger (change <span class="math inline">\(\Omega\)</span>) → higher markups</li>
</ol>
</section>
</section>
<section id="implementation" class="level2">
<h2 class="anchored" data-anchor-id="implementation">Implementation</h2>
<section id="setup" class="level3">
<h3 class="anchored" data-anchor-id="setup">Setup</h3>
<div id="setup" class="cell" data-cache="false" data-execution_count="1">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Standard libraries</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sys</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Add project paths</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>sys.path.insert(<span class="dv">0</span>, <span class="st">"../../../src"</span>)</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>sys.path.insert(<span class="dv">0</span>, <span class="st">"../config_opm"</span>)</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>sys.path.insert(<span class="dv">0</span>, <span class="st">"../../utils"</span>)</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Import OPM solver</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> opm.solver_opm <span class="im">import</span> (</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>    solve_equilibrium_prices,</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>    compute_shares,</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>    compute_delta,</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>    EquilibriumResult,</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Import configuration</span></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> config</span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot style</span></span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>plt.style.use(<span class="st">'seaborn-v0_8-whitegrid'</span>)</span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>plt.rcParams[<span class="st">'figure.figsize'</span>] <span class="op">=</span> (<span class="dv">10</span>, <span class="dv">6</span>)</span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>plt.rcParams[<span class="st">'font.size'</span>] <span class="op">=</span> <span class="dv">11</span></span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>plt.rcParams[<span class="st">'axes.titlesize'</span>] <span class="op">=</span> <span class="dv">14</span></span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>plt.rcParams[<span class="st">'axes.labelsize'</span>] <span class="op">=</span> <span class="dv">12</span></span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Modules loaded successfully"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Modules loaded successfully</code></pre>
</div>
</div>
</section>
<section id="model-parameters" class="level3">
<h3 class="anchored" data-anchor-id="model-parameters">Model Parameters</h3>
<div id="parameters" class="cell" data-execution_count="2">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load parameters from config (DRY principle)</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>J <span class="op">=</span> config.J</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>delta <span class="op">=</span> config.delta</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>alpha <span class="op">=</span> config.alpha</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>costs <span class="op">=</span> config.costs</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>ownership <span class="op">=</span> config.ownership</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>damping <span class="op">=</span> config.damping</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>tolerance <span class="op">=</span> config.tolerance</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>max_iterations <span class="op">=</span> config.max_iterations</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">50</span>)</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"BASELINE CONFIGURATION"</span>)</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">50</span>)</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Products (J):           </span><span class="sc">{</span>J<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Mean utilities (δ):     </span><span class="sc">{</span>delta<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Price sensitivity (α):  </span><span class="sc">{</span>alpha<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Marginal costs (c):     </span><span class="sc">{</span>costs<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Ownership structure:    Single-product firms (Ω = I)"</span>)</span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Solver damping (λ):     </span><span class="sc">{</span>damping<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Convergence tolerance:  </span><span class="sc">{</span>tolerance<span class="sc">}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>==================================================
BASELINE CONFIGURATION
==================================================
Products (J):           3
Mean utilities (δ):     [1. 1. 1.]
Price sensitivity (α):  1.0
Marginal costs (c):     [0.5 0.5 0.5]
Ownership structure:    Single-product firms (Ω = I)
Solver damping (λ):     1.0
Convergence tolerance:  1e-10</code></pre>
</div>
</div>
</section>
<section id="solve-equilibrium" class="level3">
<h3 class="anchored" data-anchor-id="solve-equilibrium">Solve Equilibrium</h3>
<div id="solve" class="cell" data-execution_count="3">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Solve for Bertrand-Nash equilibrium</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> solve_equilibrium_prices(</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    delta<span class="op">=</span>delta,</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    alpha<span class="op">=</span>alpha,</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    costs<span class="op">=</span>costs,</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    ownership<span class="op">=</span>ownership,</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    damping<span class="op">=</span>damping,</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    tolerance<span class="op">=</span>tolerance,</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    max_iterations<span class="op">=</span>max_iterations,</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">50</span>)</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"EQUILIBRIUM SOLUTION"</span>)</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">50</span>)</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Converged:      </span><span class="sc">{</span>result<span class="sc">.</span>converged<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Iterations:     </span><span class="sc">{</span>result<span class="sc">.</span>n_iterations<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Final error:    </span><span class="sc">{</span>result<span class="sc">.</span>final_error<span class="sc">:.2e}</span><span class="ss">"</span>)</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>()</span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Product-level results:"</span>)</span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"-"</span> <span class="op">*</span> <span class="dv">50</span>)</span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span><span class="st">'Product'</span><span class="sc">:&lt;10}</span><span class="ss"> </span><span class="sc">{</span><span class="st">'Price'</span><span class="sc">:&lt;12}</span><span class="ss"> </span><span class="sc">{</span><span class="st">'Markup'</span><span class="sc">:&lt;12}</span><span class="ss"> </span><span class="sc">{</span><span class="st">'Share'</span><span class="sc">:&lt;12}</span><span class="ss">"</span>)</span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"-"</span> <span class="op">*</span> <span class="dv">50</span>)</span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(J):</span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>j<span class="sc">:&lt;10}</span><span class="ss"> </span><span class="sc">{</span>result<span class="sc">.</span>prices[j]<span class="sc">:&lt;12.4f}</span><span class="ss"> </span><span class="sc">{</span>result<span class="sc">.</span>markups[j]<span class="sc">:&lt;12.4f}</span><span class="ss"> </span><span class="sc">{</span>result<span class="sc">.</span>shares[j]<span class="sc">:&lt;12.4f}</span><span class="ss">"</span>)</span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"-"</span> <span class="op">*</span> <span class="dv">50</span>)</span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span><span class="st">'Total'</span><span class="sc">:&lt;10}</span><span class="ss"> </span><span class="sc">{</span><span class="st">''</span><span class="sc">:&lt;12}</span><span class="ss"> </span><span class="sc">{</span><span class="st">''</span><span class="sc">:&lt;12}</span><span class="ss"> </span><span class="sc">{</span>np<span class="sc">.</span><span class="bu">sum</span>(result.shares)<span class="sc">:&lt;12.4f}</span><span class="ss">"</span>)</span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span><span class="st">'Outside'</span><span class="sc">:&lt;10}</span><span class="ss"> </span><span class="sc">{</span><span class="st">''</span><span class="sc">:&lt;12}</span><span class="ss"> </span><span class="sc">{</span><span class="st">''</span><span class="sc">:&lt;12}</span><span class="ss"> </span><span class="sc">{</span><span class="dv">1</span> <span class="op">-</span> np<span class="sc">.</span><span class="bu">sum</span>(result.shares)<span class="sc">:&lt;12.4f}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>==================================================
EQUILIBRIUM SOLUTION
==================================================
Converged:      True
Iterations:     13
Final error:    1.81e-11

Product-level results:
--------------------------------------------------
Product    Price        Markup       Share       
--------------------------------------------------
0          1.7437       1.2437       0.1959      
1          1.7437       1.2437       0.1959      
2          1.7437       1.2437       0.1959      
--------------------------------------------------
Total                                0.5878      
Outside                              0.4122      </code></pre>
</div>
</div>
</section>
<section id="verify-against-analytical-benchmark" class="level3">
<h3 class="anchored" data-anchor-id="verify-against-analytical-benchmark">Verify Against Analytical Benchmark</h3>
<div id="verify" class="cell" data-execution_count="4">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Analytical benchmark: η = 1 / (α * (1 - s))</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>expected_markups <span class="op">=</span> np.array([</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    config.compute_expected_markup(s, alpha) <span class="cf">for</span> s <span class="kw">in</span> result.shares</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>])</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">50</span>)</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"ANALYTICAL BENCHMARK VERIFICATION"</span>)</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">50</span>)</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Formula: η = 1 / (α * (1 - s))"</span>)</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>()</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span><span class="st">'Product'</span><span class="sc">:&lt;10}</span><span class="ss"> </span><span class="sc">{</span><span class="st">'Computed η'</span><span class="sc">:&lt;15}</span><span class="ss"> </span><span class="sc">{</span><span class="st">'Expected η'</span><span class="sc">:&lt;15}</span><span class="ss"> </span><span class="sc">{</span><span class="st">'Match'</span><span class="sc">:&lt;10}</span><span class="ss">"</span>)</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"-"</span> <span class="op">*</span> <span class="dv">50</span>)</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(J):</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>    match <span class="op">=</span> np.isclose(result.markups[j], expected_markups[j], rtol<span class="op">=</span><span class="fl">1e-6</span>)</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>j<span class="sc">:&lt;10}</span><span class="ss"> </span><span class="sc">{</span>result<span class="sc">.</span>markups[j]<span class="sc">:&lt;15.6f}</span><span class="ss"> </span><span class="sc">{</span>expected_markups[j]<span class="sc">:&lt;15.6f}</span><span class="ss"> </span><span class="sc">{</span><span class="st">'✓'</span> <span class="cf">if</span> match <span class="cf">else</span> <span class="st">'✗'</span><span class="sc">:&lt;10}</span><span class="ss">"</span>)</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Verify FOC residuals</span></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>Delta <span class="op">=</span> compute_delta(alpha, result.shares)</span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>A <span class="op">=</span> ownership <span class="op">*</span> Delta</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>foc_residual <span class="op">=</span> result.shares <span class="op">-</span> A <span class="op">@</span> result.markups</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>()</span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"FOC residual (should be ~0): </span><span class="sc">{</span>np<span class="sc">.</span><span class="bu">max</span>(np.<span class="bu">abs</span>(foc_residual))<span class="sc">:.2e}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>==================================================
ANALYTICAL BENCHMARK VERIFICATION
==================================================
Formula: η = 1 / (α * (1 - s))

Product    Computed η      Expected η      Match     
--------------------------------------------------
0          1.243684        1.243684        ✓         
1          1.243684        1.243684        ✓         
2          1.243684        1.243684        ✓         

FOC residual (should be ~0): 3.57e-13</code></pre>
</div>
</div>
</section>
</section>
<section id="results" class="level2">
<h2 class="anchored" data-anchor-id="results">Results</h2>
<div id="results-summary" class="cell" data-execution_count="5">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Summary statistics</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">50</span>)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"EQUILIBRIUM SUMMARY"</span>)</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">50</span>)</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Average price:          </span><span class="sc">{</span>np<span class="sc">.</span>mean(result.prices)<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Average markup:         </span><span class="sc">{</span>np<span class="sc">.</span>mean(result.markups)<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Average margin (%):     </span><span class="sc">{</span><span class="dv">100</span> <span class="op">*</span> np<span class="sc">.</span>mean(result.markups <span class="op">/</span> result.prices)<span class="sc">:.1f}</span><span class="ss">%"</span>)</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Total inside share:     </span><span class="sc">{</span>np<span class="sc">.</span><span class="bu">sum</span>(result.shares)<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"HHI (concentration):    </span><span class="sc">{</span>np<span class="sc">.</span><span class="bu">sum</span>(result.shares<span class="op">**</span><span class="dv">2</span>) <span class="op">*</span> <span class="dv">10000</span><span class="sc">:.0f}</span><span class="ss">"</span>)</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>()</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Pass-through rates</span></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>pass_through <span class="op">=</span> np.array([config.compute_pass_through(s) <span class="cf">for</span> s <span class="kw">in</span> result.shares])</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Pass-through rates (ρ = 1 - s):"</span>)</span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(J):</span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Product </span><span class="sc">{</span>j<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>pass_through[j]<span class="sc">:.4f}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>==================================================
EQUILIBRIUM SUMMARY
==================================================
Average price:          1.7437
Average markup:         1.2437
Average margin (%):     71.3%
Total inside share:     0.5878
HHI (concentration):    1152

Pass-through rates (ρ = 1 - s):
  Product 0: 0.8041
  Product 1: 0.8041
  Product 2: 0.8041</code></pre>
</div>
</div>
</section>
<section id="comparative-statics-1" class="level2">
<h2 class="anchored" data-anchor-id="comparative-statics-1">Comparative Statics</h2>
<section id="scenario-1-symmetrichomogeneous-products-baseline-1" class="level3">
<h3 class="anchored" data-anchor-id="scenario-1-symmetrichomogeneous-products-baseline-1">Scenario 1: Symmetric/Homogeneous Products (Baseline)</h3>
<p>This baseline scenario uses identical products (<span class="math inline">\(\delta_j = \delta\)</span>, <span class="math inline">\(c_j = c\)</span> for all <span class="math inline">\(j\)</span>) to isolate the effects of model parameters on equilibrium outcomes.</p>
<div id="cell-comparative-statics" class="cell" data-execution_count="6">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute equilibrium for range of alpha values</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>alpha_range <span class="op">=</span> np.linspace(<span class="fl">0.3</span>, <span class="fl">3.0</span>, <span class="dv">50</span>)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>markups_alpha <span class="op">=</span> []</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>prices_alpha <span class="op">=</span> []</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>shares_alpha <span class="op">=</span> []</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> alpha_test <span class="kw">in</span> alpha_range:</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>    res <span class="op">=</span> solve_equilibrium_prices(</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>        delta<span class="op">=</span>delta, alpha<span class="op">=</span>alpha_test, costs<span class="op">=</span>costs, ownership<span class="op">=</span>ownership</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>    markups_alpha.append(np.mean(res.markups))</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>    prices_alpha.append(np.mean(res.prices))</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>    shares_alpha.append(np.<span class="bu">sum</span>(res.shares))</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>markups_alpha <span class="op">=</span> np.array(markups_alpha)</span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>prices_alpha <span class="op">=</span> np.array(prices_alpha)</span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>shares_alpha <span class="op">=</span> np.array(shares_alpha)</span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Create figure with subplots</span></span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">3</span>, figsize<span class="op">=</span>(<span class="dv">14</span>, <span class="dv">4</span>))</span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Panel A: Markup vs Alpha</span></span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].plot(alpha_range, markups_alpha, <span class="st">'b-'</span>, linewidth<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].axhline(y<span class="op">=</span><span class="dv">1</span><span class="op">/</span>alpha, color<span class="op">=</span><span class="st">'r'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, alpha<span class="op">=</span><span class="fl">0.7</span>, label<span class="op">=</span><span class="ss">f'Baseline (α=</span><span class="sc">{</span>alpha<span class="sc">}</span><span class="ss">)'</span>)</span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].axvline(x<span class="op">=</span>alpha, color<span class="op">=</span><span class="st">'r'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, alpha<span class="op">=</span><span class="fl">0.7</span>)</span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_xlabel(<span class="st">'Price Sensitivity (α)'</span>)</span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_ylabel(<span class="st">'Average Markup (η)'</span>)</span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_title(<span class="st">'A. Markup vs Price Sensitivity'</span>)</span>
<span id="cb16-29"><a href="#cb16-29" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_xlim(<span class="fl">0.3</span>, <span class="fl">3.0</span>)</span>
<span id="cb16-30"><a href="#cb16-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-31"><a href="#cb16-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Panel B: Price vs Alpha</span></span>
<span id="cb16-32"><a href="#cb16-32" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].plot(alpha_range, prices_alpha, <span class="st">'g-'</span>, linewidth<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb16-33"><a href="#cb16-33" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].axhline(y<span class="op">=</span>costs[<span class="dv">0</span>], color<span class="op">=</span><span class="st">'gray'</span>, linestyle<span class="op">=</span><span class="st">':'</span>, alpha<span class="op">=</span><span class="fl">0.7</span>, label<span class="op">=</span><span class="ss">f'Marginal cost (c=</span><span class="sc">{</span>costs[<span class="dv">0</span>]<span class="sc">}</span><span class="ss">)'</span>)</span>
<span id="cb16-34"><a href="#cb16-34" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].axvline(x<span class="op">=</span>alpha, color<span class="op">=</span><span class="st">'r'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, alpha<span class="op">=</span><span class="fl">0.7</span>)</span>
<span id="cb16-35"><a href="#cb16-35" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_xlabel(<span class="st">'Price Sensitivity (α)'</span>)</span>
<span id="cb16-36"><a href="#cb16-36" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_ylabel(<span class="st">'Average Price (p)'</span>)</span>
<span id="cb16-37"><a href="#cb16-37" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_title(<span class="st">'B. Price vs Price Sensitivity'</span>)</span>
<span id="cb16-38"><a href="#cb16-38" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_xlim(<span class="fl">0.3</span>, <span class="fl">3.0</span>)</span>
<span id="cb16-39"><a href="#cb16-39" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].legend(loc<span class="op">=</span><span class="st">'upper right'</span>)</span>
<span id="cb16-40"><a href="#cb16-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-41"><a href="#cb16-41" aria-hidden="true" tabindex="-1"></a><span class="co"># Panel C: Total Share vs Alpha</span></span>
<span id="cb16-42"><a href="#cb16-42" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">2</span>].plot(alpha_range, shares_alpha, <span class="st">'m-'</span>, linewidth<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb16-43"><a href="#cb16-43" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">2</span>].axvline(x<span class="op">=</span>alpha, color<span class="op">=</span><span class="st">'r'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, alpha<span class="op">=</span><span class="fl">0.7</span>)</span>
<span id="cb16-44"><a href="#cb16-44" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">2</span>].set_xlabel(<span class="st">'Price Sensitivity (α)'</span>)</span>
<span id="cb16-45"><a href="#cb16-45" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">2</span>].set_ylabel(<span class="st">'Total Inside Share'</span>)</span>
<span id="cb16-46"><a href="#cb16-46" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">2</span>].set_title(<span class="st">'C. Market Size vs Price Sensitivity'</span>)</span>
<span id="cb16-47"><a href="#cb16-47" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">2</span>].set_xlim(<span class="fl">0.3</span>, <span class="fl">3.0</span>)</span>
<span id="cb16-48"><a href="#cb16-48" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">2</span>].set_ylim(<span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb16-49"><a href="#cb16-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-50"><a href="#cb16-50" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb16-51"><a href="#cb16-51" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb16-52"><a href="#cb16-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-53"><a href="#cb16-53" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Interpretation: Higher α → more elastic demand → lower markups → lower prices → higher market share"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="comparative-statics" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="solve_opm_files/figure-html/comparative-statics-output-1.png" width="1331" height="370" class="figure-img"></p>
<figcaption>Scenario 1 (Baseline): Effect of Price Sensitivity on Equilibrium Outcomes</figcaption>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
Interpretation: Higher α → more elastic demand → lower markups → lower prices → higher market share</code></pre>
</div>
</div>
<div id="cell-comparative-statics-competition" class="cell" data-execution_count="7">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute equilibrium for different number of competitors</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>J_range <span class="op">=</span> <span class="bu">range</span>(<span class="dv">1</span>, <span class="dv">21</span>)</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>markups_J <span class="op">=</span> []</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>shares_J <span class="op">=</span> []</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>prices_J <span class="op">=</span> []</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> J_test <span class="kw">in</span> J_range:</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>    delta_test <span class="op">=</span> np.ones(J_test)</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>    costs_test <span class="op">=</span> np.ones(J_test) <span class="op">*</span> <span class="fl">0.5</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>    ownership_test <span class="op">=</span> np.eye(J_test)</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>    res <span class="op">=</span> solve_equilibrium_prices(</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>        delta<span class="op">=</span>delta_test, alpha<span class="op">=</span><span class="fl">1.0</span>, costs<span class="op">=</span>costs_test, ownership<span class="op">=</span>ownership_test</span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>    markups_J.append(np.mean(res.markups))</span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>    shares_J.append(res.shares[<span class="dv">0</span>])</span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>    prices_J.append(np.mean(res.prices))</span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a>markups_J <span class="op">=</span> np.array(markups_J)</span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a>shares_J <span class="op">=</span> np.array(shares_J)</span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a>prices_J <span class="op">=</span> np.array(prices_J)</span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Create figure</span></span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">3</span>, figsize<span class="op">=</span>(<span class="dv">14</span>, <span class="dv">4</span>))</span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-26"><a href="#cb18-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Panel A: Markup vs J</span></span>
<span id="cb18-27"><a href="#cb18-27" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].plot(J_range, markups_J, <span class="st">'bo-'</span>, markersize<span class="op">=</span><span class="dv">5</span>, linewidth<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb18-28"><a href="#cb18-28" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].axhline(y<span class="op">=</span><span class="dv">1</span><span class="op">/</span>alpha, color<span class="op">=</span><span class="st">'r'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, alpha<span class="op">=</span><span class="fl">0.7</span>, label<span class="op">=</span><span class="ss">f'Competitive limit (1/α = </span><span class="sc">{</span><span class="dv">1</span><span class="op">/</span>alpha<span class="sc">}</span><span class="ss">)'</span>)</span>
<span id="cb18-29"><a href="#cb18-29" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_xlabel(<span class="st">'Number of Products (J)'</span>)</span>
<span id="cb18-30"><a href="#cb18-30" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_ylabel(<span class="st">'Average Markup (η)'</span>)</span>
<span id="cb18-31"><a href="#cb18-31" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_title(<span class="st">'A. Markup vs Competition'</span>)</span>
<span id="cb18-32"><a href="#cb18-32" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].legend(loc<span class="op">=</span><span class="st">'upper right'</span>)</span>
<span id="cb18-33"><a href="#cb18-33" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_xlim(<span class="dv">0</span>, <span class="dv">21</span>)</span>
<span id="cb18-34"><a href="#cb18-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-35"><a href="#cb18-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Panel B: Per-product Share vs J</span></span>
<span id="cb18-36"><a href="#cb18-36" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].plot(J_range, shares_J, <span class="st">'go-'</span>, markersize<span class="op">=</span><span class="dv">5</span>, linewidth<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb18-37"><a href="#cb18-37" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_xlabel(<span class="st">'Number of Products (J)'</span>)</span>
<span id="cb18-38"><a href="#cb18-38" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_ylabel(<span class="st">'Per-Product Share (s)'</span>)</span>
<span id="cb18-39"><a href="#cb18-39" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_title(<span class="st">'B. Market Share vs Competition'</span>)</span>
<span id="cb18-40"><a href="#cb18-40" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_xlim(<span class="dv">0</span>, <span class="dv">21</span>)</span>
<span id="cb18-41"><a href="#cb18-41" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_ylim(<span class="dv">0</span>, <span class="fl">0.5</span>)</span>
<span id="cb18-42"><a href="#cb18-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-43"><a href="#cb18-43" aria-hidden="true" tabindex="-1"></a><span class="co"># Panel C: Price vs J</span></span>
<span id="cb18-44"><a href="#cb18-44" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">2</span>].plot(J_range, prices_J, <span class="st">'mo-'</span>, markersize<span class="op">=</span><span class="dv">5</span>, linewidth<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb18-45"><a href="#cb18-45" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">2</span>].axhline(y<span class="op">=</span><span class="fl">0.5</span>, color<span class="op">=</span><span class="st">'gray'</span>, linestyle<span class="op">=</span><span class="st">':'</span>, alpha<span class="op">=</span><span class="fl">0.7</span>, label<span class="op">=</span><span class="st">'Marginal cost'</span>)</span>
<span id="cb18-46"><a href="#cb18-46" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">2</span>].axhline(y<span class="op">=</span><span class="fl">0.5</span> <span class="op">+</span> <span class="dv">1</span><span class="op">/</span>alpha, color<span class="op">=</span><span class="st">'r'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, alpha<span class="op">=</span><span class="fl">0.7</span>, label<span class="op">=</span><span class="st">'Competitive limit'</span>)</span>
<span id="cb18-47"><a href="#cb18-47" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">2</span>].set_xlabel(<span class="st">'Number of Products (J)'</span>)</span>
<span id="cb18-48"><a href="#cb18-48" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">2</span>].set_ylabel(<span class="st">'Average Price (p)'</span>)</span>
<span id="cb18-49"><a href="#cb18-49" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">2</span>].set_title(<span class="st">'C. Price vs Competition'</span>)</span>
<span id="cb18-50"><a href="#cb18-50" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">2</span>].legend(loc<span class="op">=</span><span class="st">'upper right'</span>)</span>
<span id="cb18-51"><a href="#cb18-51" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">2</span>].set_xlim(<span class="dv">0</span>, <span class="dv">21</span>)</span>
<span id="cb18-52"><a href="#cb18-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-53"><a href="#cb18-53" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb18-54"><a href="#cb18-54" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb18-55"><a href="#cb18-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-56"><a href="#cb18-56" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Interpretation: More competitors → lower per-product shares → lower markups → convergence to competitive pricing"</span>)</span>
<span id="cb18-57"><a href="#cb18-57" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"As J → ∞: markup → 1/α = </span><span class="sc">{</span><span class="dv">1</span><span class="op">/</span>alpha<span class="sc">:.2f}</span><span class="ss">, price → c + 1/α = </span><span class="sc">{</span><span class="fl">0.5</span> <span class="op">+</span> <span class="dv">1</span><span class="op">/</span>alpha<span class="sc">:.2f}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="comparative-statics-competition" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="solve_opm_files/figure-html/comparative-statics-competition-output-1.png" width="1331" height="370" class="figure-img"></p>
<figcaption>Scenario 1 (Baseline): Effect of Number of Competitors on Market Outcomes</figcaption>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
Interpretation: More competitors → lower per-product shares → lower markups → convergence to competitive pricing
As J → ∞: markup → 1/α = 1.00, price → c + 1/α = 1.50</code></pre>
</div>
</div>
<div id="cell-merger-analysis" class="cell" data-execution_count="8">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Pre-merger: all independent</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>ownership_pre <span class="op">=</span> np.eye(J)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>result_pre <span class="op">=</span> solve_equilibrium_prices(</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>    delta<span class="op">=</span>delta, alpha<span class="op">=</span>alpha, costs<span class="op">=</span>costs, ownership<span class="op">=</span>ownership_pre</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Post-merger: products 0 and 1 merge</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>ownership_post <span class="op">=</span> np.array([</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>    [<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>],</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>    [<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>],</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>    [<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>],</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>], dtype<span class="op">=</span><span class="bu">float</span>)</span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>result_post <span class="op">=</span> solve_equilibrium_prices(</span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>    delta<span class="op">=</span>delta, alpha<span class="op">=</span>alpha, costs<span class="op">=</span>costs, ownership<span class="op">=</span>ownership_post, damping<span class="op">=</span><span class="fl">0.5</span></span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Create figure</span></span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">3</span>, figsize<span class="op">=</span>(<span class="dv">14</span>, <span class="dv">5</span>))</span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Colors</span></span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a>colors_pre <span class="op">=</span> [<span class="st">'#3498db'</span>, <span class="st">'#3498db'</span>, <span class="st">'#2ecc71'</span>]  <span class="co"># Blue for merging, green for outsider</span></span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a>colors_post <span class="op">=</span> [<span class="st">'#e74c3c'</span>, <span class="st">'#e74c3c'</span>, <span class="st">'#27ae60'</span>]  <span class="co"># Red for merged, darker green for outsider</span></span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-24"><a href="#cb20-24" aria-hidden="true" tabindex="-1"></a>products <span class="op">=</span> [<span class="st">'Product 0</span><span class="ch">\n</span><span class="st">(Merging)'</span>, <span class="st">'Product 1</span><span class="ch">\n</span><span class="st">(Merging)'</span>, <span class="st">'Product 2</span><span class="ch">\n</span><span class="st">(Outsider)'</span>]</span>
<span id="cb20-25"><a href="#cb20-25" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> np.arange(<span class="bu">len</span>(products))</span>
<span id="cb20-26"><a href="#cb20-26" aria-hidden="true" tabindex="-1"></a>width <span class="op">=</span> <span class="fl">0.35</span></span>
<span id="cb20-27"><a href="#cb20-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-28"><a href="#cb20-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Panel A: Prices</span></span>
<span id="cb20-29"><a href="#cb20-29" aria-hidden="true" tabindex="-1"></a>ax1 <span class="op">=</span> axes[<span class="dv">0</span>]</span>
<span id="cb20-30"><a href="#cb20-30" aria-hidden="true" tabindex="-1"></a>bars1 <span class="op">=</span> ax1.bar(x <span class="op">-</span> width<span class="op">/</span><span class="dv">2</span>, result_pre.prices, width, label<span class="op">=</span><span class="st">'Pre-Merger'</span>, color<span class="op">=</span>colors_pre, alpha<span class="op">=</span><span class="fl">0.7</span>, edgecolor<span class="op">=</span><span class="st">'black'</span>)</span>
<span id="cb20-31"><a href="#cb20-31" aria-hidden="true" tabindex="-1"></a>bars2 <span class="op">=</span> ax1.bar(x <span class="op">+</span> width<span class="op">/</span><span class="dv">2</span>, result_post.prices, width, label<span class="op">=</span><span class="st">'Post-Merger'</span>, color<span class="op">=</span>colors_post, alpha<span class="op">=</span><span class="fl">0.7</span>, edgecolor<span class="op">=</span><span class="st">'black'</span>)</span>
<span id="cb20-32"><a href="#cb20-32" aria-hidden="true" tabindex="-1"></a>ax1.axhline(y<span class="op">=</span>costs[<span class="dv">0</span>], color<span class="op">=</span><span class="st">'gray'</span>, linestyle<span class="op">=</span><span class="st">':'</span>, linewidth<span class="op">=</span><span class="dv">2</span>, label<span class="op">=</span><span class="ss">f'Marginal Cost (c=</span><span class="sc">{</span>costs[<span class="dv">0</span>]<span class="sc">}</span><span class="ss">)'</span>)</span>
<span id="cb20-33"><a href="#cb20-33" aria-hidden="true" tabindex="-1"></a>ax1.set_ylabel(<span class="st">'Price'</span>)</span>
<span id="cb20-34"><a href="#cb20-34" aria-hidden="true" tabindex="-1"></a>ax1.set_title(<span class="st">'A. Price Changes from Merger'</span>)</span>
<span id="cb20-35"><a href="#cb20-35" aria-hidden="true" tabindex="-1"></a>ax1.set_xticks(x)</span>
<span id="cb20-36"><a href="#cb20-36" aria-hidden="true" tabindex="-1"></a>ax1.set_xticklabels(products)</span>
<span id="cb20-37"><a href="#cb20-37" aria-hidden="true" tabindex="-1"></a>ax1.legend(loc<span class="op">=</span><span class="st">'upper right'</span>)</span>
<span id="cb20-38"><a href="#cb20-38" aria-hidden="true" tabindex="-1"></a>ax1.set_ylim(<span class="dv">0</span>, <span class="bu">max</span>(result_post.prices) <span class="op">*</span> <span class="fl">1.2</span>)</span>
<span id="cb20-39"><a href="#cb20-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-40"><a href="#cb20-40" aria-hidden="true" tabindex="-1"></a><span class="co"># Add change annotations</span></span>
<span id="cb20-41"><a href="#cb20-41" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, (pre, post) <span class="kw">in</span> <span class="bu">enumerate</span>(<span class="bu">zip</span>(result_pre.prices, result_post.prices)):</span>
<span id="cb20-42"><a href="#cb20-42" aria-hidden="true" tabindex="-1"></a>    change <span class="op">=</span> post <span class="op">-</span> pre</span>
<span id="cb20-43"><a href="#cb20-43" aria-hidden="true" tabindex="-1"></a>    ax1.annotate(<span class="ss">f'</span><span class="sc">{</span>change<span class="sc">:+.3f}</span><span class="ss">'</span>, xy<span class="op">=</span>(i <span class="op">+</span> width<span class="op">/</span><span class="dv">2</span>, post <span class="op">+</span> <span class="fl">0.05</span>), ha<span class="op">=</span><span class="st">'center'</span>, fontsize<span class="op">=</span><span class="dv">9</span>, color<span class="op">=</span><span class="st">'red'</span> <span class="cf">if</span> change <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> <span class="st">'green'</span>)</span>
<span id="cb20-44"><a href="#cb20-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-45"><a href="#cb20-45" aria-hidden="true" tabindex="-1"></a><span class="co"># Panel B: Markups</span></span>
<span id="cb20-46"><a href="#cb20-46" aria-hidden="true" tabindex="-1"></a>ax2 <span class="op">=</span> axes[<span class="dv">1</span>]</span>
<span id="cb20-47"><a href="#cb20-47" aria-hidden="true" tabindex="-1"></a>bars3 <span class="op">=</span> ax2.bar(x <span class="op">-</span> width<span class="op">/</span><span class="dv">2</span>, result_pre.markups, width, label<span class="op">=</span><span class="st">'Pre-Merger'</span>, color<span class="op">=</span>colors_pre, alpha<span class="op">=</span><span class="fl">0.7</span>, edgecolor<span class="op">=</span><span class="st">'black'</span>)</span>
<span id="cb20-48"><a href="#cb20-48" aria-hidden="true" tabindex="-1"></a>bars4 <span class="op">=</span> ax2.bar(x <span class="op">+</span> width<span class="op">/</span><span class="dv">2</span>, result_post.markups, width, label<span class="op">=</span><span class="st">'Post-Merger'</span>, color<span class="op">=</span>colors_post, alpha<span class="op">=</span><span class="fl">0.7</span>, edgecolor<span class="op">=</span><span class="st">'black'</span>)</span>
<span id="cb20-49"><a href="#cb20-49" aria-hidden="true" tabindex="-1"></a>ax2.set_ylabel(<span class="st">'Markup (η = p - c)'</span>)</span>
<span id="cb20-50"><a href="#cb20-50" aria-hidden="true" tabindex="-1"></a>ax2.set_title(<span class="st">'B. Markup Changes from Merger'</span>)</span>
<span id="cb20-51"><a href="#cb20-51" aria-hidden="true" tabindex="-1"></a>ax2.set_xticks(x)</span>
<span id="cb20-52"><a href="#cb20-52" aria-hidden="true" tabindex="-1"></a>ax2.set_xticklabels(products)</span>
<span id="cb20-53"><a href="#cb20-53" aria-hidden="true" tabindex="-1"></a>ax2.legend(loc<span class="op">=</span><span class="st">'upper right'</span>)</span>
<span id="cb20-54"><a href="#cb20-54" aria-hidden="true" tabindex="-1"></a>ax2.set_ylim(<span class="dv">0</span>, <span class="bu">max</span>(result_post.markups) <span class="op">*</span> <span class="fl">1.2</span>)</span>
<span id="cb20-55"><a href="#cb20-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-56"><a href="#cb20-56" aria-hidden="true" tabindex="-1"></a><span class="co"># Add change annotations</span></span>
<span id="cb20-57"><a href="#cb20-57" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, (pre, post) <span class="kw">in</span> <span class="bu">enumerate</span>(<span class="bu">zip</span>(result_pre.markups, result_post.markups)):</span>
<span id="cb20-58"><a href="#cb20-58" aria-hidden="true" tabindex="-1"></a>    change <span class="op">=</span> post <span class="op">-</span> pre</span>
<span id="cb20-59"><a href="#cb20-59" aria-hidden="true" tabindex="-1"></a>    ax2.annotate(<span class="ss">f'</span><span class="sc">{</span>change<span class="sc">:+.3f}</span><span class="ss">'</span>, xy<span class="op">=</span>(i <span class="op">+</span> width<span class="op">/</span><span class="dv">2</span>, post <span class="op">+</span> <span class="fl">0.05</span>), ha<span class="op">=</span><span class="st">'center'</span>, fontsize<span class="op">=</span><span class="dv">9</span>, color<span class="op">=</span><span class="st">'red'</span> <span class="cf">if</span> change <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> <span class="st">'green'</span>)</span>
<span id="cb20-60"><a href="#cb20-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-61"><a href="#cb20-61" aria-hidden="true" tabindex="-1"></a><span class="co"># Panel C: Market Shares</span></span>
<span id="cb20-62"><a href="#cb20-62" aria-hidden="true" tabindex="-1"></a>ax3 <span class="op">=</span> axes[<span class="dv">2</span>]</span>
<span id="cb20-63"><a href="#cb20-63" aria-hidden="true" tabindex="-1"></a>bars5 <span class="op">=</span> ax3.bar(x <span class="op">-</span> width<span class="op">/</span><span class="dv">2</span>, result_pre.shares, width, label<span class="op">=</span><span class="st">'Pre-Merger'</span>, color<span class="op">=</span>colors_pre, alpha<span class="op">=</span><span class="fl">0.7</span>, edgecolor<span class="op">=</span><span class="st">'black'</span>)</span>
<span id="cb20-64"><a href="#cb20-64" aria-hidden="true" tabindex="-1"></a>bars6 <span class="op">=</span> ax3.bar(x <span class="op">+</span> width<span class="op">/</span><span class="dv">2</span>, result_post.shares, width, label<span class="op">=</span><span class="st">'Post-Merger'</span>, color<span class="op">=</span>colors_post, alpha<span class="op">=</span><span class="fl">0.7</span>, edgecolor<span class="op">=</span><span class="st">'black'</span>)</span>
<span id="cb20-65"><a href="#cb20-65" aria-hidden="true" tabindex="-1"></a>ax3.set_ylabel(<span class="st">'Market Share (s)'</span>)</span>
<span id="cb20-66"><a href="#cb20-66" aria-hidden="true" tabindex="-1"></a>ax3.set_title(<span class="st">'C. Market Share Changes from Merger'</span>)</span>
<span id="cb20-67"><a href="#cb20-67" aria-hidden="true" tabindex="-1"></a>ax3.set_xticks(x)</span>
<span id="cb20-68"><a href="#cb20-68" aria-hidden="true" tabindex="-1"></a>ax3.set_xticklabels(products)</span>
<span id="cb20-69"><a href="#cb20-69" aria-hidden="true" tabindex="-1"></a>ax3.legend(loc<span class="op">=</span><span class="st">'upper right'</span>)</span>
<span id="cb20-70"><a href="#cb20-70" aria-hidden="true" tabindex="-1"></a>ax3.set_ylim(<span class="dv">0</span>, <span class="bu">max</span>(<span class="bu">max</span>(result_pre.shares), <span class="bu">max</span>(result_post.shares)) <span class="op">*</span> <span class="fl">1.3</span>)</span>
<span id="cb20-71"><a href="#cb20-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-72"><a href="#cb20-72" aria-hidden="true" tabindex="-1"></a><span class="co"># Add change annotations</span></span>
<span id="cb20-73"><a href="#cb20-73" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, (pre, post) <span class="kw">in</span> <span class="bu">enumerate</span>(<span class="bu">zip</span>(result_pre.shares, result_post.shares)):</span>
<span id="cb20-74"><a href="#cb20-74" aria-hidden="true" tabindex="-1"></a>    change <span class="op">=</span> post <span class="op">-</span> pre</span>
<span id="cb20-75"><a href="#cb20-75" aria-hidden="true" tabindex="-1"></a>    ax3.annotate(<span class="ss">f'</span><span class="sc">{</span>change<span class="sc">:+.3f}</span><span class="ss">'</span>, xy<span class="op">=</span>(i <span class="op">+</span> width<span class="op">/</span><span class="dv">2</span>, post <span class="op">+</span> <span class="fl">0.01</span>), ha<span class="op">=</span><span class="st">'center'</span>, fontsize<span class="op">=</span><span class="dv">9</span>, color<span class="op">=</span><span class="st">'red'</span> <span class="cf">if</span> change <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> <span class="st">'green'</span>)</span>
<span id="cb20-76"><a href="#cb20-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-77"><a href="#cb20-77" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb20-78"><a href="#cb20-78" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb20-79"><a href="#cb20-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-80"><a href="#cb20-80" aria-hidden="true" tabindex="-1"></a><span class="co"># Summary table</span></span>
<span id="cb20-81"><a href="#cb20-81" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span> <span class="op">+</span> <span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb20-82"><a href="#cb20-82" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"MERGER IMPACT SUMMARY"</span>)</span>
<span id="cb20-83"><a href="#cb20-83" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb20-84"><a href="#cb20-84" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="sc">{</span><span class="st">'Metric'</span><span class="sc">:&lt;25}</span><span class="ss"> </span><span class="sc">{</span><span class="st">'Pre-Merger'</span><span class="sc">:&lt;15}</span><span class="ss"> </span><span class="sc">{</span><span class="st">'Post-Merger'</span><span class="sc">:&lt;15}</span><span class="ss"> </span><span class="sc">{</span><span class="st">'Change'</span><span class="sc">:&lt;15}</span><span class="ss">"</span>)</span>
<span id="cb20-85"><a href="#cb20-85" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"-"</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb20-86"><a href="#cb20-86" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span><span class="st">'Price (merged firms)'</span><span class="sc">:&lt;25}</span><span class="ss"> </span><span class="sc">{</span>np<span class="sc">.</span>mean(result_pre.prices[:<span class="dv">2</span>])<span class="sc">:&lt;15.4f}</span><span class="ss"> </span><span class="sc">{</span>np<span class="sc">.</span>mean(result_post.prices[:<span class="dv">2</span>])<span class="sc">:&lt;15.4f}</span><span class="ss"> </span><span class="sc">{</span>np<span class="sc">.</span>mean(result_post.prices[:<span class="dv">2</span>]) <span class="op">-</span> np<span class="sc">.</span>mean(result_pre.prices[:<span class="dv">2</span>])<span class="sc">:+.4f}</span><span class="ss">"</span>)</span>
<span id="cb20-87"><a href="#cb20-87" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span><span class="st">'Price (outsider)'</span><span class="sc">:&lt;25}</span><span class="ss"> </span><span class="sc">{</span>result_pre<span class="sc">.</span>prices[<span class="dv">2</span>]<span class="sc">:&lt;15.4f}</span><span class="ss"> </span><span class="sc">{</span>result_post<span class="sc">.</span>prices[<span class="dv">2</span>]<span class="sc">:&lt;15.4f}</span><span class="ss"> </span><span class="sc">{</span>result_post<span class="sc">.</span>prices[<span class="dv">2</span>] <span class="op">-</span> result_pre<span class="sc">.</span>prices[<span class="dv">2</span>]<span class="sc">:+.4f}</span><span class="ss">"</span>)</span>
<span id="cb20-88"><a href="#cb20-88" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span><span class="st">'Combined share (merged)'</span><span class="sc">:&lt;25}</span><span class="ss"> </span><span class="sc">{</span>np<span class="sc">.</span><span class="bu">sum</span>(result_pre.shares[:<span class="dv">2</span>])<span class="sc">:&lt;15.4f}</span><span class="ss"> </span><span class="sc">{</span>np<span class="sc">.</span><span class="bu">sum</span>(result_post.shares[:<span class="dv">2</span>])<span class="sc">:&lt;15.4f}</span><span class="ss"> </span><span class="sc">{</span>np<span class="sc">.</span><span class="bu">sum</span>(result_post.shares[:<span class="dv">2</span>]) <span class="op">-</span> np<span class="sc">.</span><span class="bu">sum</span>(result_pre.shares[:<span class="dv">2</span>])<span class="sc">:+.4f}</span><span class="ss">"</span>)</span>
<span id="cb20-89"><a href="#cb20-89" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span><span class="st">'Share (outsider)'</span><span class="sc">:&lt;25}</span><span class="ss"> </span><span class="sc">{</span>result_pre<span class="sc">.</span>shares[<span class="dv">2</span>]<span class="sc">:&lt;15.4f}</span><span class="ss"> </span><span class="sc">{</span>result_post<span class="sc">.</span>shares[<span class="dv">2</span>]<span class="sc">:&lt;15.4f}</span><span class="ss"> </span><span class="sc">{</span>result_post<span class="sc">.</span>shares[<span class="dv">2</span>] <span class="op">-</span> result_pre<span class="sc">.</span>shares[<span class="dv">2</span>]<span class="sc">:+.4f}</span><span class="ss">"</span>)</span>
<span id="cb20-90"><a href="#cb20-90" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span><span class="st">'Outside option share'</span><span class="sc">:&lt;25}</span><span class="ss"> </span><span class="sc">{</span><span class="dv">1</span><span class="op">-</span>np<span class="sc">.</span><span class="bu">sum</span>(result_pre.shares)<span class="sc">:&lt;15.4f}</span><span class="ss"> </span><span class="sc">{</span><span class="dv">1</span><span class="op">-</span>np<span class="sc">.</span><span class="bu">sum</span>(result_post.shares)<span class="sc">:&lt;15.4f}</span><span class="ss"> </span><span class="sc">{</span>(<span class="dv">1</span><span class="op">-</span>np.<span class="bu">sum</span>(result_post.shares)) <span class="op">-</span> (<span class="dv">1</span><span class="op">-</span>np.<span class="bu">sum</span>(result_pre.shares))<span class="sc">:+.4f}</span><span class="ss">"</span>)</span>
<span id="cb20-91"><a href="#cb20-91" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>()</span>
<span id="cb20-92"><a href="#cb20-92" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Interpretation:"</span>)</span>
<span id="cb20-93"><a href="#cb20-93" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"• Merged products raise prices → internalize cannibalization effect"</span>)</span>
<span id="cb20-94"><a href="#cb20-94" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"• Outsider product also raises price → strategic complement effect"</span>)</span>
<span id="cb20-95"><a href="#cb20-95" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"• Consumers shift to outside option → higher prices reduce total demand"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="merger-analysis" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="solve_opm_files/figure-html/merger-analysis-output-1.png" width="1331" height="467" class="figure-img"></p>
<figcaption>Scenario 1 (Baseline): Symmetric Merger Analysis</figcaption>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
======================================================================
MERGER IMPACT SUMMARY
======================================================================

Metric                    Pre-Merger      Post-Merger     Change         
----------------------------------------------------------------------
Price (merged firms)      1.7437          2.0017          +0.2580
Price (outsider)          1.7437          1.7676          +0.0239
Combined share (merged)   0.3919          0.3341          -0.0578
Share (outsider)          0.1959          0.2111          +0.0152
Outside option share      0.4122          0.4548          +0.0426

Interpretation:
• Merged products raise prices → internalize cannibalization effect
• Outsider product also raises price → strategic complement effect
• Consumers shift to outside option → higher prices reduce total demand</code></pre>
</div>
</div>
</section>
<section id="scenario-2-quality-differentiation-only-1" class="level3">
<h3 class="anchored" data-anchor-id="scenario-2-quality-differentiation-only-1">Scenario 2: Quality Differentiation Only</h3>
<div id="quality-differentiation-setup" class="cell" data-execution_count="9">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load scenario from config (DRY principle)</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>sc_quality <span class="op">=</span> config.SCENARIOS[<span class="st">"quality"</span>]</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>delta_quality <span class="op">=</span> sc_quality[<span class="st">"delta"</span>]</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>costs_quality <span class="op">=</span> sc_quality[<span class="st">"costs"</span>]</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>ownership_quality <span class="op">=</span> sc_quality[<span class="st">"ownership"</span>]</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>alpha_quality <span class="op">=</span> sc_quality[<span class="st">"alpha"</span>]</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Solve equilibrium</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>result_quality <span class="op">=</span> solve_equilibrium_prices(</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>    delta<span class="op">=</span>delta_quality,</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>    alpha<span class="op">=</span>alpha_quality,</span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>    costs<span class="op">=</span>costs_quality,</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>    ownership<span class="op">=</span>ownership_quality,</span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">60</span>)</span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"SCENARIO 2: QUALITY DIFFERENTIATION"</span>)</span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"δ varies, c constant"</span>)</span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">60</span>)</span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>()</span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Setup:"</span>)</span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Mean utilities (δ):  </span><span class="sc">{</span>delta_quality<span class="sc">}</span><span class="ss">  (Low, Med, High quality)"</span>)</span>
<span id="cb22-23"><a href="#cb22-23" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Marginal costs (c):  </span><span class="sc">{</span>costs_quality<span class="sc">}</span><span class="ss">  (identical)"</span>)</span>
<span id="cb22-24"><a href="#cb22-24" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Price sensitivity:   α = </span><span class="sc">{</span>alpha_quality<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb22-25"><a href="#cb22-25" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>()</span>
<span id="cb22-26"><a href="#cb22-26" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Equilibrium Results:"</span>)</span>
<span id="cb22-27"><a href="#cb22-27" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"-"</span> <span class="op">*</span> <span class="dv">60</span>)</span>
<span id="cb22-28"><a href="#cb22-28" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span><span class="st">'Product'</span><span class="sc">:&lt;12}</span><span class="ss"> </span><span class="sc">{</span><span class="st">'Quality (δ)'</span><span class="sc">:&lt;12}</span><span class="ss"> </span><span class="sc">{</span><span class="st">'Share'</span><span class="sc">:&lt;12}</span><span class="ss"> </span><span class="sc">{</span><span class="st">'Markup'</span><span class="sc">:&lt;12}</span><span class="ss"> </span><span class="sc">{</span><span class="st">'Price'</span><span class="sc">:&lt;12}</span><span class="ss">"</span>)</span>
<span id="cb22-29"><a href="#cb22-29" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"-"</span> <span class="op">*</span> <span class="dv">60</span>)</span>
<span id="cb22-30"><a href="#cb22-30" aria-hidden="true" tabindex="-1"></a>labels <span class="op">=</span> [<span class="st">'Low'</span>, <span class="st">'Medium'</span>, <span class="st">'High'</span>]</span>
<span id="cb22-31"><a href="#cb22-31" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">3</span>):</span>
<span id="cb22-32"><a href="#cb22-32" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>labels[j]<span class="sc">:&lt;12}</span><span class="ss"> </span><span class="sc">{</span>delta_quality[j]<span class="sc">:&lt;12.1f}</span><span class="ss"> </span><span class="sc">{</span>result_quality<span class="sc">.</span>shares[j]<span class="sc">:&lt;12.4f}</span><span class="ss"> </span><span class="sc">{</span>result_quality<span class="sc">.</span>markups[j]<span class="sc">:&lt;12.4f}</span><span class="ss"> </span><span class="sc">{</span>result_quality<span class="sc">.</span>prices[j]<span class="sc">:&lt;12.4f}</span><span class="ss">"</span>)</span>
<span id="cb22-33"><a href="#cb22-33" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"-"</span> <span class="op">*</span> <span class="dv">60</span>)</span>
<span id="cb22-34"><a href="#cb22-34" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span><span class="st">'Outside'</span><span class="sc">:&lt;12}</span><span class="ss"> </span><span class="sc">{</span><span class="st">''</span><span class="sc">:&lt;12}</span><span class="ss"> </span><span class="sc">{</span><span class="dv">1</span><span class="op">-</span>np<span class="sc">.</span><span class="bu">sum</span>(result_quality.shares)<span class="sc">:&lt;12.4f}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>============================================================
SCENARIO 2: QUALITY DIFFERENTIATION
δ varies, c constant
============================================================

Setup:
  Mean utilities (δ):  [0.5 1.  2. ]  (Low, Med, High quality)
  Marginal costs (c):  [0.5 0.5 0.5]  (identical)
  Price sensitivity:   α = 1.0

Equilibrium Results:
------------------------------------------------------------
Product      Quality (δ)  Share        Markup       Price       
------------------------------------------------------------
Low          0.5          0.1161       1.1313       1.6313      
Medium       1.0          0.1762       1.2139       1.7139      
High         2.0          0.3479       1.5336       2.0336      
------------------------------------------------------------
Outside                   0.3598      </code></pre>
</div>
</div>
<div id="cell-quality-differentiation-figure" class="cell" data-execution_count="10">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create visualization</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">4</span>, figsize<span class="op">=</span>(<span class="dv">16</span>, <span class="dv">4</span>))</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>products <span class="op">=</span> [<span class="st">'Low</span><span class="ch">\n</span><span class="st">(δ=0.5)'</span>, <span class="st">'Medium</span><span class="ch">\n</span><span class="st">(δ=1.0)'</span>, <span class="st">'High</span><span class="ch">\n</span><span class="st">(δ=2.0)'</span>]</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> np.arange(<span class="bu">len</span>(products))</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>colors <span class="op">=</span> [<span class="st">'#3498db'</span>, <span class="st">'#2ecc71'</span>, <span class="st">'#e74c3c'</span>]</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Panel A: Quality (δ)</span></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>ax1 <span class="op">=</span> axes[<span class="dv">0</span>]</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>bars1 <span class="op">=</span> ax1.bar(x, delta_quality, color<span class="op">=</span>colors, alpha<span class="op">=</span><span class="fl">0.8</span>, edgecolor<span class="op">=</span><span class="st">'black'</span>)</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>ax1.set_ylabel(<span class="st">'Mean Utility (δ)'</span>)</span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>ax1.set_title(<span class="st">'A. Product Quality'</span>)</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>ax1.set_xticks(x)</span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>ax1.set_xticklabels(products)</span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>ax1.set_ylim(<span class="dv">0</span>, <span class="fl">2.5</span>)</span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Panel B: Market Shares</span></span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a>ax2 <span class="op">=</span> axes[<span class="dv">1</span>]</span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a>bars2 <span class="op">=</span> ax2.bar(x, result_quality.shares, color<span class="op">=</span>colors, alpha<span class="op">=</span><span class="fl">0.8</span>, edgecolor<span class="op">=</span><span class="st">'black'</span>)</span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a>ax2.set_ylabel(<span class="st">'Market Share (s)'</span>)</span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a>ax2.set_title(<span class="st">'B. Market Shares'</span>)</span>
<span id="cb24-22"><a href="#cb24-22" aria-hidden="true" tabindex="-1"></a>ax2.set_xticks(x)</span>
<span id="cb24-23"><a href="#cb24-23" aria-hidden="true" tabindex="-1"></a>ax2.set_xticklabels(products)</span>
<span id="cb24-24"><a href="#cb24-24" aria-hidden="true" tabindex="-1"></a>ax2.set_ylim(<span class="dv">0</span>, <span class="fl">0.6</span>)</span>
<span id="cb24-25"><a href="#cb24-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Add outside option</span></span>
<span id="cb24-26"><a href="#cb24-26" aria-hidden="true" tabindex="-1"></a>ax2.axhline(y<span class="op">=</span><span class="dv">1</span><span class="op">-</span>np.<span class="bu">sum</span>(result_quality.shares), color<span class="op">=</span><span class="st">'gray'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, alpha<span class="op">=</span><span class="fl">0.7</span>)</span>
<span id="cb24-27"><a href="#cb24-27" aria-hidden="true" tabindex="-1"></a>ax2.text(<span class="fl">2.5</span>, <span class="dv">1</span><span class="op">-</span>np.<span class="bu">sum</span>(result_quality.shares), <span class="ss">f'Outside: </span><span class="sc">{</span><span class="dv">1</span><span class="op">-</span>np<span class="sc">.</span><span class="bu">sum</span>(result_quality.shares)<span class="sc">:.2f}</span><span class="ss">'</span>, fontsize<span class="op">=</span><span class="dv">9</span>)</span>
<span id="cb24-28"><a href="#cb24-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-29"><a href="#cb24-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Panel C: Markups</span></span>
<span id="cb24-30"><a href="#cb24-30" aria-hidden="true" tabindex="-1"></a>ax3 <span class="op">=</span> axes[<span class="dv">2</span>]</span>
<span id="cb24-31"><a href="#cb24-31" aria-hidden="true" tabindex="-1"></a>bars3 <span class="op">=</span> ax3.bar(x, result_quality.markups, color<span class="op">=</span>colors, alpha<span class="op">=</span><span class="fl">0.8</span>, edgecolor<span class="op">=</span><span class="st">'black'</span>)</span>
<span id="cb24-32"><a href="#cb24-32" aria-hidden="true" tabindex="-1"></a>ax3.set_ylabel(<span class="st">'Markup (η = p - c)'</span>)</span>
<span id="cb24-33"><a href="#cb24-33" aria-hidden="true" tabindex="-1"></a>ax3.set_title(<span class="st">'C. Markups'</span>)</span>
<span id="cb24-34"><a href="#cb24-34" aria-hidden="true" tabindex="-1"></a>ax3.set_xticks(x)</span>
<span id="cb24-35"><a href="#cb24-35" aria-hidden="true" tabindex="-1"></a>ax3.set_xticklabels(products)</span>
<span id="cb24-36"><a href="#cb24-36" aria-hidden="true" tabindex="-1"></a>ax3.set_ylim(<span class="dv">0</span>, <span class="fl">2.5</span>)</span>
<span id="cb24-37"><a href="#cb24-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-38"><a href="#cb24-38" aria-hidden="true" tabindex="-1"></a><span class="co"># Panel D: Prices</span></span>
<span id="cb24-39"><a href="#cb24-39" aria-hidden="true" tabindex="-1"></a>ax4 <span class="op">=</span> axes[<span class="dv">3</span>]</span>
<span id="cb24-40"><a href="#cb24-40" aria-hidden="true" tabindex="-1"></a>bars4 <span class="op">=</span> ax4.bar(x, result_quality.prices, color<span class="op">=</span>colors, alpha<span class="op">=</span><span class="fl">0.8</span>, edgecolor<span class="op">=</span><span class="st">'black'</span>)</span>
<span id="cb24-41"><a href="#cb24-41" aria-hidden="true" tabindex="-1"></a>ax4.axhline(y<span class="op">=</span>costs_quality[<span class="dv">0</span>], color<span class="op">=</span><span class="st">'gray'</span>, linestyle<span class="op">=</span><span class="st">':'</span>, linewidth<span class="op">=</span><span class="dv">2</span>, label<span class="op">=</span><span class="ss">f'Cost (c=</span><span class="sc">{</span>costs_quality[<span class="dv">0</span>]<span class="sc">}</span><span class="ss">)'</span>)</span>
<span id="cb24-42"><a href="#cb24-42" aria-hidden="true" tabindex="-1"></a>ax4.set_ylabel(<span class="st">'Price (p)'</span>)</span>
<span id="cb24-43"><a href="#cb24-43" aria-hidden="true" tabindex="-1"></a>ax4.set_title(<span class="st">'D. Equilibrium Prices'</span>)</span>
<span id="cb24-44"><a href="#cb24-44" aria-hidden="true" tabindex="-1"></a>ax4.set_xticks(x)</span>
<span id="cb24-45"><a href="#cb24-45" aria-hidden="true" tabindex="-1"></a>ax4.set_xticklabels(products)</span>
<span id="cb24-46"><a href="#cb24-46" aria-hidden="true" tabindex="-1"></a>ax4.set_ylim(<span class="dv">0</span>, <span class="fl">3.0</span>)</span>
<span id="cb24-47"><a href="#cb24-47" aria-hidden="true" tabindex="-1"></a>ax4.legend(loc<span class="op">=</span><span class="st">'upper left'</span>)</span>
<span id="cb24-48"><a href="#cb24-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-49"><a href="#cb24-49" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb24-50"><a href="#cb24-50" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb24-51"><a href="#cb24-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-52"><a href="#cb24-52" aria-hidden="true" tabindex="-1"></a><span class="co"># Verify analytical prediction</span></span>
<span id="cb24-53"><a href="#cb24-53" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Verification against analytical benchmark:"</span>)</span>
<span id="cb24-54"><a href="#cb24-54" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"-"</span> <span class="op">*</span> <span class="dv">60</span>)</span>
<span id="cb24-55"><a href="#cb24-55" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span><span class="st">'Product'</span><span class="sc">:&lt;12}</span><span class="ss"> </span><span class="sc">{</span><span class="st">'η computed'</span><span class="sc">:&lt;15}</span><span class="ss"> </span><span class="sc">{</span><span class="st">'η = 1/(α(1-s))'</span><span class="sc">:&lt;15}</span><span class="ss"> </span><span class="sc">{</span><span class="st">'Match'</span><span class="sc">:&lt;10}</span><span class="ss">"</span>)</span>
<span id="cb24-56"><a href="#cb24-56" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"-"</span> <span class="op">*</span> <span class="dv">60</span>)</span>
<span id="cb24-57"><a href="#cb24-57" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">3</span>):</span>
<span id="cb24-58"><a href="#cb24-58" aria-hidden="true" tabindex="-1"></a>    expected <span class="op">=</span> <span class="dv">1</span> <span class="op">/</span> (alpha_quality <span class="op">*</span> (<span class="dv">1</span> <span class="op">-</span> result_quality.shares[j]))</span>
<span id="cb24-59"><a href="#cb24-59" aria-hidden="true" tabindex="-1"></a>    match <span class="op">=</span> np.isclose(result_quality.markups[j], expected, rtol<span class="op">=</span><span class="fl">1e-6</span>)</span>
<span id="cb24-60"><a href="#cb24-60" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>labels[j]<span class="sc">:&lt;12}</span><span class="ss"> </span><span class="sc">{</span>result_quality<span class="sc">.</span>markups[j]<span class="sc">:&lt;15.6f}</span><span class="ss"> </span><span class="sc">{</span>expected<span class="sc">:&lt;15.6f}</span><span class="ss"> </span><span class="sc">{</span><span class="st">'✓'</span> <span class="cf">if</span> match <span class="cf">else</span> <span class="st">'✗'</span><span class="sc">:&lt;10}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="quality-differentiation-figure" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="solve_opm_files/figure-html/quality-differentiation-figure-output-1.png" width="1523" height="371" class="figure-img"></p>
<figcaption>Quality Differentiation: Higher Quality → Higher Share → Higher Markup → Higher Price</figcaption>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
Verification against analytical benchmark:
------------------------------------------------------------
Product      η computed      η = 1/(α(1-s))  Match     
------------------------------------------------------------
Low          1.131316        1.131316        ✓         
Medium       1.213894        1.213894        ✓         
High         1.533561        1.533561        ✓         </code></pre>
</div>
</div>
<div id="cell-quality-gradient-analysis" class="cell" data-execution_count="11">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Analyze how increasing quality gap affects equilibrium</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>quality_gaps <span class="op">=</span> np.linspace(<span class="dv">0</span>, <span class="fl">2.0</span>, <span class="dv">20</span>)  <span class="co"># Gap between high and low quality</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>results_gap <span class="op">=</span> []</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> gap <span class="kw">in</span> quality_gaps:</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># δ = [1-gap/2, 1, 1+gap/2] so mean is always 1</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>    delta_test <span class="op">=</span> np.array([<span class="fl">1.0</span> <span class="op">-</span> gap<span class="op">/</span><span class="dv">2</span>, <span class="fl">1.0</span>, <span class="fl">1.0</span> <span class="op">+</span> gap<span class="op">/</span><span class="dv">2</span>])</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>    res <span class="op">=</span> solve_equilibrium_prices(</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>        delta<span class="op">=</span>delta_test, alpha<span class="op">=</span><span class="fl">1.0</span>, costs<span class="op">=</span>np.ones(<span class="dv">3</span>)<span class="op">*</span><span class="fl">0.5</span>, ownership<span class="op">=</span>np.eye(<span class="dv">3</span>)</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>    results_gap.append({</span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>        <span class="st">'gap'</span>: gap,</span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>        <span class="st">'share_low'</span>: res.shares[<span class="dv">0</span>],</span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>        <span class="st">'share_med'</span>: res.shares[<span class="dv">1</span>],</span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a>        <span class="st">'share_high'</span>: res.shares[<span class="dv">2</span>],</span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a>        <span class="st">'markup_low'</span>: res.markups[<span class="dv">0</span>],</span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a>        <span class="st">'markup_med'</span>: res.markups[<span class="dv">1</span>],</span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a>        <span class="st">'markup_high'</span>: res.markups[<span class="dv">2</span>],</span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a>        <span class="st">'price_low'</span>: res.prices[<span class="dv">0</span>],</span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true" tabindex="-1"></a>        <span class="st">'price_high'</span>: res.prices[<span class="dv">2</span>],</span>
<span id="cb26-21"><a href="#cb26-21" aria-hidden="true" tabindex="-1"></a>        <span class="st">'hhi'</span>: np.<span class="bu">sum</span>(res.shares<span class="op">**</span><span class="dv">2</span>) <span class="op">*</span> <span class="dv">10000</span>,</span>
<span id="cb26-22"><a href="#cb26-22" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb26-23"><a href="#cb26-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-24"><a href="#cb26-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to arrays</span></span>
<span id="cb26-25"><a href="#cb26-25" aria-hidden="true" tabindex="-1"></a>gaps <span class="op">=</span> np.array([r[<span class="st">'gap'</span>] <span class="cf">for</span> r <span class="kw">in</span> results_gap])</span>
<span id="cb26-26"><a href="#cb26-26" aria-hidden="true" tabindex="-1"></a>share_low <span class="op">=</span> np.array([r[<span class="st">'share_low'</span>] <span class="cf">for</span> r <span class="kw">in</span> results_gap])</span>
<span id="cb26-27"><a href="#cb26-27" aria-hidden="true" tabindex="-1"></a>share_high <span class="op">=</span> np.array([r[<span class="st">'share_high'</span>] <span class="cf">for</span> r <span class="kw">in</span> results_gap])</span>
<span id="cb26-28"><a href="#cb26-28" aria-hidden="true" tabindex="-1"></a>markup_low <span class="op">=</span> np.array([r[<span class="st">'markup_low'</span>] <span class="cf">for</span> r <span class="kw">in</span> results_gap])</span>
<span id="cb26-29"><a href="#cb26-29" aria-hidden="true" tabindex="-1"></a>markup_high <span class="op">=</span> np.array([r[<span class="st">'markup_high'</span>] <span class="cf">for</span> r <span class="kw">in</span> results_gap])</span>
<span id="cb26-30"><a href="#cb26-30" aria-hidden="true" tabindex="-1"></a>price_low <span class="op">=</span> np.array([r[<span class="st">'price_low'</span>] <span class="cf">for</span> r <span class="kw">in</span> results_gap])</span>
<span id="cb26-31"><a href="#cb26-31" aria-hidden="true" tabindex="-1"></a>price_high <span class="op">=</span> np.array([r[<span class="st">'price_high'</span>] <span class="cf">for</span> r <span class="kw">in</span> results_gap])</span>
<span id="cb26-32"><a href="#cb26-32" aria-hidden="true" tabindex="-1"></a>hhi <span class="op">=</span> np.array([r[<span class="st">'hhi'</span>] <span class="cf">for</span> r <span class="kw">in</span> results_gap])</span>
<span id="cb26-33"><a href="#cb26-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-34"><a href="#cb26-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Create figure</span></span>
<span id="cb26-35"><a href="#cb26-35" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">2</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">8</span>))</span>
<span id="cb26-36"><a href="#cb26-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-37"><a href="#cb26-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Panel A: Shares vs Quality Gap</span></span>
<span id="cb26-38"><a href="#cb26-38" aria-hidden="true" tabindex="-1"></a>ax1 <span class="op">=</span> axes[<span class="dv">0</span>, <span class="dv">0</span>]</span>
<span id="cb26-39"><a href="#cb26-39" aria-hidden="true" tabindex="-1"></a>ax1.plot(gaps, share_low, <span class="st">'b-'</span>, linewidth<span class="op">=</span><span class="dv">2</span>, label<span class="op">=</span><span class="st">'Low quality'</span>)</span>
<span id="cb26-40"><a href="#cb26-40" aria-hidden="true" tabindex="-1"></a>ax1.plot(gaps, share_high, <span class="st">'r-'</span>, linewidth<span class="op">=</span><span class="dv">2</span>, label<span class="op">=</span><span class="st">'High quality'</span>)</span>
<span id="cb26-41"><a href="#cb26-41" aria-hidden="true" tabindex="-1"></a>ax1.fill_between(gaps, share_low, share_high, alpha<span class="op">=</span><span class="fl">0.2</span>, color<span class="op">=</span><span class="st">'gray'</span>)</span>
<span id="cb26-42"><a href="#cb26-42" aria-hidden="true" tabindex="-1"></a>ax1.set_xlabel(<span class="st">'Quality Gap (δ_high - δ_low)'</span>)</span>
<span id="cb26-43"><a href="#cb26-43" aria-hidden="true" tabindex="-1"></a>ax1.set_ylabel(<span class="st">'Market Share'</span>)</span>
<span id="cb26-44"><a href="#cb26-44" aria-hidden="true" tabindex="-1"></a>ax1.set_title(<span class="st">'A. Market Shares vs Quality Gap'</span>)</span>
<span id="cb26-45"><a href="#cb26-45" aria-hidden="true" tabindex="-1"></a>ax1.legend()</span>
<span id="cb26-46"><a href="#cb26-46" aria-hidden="true" tabindex="-1"></a>ax1.set_xlim(<span class="dv">0</span>, <span class="dv">2</span>)</span>
<span id="cb26-47"><a href="#cb26-47" aria-hidden="true" tabindex="-1"></a>ax1.set_ylim(<span class="dv">0</span>, <span class="fl">0.5</span>)</span>
<span id="cb26-48"><a href="#cb26-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-49"><a href="#cb26-49" aria-hidden="true" tabindex="-1"></a><span class="co"># Panel B: Markups vs Quality Gap</span></span>
<span id="cb26-50"><a href="#cb26-50" aria-hidden="true" tabindex="-1"></a>ax2 <span class="op">=</span> axes[<span class="dv">0</span>, <span class="dv">1</span>]</span>
<span id="cb26-51"><a href="#cb26-51" aria-hidden="true" tabindex="-1"></a>ax2.plot(gaps, markup_low, <span class="st">'b-'</span>, linewidth<span class="op">=</span><span class="dv">2</span>, label<span class="op">=</span><span class="st">'Low quality'</span>)</span>
<span id="cb26-52"><a href="#cb26-52" aria-hidden="true" tabindex="-1"></a>ax2.plot(gaps, markup_high, <span class="st">'r-'</span>, linewidth<span class="op">=</span><span class="dv">2</span>, label<span class="op">=</span><span class="st">'High quality'</span>)</span>
<span id="cb26-53"><a href="#cb26-53" aria-hidden="true" tabindex="-1"></a>ax2.set_xlabel(<span class="st">'Quality Gap (δ_high - δ_low)'</span>)</span>
<span id="cb26-54"><a href="#cb26-54" aria-hidden="true" tabindex="-1"></a>ax2.set_ylabel(<span class="st">'Markup (η)'</span>)</span>
<span id="cb26-55"><a href="#cb26-55" aria-hidden="true" tabindex="-1"></a>ax2.set_title(<span class="st">'B. Markups vs Quality Gap'</span>)</span>
<span id="cb26-56"><a href="#cb26-56" aria-hidden="true" tabindex="-1"></a>ax2.legend()</span>
<span id="cb26-57"><a href="#cb26-57" aria-hidden="true" tabindex="-1"></a>ax2.set_xlim(<span class="dv">0</span>, <span class="dv">2</span>)</span>
<span id="cb26-58"><a href="#cb26-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-59"><a href="#cb26-59" aria-hidden="true" tabindex="-1"></a><span class="co"># Panel C: Prices vs Quality Gap</span></span>
<span id="cb26-60"><a href="#cb26-60" aria-hidden="true" tabindex="-1"></a>ax3 <span class="op">=</span> axes[<span class="dv">1</span>, <span class="dv">0</span>]</span>
<span id="cb26-61"><a href="#cb26-61" aria-hidden="true" tabindex="-1"></a>ax3.plot(gaps, price_low, <span class="st">'b-'</span>, linewidth<span class="op">=</span><span class="dv">2</span>, label<span class="op">=</span><span class="st">'Low quality price'</span>)</span>
<span id="cb26-62"><a href="#cb26-62" aria-hidden="true" tabindex="-1"></a>ax3.plot(gaps, price_high, <span class="st">'r-'</span>, linewidth<span class="op">=</span><span class="dv">2</span>, label<span class="op">=</span><span class="st">'High quality price'</span>)</span>
<span id="cb26-63"><a href="#cb26-63" aria-hidden="true" tabindex="-1"></a>ax3.axhline(y<span class="op">=</span><span class="fl">0.5</span>, color<span class="op">=</span><span class="st">'gray'</span>, linestyle<span class="op">=</span><span class="st">':'</span>, alpha<span class="op">=</span><span class="fl">0.7</span>, label<span class="op">=</span><span class="st">'Marginal cost'</span>)</span>
<span id="cb26-64"><a href="#cb26-64" aria-hidden="true" tabindex="-1"></a>ax3.set_xlabel(<span class="st">'Quality Gap (δ_high - δ_low)'</span>)</span>
<span id="cb26-65"><a href="#cb26-65" aria-hidden="true" tabindex="-1"></a>ax3.set_ylabel(<span class="st">'Price'</span>)</span>
<span id="cb26-66"><a href="#cb26-66" aria-hidden="true" tabindex="-1"></a>ax3.set_title(<span class="st">'C. Prices vs Quality Gap'</span>)</span>
<span id="cb26-67"><a href="#cb26-67" aria-hidden="true" tabindex="-1"></a>ax3.legend()</span>
<span id="cb26-68"><a href="#cb26-68" aria-hidden="true" tabindex="-1"></a>ax3.set_xlim(<span class="dv">0</span>, <span class="dv">2</span>)</span>
<span id="cb26-69"><a href="#cb26-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-70"><a href="#cb26-70" aria-hidden="true" tabindex="-1"></a><span class="co"># Panel D: HHI (Concentration) vs Quality Gap</span></span>
<span id="cb26-71"><a href="#cb26-71" aria-hidden="true" tabindex="-1"></a>ax4 <span class="op">=</span> axes[<span class="dv">1</span>, <span class="dv">1</span>]</span>
<span id="cb26-72"><a href="#cb26-72" aria-hidden="true" tabindex="-1"></a>ax4.plot(gaps, hhi, <span class="st">'purple'</span>, linewidth<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb26-73"><a href="#cb26-73" aria-hidden="true" tabindex="-1"></a>ax4.axhline(y<span class="op">=</span><span class="dv">10000</span><span class="op">/</span><span class="dv">3</span>, color<span class="op">=</span><span class="st">'gray'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, alpha<span class="op">=</span><span class="fl">0.7</span>, label<span class="op">=</span><span class="st">'Symmetric HHI'</span>)</span>
<span id="cb26-74"><a href="#cb26-74" aria-hidden="true" tabindex="-1"></a>ax4.set_xlabel(<span class="st">'Quality Gap (δ_high - δ_low)'</span>)</span>
<span id="cb26-75"><a href="#cb26-75" aria-hidden="true" tabindex="-1"></a>ax4.set_ylabel(<span class="st">'HHI'</span>)</span>
<span id="cb26-76"><a href="#cb26-76" aria-hidden="true" tabindex="-1"></a>ax4.set_title(<span class="st">'D. Market Concentration vs Quality Gap'</span>)</span>
<span id="cb26-77"><a href="#cb26-77" aria-hidden="true" tabindex="-1"></a>ax4.legend()</span>
<span id="cb26-78"><a href="#cb26-78" aria-hidden="true" tabindex="-1"></a>ax4.set_xlim(<span class="dv">0</span>, <span class="dv">2</span>)</span>
<span id="cb26-79"><a href="#cb26-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-80"><a href="#cb26-80" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb26-81"><a href="#cb26-81" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb26-82"><a href="#cb26-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-83"><a href="#cb26-83" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Key Insights:"</span>)</span>
<span id="cb26-84"><a href="#cb26-84" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"• As quality gap increases, high-quality product gains share at expense of low-quality"</span>)</span>
<span id="cb26-85"><a href="#cb26-85" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"• Markup gap widens: high-quality firms gain market power, low-quality firms lose it"</span>)</span>
<span id="cb26-86"><a href="#cb26-86" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"• Price gap exceeds quality gap: high-quality charges premium beyond quality difference"</span>)</span>
<span id="cb26-87"><a href="#cb26-87" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"• Market becomes more concentrated (higher HHI) with larger quality differences"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="quality-gradient-analysis" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="solve_opm_files/figure-html/quality-gradient-analysis-output-1.png" width="1139" height="754" class="figure-img"></p>
<figcaption>Effect of Quality Gap on Market Outcomes</figcaption>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
Key Insights:
• As quality gap increases, high-quality product gains share at expense of low-quality
• Markup gap widens: high-quality firms gain market power, low-quality firms lose it
• Price gap exceeds quality gap: high-quality charges premium beyond quality difference
• Market becomes more concentrated (higher HHI) with larger quality differences</code></pre>
</div>
</div>
<div id="cell-quality-merger-analysis" class="cell" data-execution_count="12">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Asymmetric merger: High-quality (product 2) acquires Medium-quality (product 1)</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">60</span>)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"ASYMMETRIC MERGER IN QUALITY-DIFFERENTIATED MARKET"</span>)</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"High-quality firm acquires Medium-quality product"</span>)</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">60</span>)</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Pre-merger</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>ownership_pre_q <span class="op">=</span> np.eye(<span class="dv">3</span>)</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>result_pre_q <span class="op">=</span> solve_equilibrium_prices(</span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>    delta<span class="op">=</span>delta_quality, alpha<span class="op">=</span>alpha_quality, costs<span class="op">=</span>costs_quality, ownership<span class="op">=</span>ownership_pre_q</span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Post-merger: Products 1 and 2 merge (Medium + High quality)</span></span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>ownership_post_q <span class="op">=</span> np.array([</span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a>    [<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>],</span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a>    [<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>],</span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a>    [<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>],</span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a>], dtype<span class="op">=</span><span class="bu">float</span>)</span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a>result_post_q <span class="op">=</span> solve_equilibrium_prices(</span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a>    delta<span class="op">=</span>delta_quality, alpha<span class="op">=</span>alpha_quality, costs<span class="op">=</span>costs_quality, ownership<span class="op">=</span>ownership_post_q, damping<span class="op">=</span><span class="fl">0.5</span></span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb28-22"><a href="#cb28-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-23"><a href="#cb28-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Create comparison figure</span></span>
<span id="cb28-24"><a href="#cb28-24" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">3</span>, figsize<span class="op">=</span>(<span class="dv">14</span>, <span class="dv">5</span>))</span>
<span id="cb28-25"><a href="#cb28-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-26"><a href="#cb28-26" aria-hidden="true" tabindex="-1"></a>products_q <span class="op">=</span> [<span class="st">'Low</span><span class="ch">\n</span><span class="st">(δ=0.5)'</span>, <span class="st">'Medium</span><span class="ch">\n</span><span class="st">(δ=1.0)</span><span class="ch">\n</span><span class="st">[Acquired]'</span>, <span class="st">'High</span><span class="ch">\n</span><span class="st">(δ=2.0)</span><span class="ch">\n</span><span class="st">[Acquirer]'</span>]</span>
<span id="cb28-27"><a href="#cb28-27" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> np.arange(<span class="bu">len</span>(products_q))</span>
<span id="cb28-28"><a href="#cb28-28" aria-hidden="true" tabindex="-1"></a>width <span class="op">=</span> <span class="fl">0.35</span></span>
<span id="cb28-29"><a href="#cb28-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-30"><a href="#cb28-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Panel A: Prices</span></span>
<span id="cb28-31"><a href="#cb28-31" aria-hidden="true" tabindex="-1"></a>ax1 <span class="op">=</span> axes[<span class="dv">0</span>]</span>
<span id="cb28-32"><a href="#cb28-32" aria-hidden="true" tabindex="-1"></a>bars1 <span class="op">=</span> ax1.bar(x <span class="op">-</span> width<span class="op">/</span><span class="dv">2</span>, result_pre_q.prices, width, label<span class="op">=</span><span class="st">'Pre-Merger'</span>, color<span class="op">=</span>[<span class="st">'#3498db'</span>, <span class="st">'#2ecc71'</span>, <span class="st">'#e74c3c'</span>], alpha<span class="op">=</span><span class="fl">0.6</span>, edgecolor<span class="op">=</span><span class="st">'black'</span>)</span>
<span id="cb28-33"><a href="#cb28-33" aria-hidden="true" tabindex="-1"></a>bars2 <span class="op">=</span> ax1.bar(x <span class="op">+</span> width<span class="op">/</span><span class="dv">2</span>, result_post_q.prices, width, label<span class="op">=</span><span class="st">'Post-Merger'</span>, color<span class="op">=</span>[<span class="st">'#3498db'</span>, <span class="st">'#27ae60'</span>, <span class="st">'#c0392b'</span>], alpha<span class="op">=</span><span class="fl">0.9</span>, edgecolor<span class="op">=</span><span class="st">'black'</span>)</span>
<span id="cb28-34"><a href="#cb28-34" aria-hidden="true" tabindex="-1"></a>ax1.axhline(y<span class="op">=</span>costs_quality[<span class="dv">0</span>], color<span class="op">=</span><span class="st">'gray'</span>, linestyle<span class="op">=</span><span class="st">':'</span>, linewidth<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb28-35"><a href="#cb28-35" aria-hidden="true" tabindex="-1"></a>ax1.set_ylabel(<span class="st">'Price'</span>)</span>
<span id="cb28-36"><a href="#cb28-36" aria-hidden="true" tabindex="-1"></a>ax1.set_title(<span class="st">'A. Prices'</span>)</span>
<span id="cb28-37"><a href="#cb28-37" aria-hidden="true" tabindex="-1"></a>ax1.set_xticks(x)</span>
<span id="cb28-38"><a href="#cb28-38" aria-hidden="true" tabindex="-1"></a>ax1.set_xticklabels(products_q)</span>
<span id="cb28-39"><a href="#cb28-39" aria-hidden="true" tabindex="-1"></a>ax1.legend(loc<span class="op">=</span><span class="st">'upper left'</span>)</span>
<span id="cb28-40"><a href="#cb28-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-41"><a href="#cb28-41" aria-hidden="true" tabindex="-1"></a><span class="co"># Add annotations</span></span>
<span id="cb28-42"><a href="#cb28-42" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, (pre, post) <span class="kw">in</span> <span class="bu">enumerate</span>(<span class="bu">zip</span>(result_pre_q.prices, result_post_q.prices)):</span>
<span id="cb28-43"><a href="#cb28-43" aria-hidden="true" tabindex="-1"></a>    change <span class="op">=</span> post <span class="op">-</span> pre</span>
<span id="cb28-44"><a href="#cb28-44" aria-hidden="true" tabindex="-1"></a>    ax1.annotate(<span class="ss">f'</span><span class="sc">{</span>change<span class="sc">:+.3f}</span><span class="ss">'</span>, xy<span class="op">=</span>(i <span class="op">+</span> width<span class="op">/</span><span class="dv">2</span>, post <span class="op">+</span> <span class="fl">0.05</span>), ha<span class="op">=</span><span class="st">'center'</span>, fontsize<span class="op">=</span><span class="dv">9</span>, </span>
<span id="cb28-45"><a href="#cb28-45" aria-hidden="true" tabindex="-1"></a>                 color<span class="op">=</span><span class="st">'red'</span> <span class="cf">if</span> change <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> <span class="st">'green'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb28-46"><a href="#cb28-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-47"><a href="#cb28-47" aria-hidden="true" tabindex="-1"></a><span class="co"># Panel B: Markups</span></span>
<span id="cb28-48"><a href="#cb28-48" aria-hidden="true" tabindex="-1"></a>ax2 <span class="op">=</span> axes[<span class="dv">1</span>]</span>
<span id="cb28-49"><a href="#cb28-49" aria-hidden="true" tabindex="-1"></a>bars3 <span class="op">=</span> ax2.bar(x <span class="op">-</span> width<span class="op">/</span><span class="dv">2</span>, result_pre_q.markups, width, label<span class="op">=</span><span class="st">'Pre-Merger'</span>, color<span class="op">=</span>[<span class="st">'#3498db'</span>, <span class="st">'#2ecc71'</span>, <span class="st">'#e74c3c'</span>], alpha<span class="op">=</span><span class="fl">0.6</span>, edgecolor<span class="op">=</span><span class="st">'black'</span>)</span>
<span id="cb28-50"><a href="#cb28-50" aria-hidden="true" tabindex="-1"></a>bars4 <span class="op">=</span> ax2.bar(x <span class="op">+</span> width<span class="op">/</span><span class="dv">2</span>, result_post_q.markups, width, label<span class="op">=</span><span class="st">'Post-Merger'</span>, color<span class="op">=</span>[<span class="st">'#3498db'</span>, <span class="st">'#27ae60'</span>, <span class="st">'#c0392b'</span>], alpha<span class="op">=</span><span class="fl">0.9</span>, edgecolor<span class="op">=</span><span class="st">'black'</span>)</span>
<span id="cb28-51"><a href="#cb28-51" aria-hidden="true" tabindex="-1"></a>ax2.set_ylabel(<span class="st">'Markup (η)'</span>)</span>
<span id="cb28-52"><a href="#cb28-52" aria-hidden="true" tabindex="-1"></a>ax2.set_title(<span class="st">'B. Markups'</span>)</span>
<span id="cb28-53"><a href="#cb28-53" aria-hidden="true" tabindex="-1"></a>ax2.set_xticks(x)</span>
<span id="cb28-54"><a href="#cb28-54" aria-hidden="true" tabindex="-1"></a>ax2.set_xticklabels(products_q)</span>
<span id="cb28-55"><a href="#cb28-55" aria-hidden="true" tabindex="-1"></a>ax2.legend(loc<span class="op">=</span><span class="st">'upper left'</span>)</span>
<span id="cb28-56"><a href="#cb28-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-57"><a href="#cb28-57" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, (pre, post) <span class="kw">in</span> <span class="bu">enumerate</span>(<span class="bu">zip</span>(result_pre_q.markups, result_post_q.markups)):</span>
<span id="cb28-58"><a href="#cb28-58" aria-hidden="true" tabindex="-1"></a>    change <span class="op">=</span> post <span class="op">-</span> pre</span>
<span id="cb28-59"><a href="#cb28-59" aria-hidden="true" tabindex="-1"></a>    ax2.annotate(<span class="ss">f'</span><span class="sc">{</span>change<span class="sc">:+.3f}</span><span class="ss">'</span>, xy<span class="op">=</span>(i <span class="op">+</span> width<span class="op">/</span><span class="dv">2</span>, post <span class="op">+</span> <span class="fl">0.05</span>), ha<span class="op">=</span><span class="st">'center'</span>, fontsize<span class="op">=</span><span class="dv">9</span>,</span>
<span id="cb28-60"><a href="#cb28-60" aria-hidden="true" tabindex="-1"></a>                 color<span class="op">=</span><span class="st">'red'</span> <span class="cf">if</span> change <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> <span class="st">'green'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb28-61"><a href="#cb28-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-62"><a href="#cb28-62" aria-hidden="true" tabindex="-1"></a><span class="co"># Panel C: Market Shares</span></span>
<span id="cb28-63"><a href="#cb28-63" aria-hidden="true" tabindex="-1"></a>ax3 <span class="op">=</span> axes[<span class="dv">2</span>]</span>
<span id="cb28-64"><a href="#cb28-64" aria-hidden="true" tabindex="-1"></a>bars5 <span class="op">=</span> ax3.bar(x <span class="op">-</span> width<span class="op">/</span><span class="dv">2</span>, result_pre_q.shares, width, label<span class="op">=</span><span class="st">'Pre-Merger'</span>, color<span class="op">=</span>[<span class="st">'#3498db'</span>, <span class="st">'#2ecc71'</span>, <span class="st">'#e74c3c'</span>], alpha<span class="op">=</span><span class="fl">0.6</span>, edgecolor<span class="op">=</span><span class="st">'black'</span>)</span>
<span id="cb28-65"><a href="#cb28-65" aria-hidden="true" tabindex="-1"></a>bars6 <span class="op">=</span> ax3.bar(x <span class="op">+</span> width<span class="op">/</span><span class="dv">2</span>, result_post_q.shares, width, label<span class="op">=</span><span class="st">'Post-Merger'</span>, color<span class="op">=</span>[<span class="st">'#3498db'</span>, <span class="st">'#27ae60'</span>, <span class="st">'#c0392b'</span>], alpha<span class="op">=</span><span class="fl">0.9</span>, edgecolor<span class="op">=</span><span class="st">'black'</span>)</span>
<span id="cb28-66"><a href="#cb28-66" aria-hidden="true" tabindex="-1"></a>ax3.set_ylabel(<span class="st">'Market Share'</span>)</span>
<span id="cb28-67"><a href="#cb28-67" aria-hidden="true" tabindex="-1"></a>ax3.set_title(<span class="st">'C. Market Shares'</span>)</span>
<span id="cb28-68"><a href="#cb28-68" aria-hidden="true" tabindex="-1"></a>ax3.set_xticks(x)</span>
<span id="cb28-69"><a href="#cb28-69" aria-hidden="true" tabindex="-1"></a>ax3.set_xticklabels(products_q)</span>
<span id="cb28-70"><a href="#cb28-70" aria-hidden="true" tabindex="-1"></a>ax3.legend(loc<span class="op">=</span><span class="st">'upper right'</span>)</span>
<span id="cb28-71"><a href="#cb28-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-72"><a href="#cb28-72" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, (pre, post) <span class="kw">in</span> <span class="bu">enumerate</span>(<span class="bu">zip</span>(result_pre_q.shares, result_post_q.shares)):</span>
<span id="cb28-73"><a href="#cb28-73" aria-hidden="true" tabindex="-1"></a>    change <span class="op">=</span> post <span class="op">-</span> pre</span>
<span id="cb28-74"><a href="#cb28-74" aria-hidden="true" tabindex="-1"></a>    ax3.annotate(<span class="ss">f'</span><span class="sc">{</span>change<span class="sc">:+.3f}</span><span class="ss">'</span>, xy<span class="op">=</span>(i <span class="op">+</span> width<span class="op">/</span><span class="dv">2</span>, post <span class="op">+</span> <span class="fl">0.01</span>), ha<span class="op">=</span><span class="st">'center'</span>, fontsize<span class="op">=</span><span class="dv">9</span>,</span>
<span id="cb28-75"><a href="#cb28-75" aria-hidden="true" tabindex="-1"></a>                 color<span class="op">=</span><span class="st">'red'</span> <span class="cf">if</span> change <span class="op">&gt;</span> <span class="dv">0</span> <span class="cf">else</span> <span class="st">'green'</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb28-76"><a href="#cb28-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-77"><a href="#cb28-77" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb28-78"><a href="#cb28-78" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb28-79"><a href="#cb28-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-80"><a href="#cb28-80" aria-hidden="true" tabindex="-1"></a><span class="co"># Summary</span></span>
<span id="cb28-81"><a href="#cb28-81" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Merger Impact Summary:"</span>)</span>
<span id="cb28-82"><a href="#cb28-82" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"-"</span> <span class="op">*</span> <span class="dv">60</span>)</span>
<span id="cb28-83"><a href="#cb28-83" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span><span class="st">'Metric'</span><span class="sc">:&lt;30}</span><span class="ss"> </span><span class="sc">{</span><span class="st">'Pre-Merger'</span><span class="sc">:&lt;12}</span><span class="ss"> </span><span class="sc">{</span><span class="st">'Post-Merger'</span><span class="sc">:&lt;12}</span><span class="ss"> </span><span class="sc">{</span><span class="st">'Change'</span><span class="sc">:&lt;12}</span><span class="ss">"</span>)</span>
<span id="cb28-84"><a href="#cb28-84" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"-"</span> <span class="op">*</span> <span class="dv">60</span>)</span>
<span id="cb28-85"><a href="#cb28-85" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span><span class="st">'Price (Low quality)'</span><span class="sc">:&lt;30}</span><span class="ss"> </span><span class="sc">{</span>result_pre_q<span class="sc">.</span>prices[<span class="dv">0</span>]<span class="sc">:&lt;12.4f}</span><span class="ss"> </span><span class="sc">{</span>result_post_q<span class="sc">.</span>prices[<span class="dv">0</span>]<span class="sc">:&lt;12.4f}</span><span class="ss"> </span><span class="sc">{</span>result_post_q<span class="sc">.</span>prices[<span class="dv">0</span>] <span class="op">-</span> result_pre_q<span class="sc">.</span>prices[<span class="dv">0</span>]<span class="sc">:+.4f}</span><span class="ss">"</span>)</span>
<span id="cb28-86"><a href="#cb28-86" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span><span class="st">'Price (Medium - acquired)'</span><span class="sc">:&lt;30}</span><span class="ss"> </span><span class="sc">{</span>result_pre_q<span class="sc">.</span>prices[<span class="dv">1</span>]<span class="sc">:&lt;12.4f}</span><span class="ss"> </span><span class="sc">{</span>result_post_q<span class="sc">.</span>prices[<span class="dv">1</span>]<span class="sc">:&lt;12.4f}</span><span class="ss"> </span><span class="sc">{</span>result_post_q<span class="sc">.</span>prices[<span class="dv">1</span>] <span class="op">-</span> result_pre_q<span class="sc">.</span>prices[<span class="dv">1</span>]<span class="sc">:+.4f}</span><span class="ss">"</span>)</span>
<span id="cb28-87"><a href="#cb28-87" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span><span class="st">'Price (High - acquirer)'</span><span class="sc">:&lt;30}</span><span class="ss"> </span><span class="sc">{</span>result_pre_q<span class="sc">.</span>prices[<span class="dv">2</span>]<span class="sc">:&lt;12.4f}</span><span class="ss"> </span><span class="sc">{</span>result_post_q<span class="sc">.</span>prices[<span class="dv">2</span>]<span class="sc">:&lt;12.4f}</span><span class="ss"> </span><span class="sc">{</span>result_post_q<span class="sc">.</span>prices[<span class="dv">2</span>] <span class="op">-</span> result_pre_q<span class="sc">.</span>prices[<span class="dv">2</span>]<span class="sc">:+.4f}</span><span class="ss">"</span>)</span>
<span id="cb28-88"><a href="#cb28-88" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span><span class="st">'Combined share (merged)'</span><span class="sc">:&lt;30}</span><span class="ss"> </span><span class="sc">{</span>result_pre_q<span class="sc">.</span>shares[<span class="dv">1</span>]<span class="op">+</span>result_pre_q<span class="sc">.</span>shares[<span class="dv">2</span>]<span class="sc">:&lt;12.4f}</span><span class="ss"> </span><span class="sc">{</span>result_post_q<span class="sc">.</span>shares[<span class="dv">1</span>]<span class="op">+</span>result_post_q<span class="sc">.</span>shares[<span class="dv">2</span>]<span class="sc">:&lt;12.4f}</span><span class="ss"> </span><span class="sc">{</span>(result_post_q.shares[<span class="dv">1</span>]<span class="op">+</span>result_post_q.shares[<span class="dv">2</span>]) <span class="op">-</span> (result_pre_q.shares[<span class="dv">1</span>]<span class="op">+</span>result_pre_q.shares[<span class="dv">2</span>])<span class="sc">:+.4f}</span><span class="ss">"</span>)</span>
<span id="cb28-89"><a href="#cb28-89" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span><span class="st">'Share (Low - outsider)'</span><span class="sc">:&lt;30}</span><span class="ss"> </span><span class="sc">{</span>result_pre_q<span class="sc">.</span>shares[<span class="dv">0</span>]<span class="sc">:&lt;12.4f}</span><span class="ss"> </span><span class="sc">{</span>result_post_q<span class="sc">.</span>shares[<span class="dv">0</span>]<span class="sc">:&lt;12.4f}</span><span class="ss"> </span><span class="sc">{</span>result_post_q<span class="sc">.</span>shares[<span class="dv">0</span>] <span class="op">-</span> result_pre_q<span class="sc">.</span>shares[<span class="dv">0</span>]<span class="sc">:+.4f}</span><span class="ss">"</span>)</span>
<span id="cb28-90"><a href="#cb28-90" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>()</span>
<span id="cb28-91"><a href="#cb28-91" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Interpretation:"</span>)</span>
<span id="cb28-92"><a href="#cb28-92" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"• Merged products (Medium + High) both raise prices"</span>)</span>
<span id="cb28-93"><a href="#cb28-93" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"• High-quality product raises price MORE (internalizes stealing from Medium)"</span>)</span>
<span id="cb28-94"><a href="#cb28-94" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"• Low-quality outsider benefits: gains share as merged products become expensive"</span>)</span>
<span id="cb28-95"><a href="#cb28-95" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"• Consumers harmed: higher prices, some switch to outside option"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>============================================================
ASYMMETRIC MERGER IN QUALITY-DIFFERENTIATED MARKET
High-quality firm acquires Medium-quality product
============================================================</code></pre>
</div>
<div class="cell-output cell-output-display">
<div id="quality-merger-analysis" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="solve_opm_files/figure-html/quality-merger-analysis-output-2.png" width="1331" height="467" class="figure-img"></p>
<figcaption>Merger Analysis in Quality-Differentiated Market</figcaption>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
Merger Impact Summary:
------------------------------------------------------------
Metric                         Pre-Merger   Post-Merger  Change      
------------------------------------------------------------
Price (Low quality)            1.6313       1.6552       +0.0238
Price (Medium - acquired)      1.7139       2.2835       +0.5696
Price (High - acquirer)        2.0336       2.2835       +0.2499
Combined share (merged)        0.5241       0.4393       -0.0848
Share (Low - outsider)         0.1161       0.1343       +0.0182

Interpretation:
• Merged products (Medium + High) both raise prices
• High-quality product raises price MORE (internalizes stealing from Medium)
• Low-quality outsider benefits: gains share as merged products become expensive
• Consumers harmed: higher prices, some switch to outside option</code></pre>
</div>
</div>
</section>
<section id="scenario-3-cost-differentiation-only-1" class="level3">
<h3 class="anchored" data-anchor-id="scenario-3-cost-differentiation-only-1">Scenario 3: Cost Differentiation Only</h3>
<div id="cost-differentiation-setup" class="cell" data-execution_count="13">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load scenario from config (DRY principle)</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>sc_cost <span class="op">=</span> config.SCENARIOS[<span class="st">"cost"</span>]</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>delta_cost <span class="op">=</span> sc_cost[<span class="st">"delta"</span>]</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>costs_cost <span class="op">=</span> sc_cost[<span class="st">"costs"</span>]</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>ownership_cost <span class="op">=</span> sc_cost[<span class="st">"ownership"</span>]</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>alpha_cost <span class="op">=</span> sc_cost[<span class="st">"alpha"</span>]</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Solve equilibrium</span></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>result_cost <span class="op">=</span> solve_equilibrium_prices(</span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>    delta<span class="op">=</span>delta_cost,</span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>    alpha<span class="op">=</span>alpha_cost,</span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>    costs<span class="op">=</span>costs_cost,</span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>    ownership<span class="op">=</span>ownership_cost,</span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">60</span>)</span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"SCENARIO 3: COST DIFFERENTIATION"</span>)</span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"δ constant, c varies"</span>)</span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">60</span>)</span>
<span id="cb31-20"><a href="#cb31-20" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>()</span>
<span id="cb31-21"><a href="#cb31-21" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Setup:"</span>)</span>
<span id="cb31-22"><a href="#cb31-22" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Mean utilities (δ):  </span><span class="sc">{</span>delta_cost<span class="sc">}</span><span class="ss">  (identical quality)"</span>)</span>
<span id="cb31-23"><a href="#cb31-23" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Marginal costs (c):  </span><span class="sc">{</span>costs_cost<span class="sc">}</span><span class="ss">  (Low, Med, High cost)"</span>)</span>
<span id="cb31-24"><a href="#cb31-24" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Price sensitivity:   α = </span><span class="sc">{</span>alpha_cost<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb31-25"><a href="#cb31-25" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>()</span>
<span id="cb31-26"><a href="#cb31-26" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Equilibrium Results:"</span>)</span>
<span id="cb31-27"><a href="#cb31-27" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"-"</span> <span class="op">*</span> <span class="dv">60</span>)</span>
<span id="cb31-28"><a href="#cb31-28" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span><span class="st">'Product'</span><span class="sc">:&lt;15}</span><span class="ss"> </span><span class="sc">{</span><span class="st">'Cost (c)'</span><span class="sc">:&lt;12}</span><span class="ss"> </span><span class="sc">{</span><span class="st">'Share'</span><span class="sc">:&lt;12}</span><span class="ss"> </span><span class="sc">{</span><span class="st">'Markup'</span><span class="sc">:&lt;12}</span><span class="ss"> </span><span class="sc">{</span><span class="st">'Price'</span><span class="sc">:&lt;12}</span><span class="ss">"</span>)</span>
<span id="cb31-29"><a href="#cb31-29" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"-"</span> <span class="op">*</span> <span class="dv">60</span>)</span>
<span id="cb31-30"><a href="#cb31-30" aria-hidden="true" tabindex="-1"></a>labels_cost <span class="op">=</span> [<span class="st">'Efficient'</span>, <span class="st">'Average'</span>, <span class="st">'Inefficient'</span>]</span>
<span id="cb31-31"><a href="#cb31-31" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">3</span>):</span>
<span id="cb31-32"><a href="#cb31-32" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>labels_cost[j]<span class="sc">:&lt;15}</span><span class="ss"> </span><span class="sc">{</span>costs_cost[j]<span class="sc">:&lt;12.2f}</span><span class="ss"> </span><span class="sc">{</span>result_cost<span class="sc">.</span>shares[j]<span class="sc">:&lt;12.4f}</span><span class="ss"> </span><span class="sc">{</span>result_cost<span class="sc">.</span>markups[j]<span class="sc">:&lt;12.4f}</span><span class="ss"> </span><span class="sc">{</span>result_cost<span class="sc">.</span>prices[j]<span class="sc">:&lt;12.4f}</span><span class="ss">"</span>)</span>
<span id="cb31-33"><a href="#cb31-33" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"-"</span> <span class="op">*</span> <span class="dv">60</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>============================================================
SCENARIO 3: COST DIFFERENTIATION
δ constant, c varies
============================================================

Setup:
  Mean utilities (δ):  [1. 1. 1.]  (identical quality)
  Marginal costs (c):  [0.3 0.5 0.7]  (Low, Med, High cost)
  Price sensitivity:   α = 1.0

Equilibrium Results:
------------------------------------------------------------
Product         Cost (c)     Share        Markup       Price       
------------------------------------------------------------
Efficient       0.30         0.2269       1.2935       1.5935      
Average         0.50         0.1954       1.2429       1.7429      
Inefficient     0.70         0.1669       1.2004       1.9004      
------------------------------------------------------------</code></pre>
</div>
</div>
<div id="cell-cost-differentiation-figure" class="cell" data-execution_count="14">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create visualization</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">4</span>, figsize<span class="op">=</span>(<span class="dv">16</span>, <span class="dv">4</span>))</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>products_cost <span class="op">=</span> [<span class="st">'Efficient</span><span class="ch">\n</span><span class="st">(c=0.3)'</span>, <span class="st">'Average</span><span class="ch">\n</span><span class="st">(c=0.5)'</span>, <span class="st">'Inefficient</span><span class="ch">\n</span><span class="st">(c=0.7)'</span>]</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> np.arange(<span class="bu">len</span>(products_cost))</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>colors_cost <span class="op">=</span> [<span class="st">'#27ae60'</span>, <span class="st">'#f39c12'</span>, <span class="st">'#e74c3c'</span>]  <span class="co"># Green, Yellow, Red</span></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Panel A: Costs</span></span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>ax1 <span class="op">=</span> axes[<span class="dv">0</span>]</span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>bars1 <span class="op">=</span> ax1.bar(x, costs_cost, color<span class="op">=</span>colors_cost, alpha<span class="op">=</span><span class="fl">0.8</span>, edgecolor<span class="op">=</span><span class="st">'black'</span>)</span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>ax1.set_ylabel(<span class="st">'Marginal Cost (c)'</span>)</span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>ax1.set_title(<span class="st">'A. Production Costs'</span>)</span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a>ax1.set_xticks(x)</span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a>ax1.set_xticklabels(products_cost)</span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a>ax1.set_ylim(<span class="dv">0</span>, <span class="fl">1.0</span>)</span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Panel B: Prices</span></span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a>ax2 <span class="op">=</span> axes[<span class="dv">1</span>]</span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true" tabindex="-1"></a>bars2 <span class="op">=</span> ax2.bar(x, result_cost.prices, color<span class="op">=</span>colors_cost, alpha<span class="op">=</span><span class="fl">0.8</span>, edgecolor<span class="op">=</span><span class="st">'black'</span>)</span>
<span id="cb33-20"><a href="#cb33-20" aria-hidden="true" tabindex="-1"></a>ax2.set_ylabel(<span class="st">'Price (p)'</span>)</span>
<span id="cb33-21"><a href="#cb33-21" aria-hidden="true" tabindex="-1"></a>ax2.set_title(<span class="st">'B. Equilibrium Prices'</span>)</span>
<span id="cb33-22"><a href="#cb33-22" aria-hidden="true" tabindex="-1"></a>ax2.set_xticks(x)</span>
<span id="cb33-23"><a href="#cb33-23" aria-hidden="true" tabindex="-1"></a>ax2.set_xticklabels(products_cost)</span>
<span id="cb33-24"><a href="#cb33-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-25"><a href="#cb33-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Panel C: Market Shares</span></span>
<span id="cb33-26"><a href="#cb33-26" aria-hidden="true" tabindex="-1"></a>ax3 <span class="op">=</span> axes[<span class="dv">2</span>]</span>
<span id="cb33-27"><a href="#cb33-27" aria-hidden="true" tabindex="-1"></a>bars3 <span class="op">=</span> ax3.bar(x, result_cost.shares, color<span class="op">=</span>colors_cost, alpha<span class="op">=</span><span class="fl">0.8</span>, edgecolor<span class="op">=</span><span class="st">'black'</span>)</span>
<span id="cb33-28"><a href="#cb33-28" aria-hidden="true" tabindex="-1"></a>ax3.set_ylabel(<span class="st">'Market Share (s)'</span>)</span>
<span id="cb33-29"><a href="#cb33-29" aria-hidden="true" tabindex="-1"></a>ax3.set_title(<span class="st">'C. Market Shares'</span>)</span>
<span id="cb33-30"><a href="#cb33-30" aria-hidden="true" tabindex="-1"></a>ax3.set_xticks(x)</span>
<span id="cb33-31"><a href="#cb33-31" aria-hidden="true" tabindex="-1"></a>ax3.set_xticklabels(products_cost)</span>
<span id="cb33-32"><a href="#cb33-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-33"><a href="#cb33-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Panel D: Markups</span></span>
<span id="cb33-34"><a href="#cb33-34" aria-hidden="true" tabindex="-1"></a>ax4 <span class="op">=</span> axes[<span class="dv">3</span>]</span>
<span id="cb33-35"><a href="#cb33-35" aria-hidden="true" tabindex="-1"></a>bars4 <span class="op">=</span> ax4.bar(x, result_cost.markups, color<span class="op">=</span>colors_cost, alpha<span class="op">=</span><span class="fl">0.8</span>, edgecolor<span class="op">=</span><span class="st">'black'</span>)</span>
<span id="cb33-36"><a href="#cb33-36" aria-hidden="true" tabindex="-1"></a>ax4.set_ylabel(<span class="st">'Markup (η = p - c)'</span>)</span>
<span id="cb33-37"><a href="#cb33-37" aria-hidden="true" tabindex="-1"></a>ax4.set_title(<span class="st">'D. Markups'</span>)</span>
<span id="cb33-38"><a href="#cb33-38" aria-hidden="true" tabindex="-1"></a>ax4.set_xticks(x)</span>
<span id="cb33-39"><a href="#cb33-39" aria-hidden="true" tabindex="-1"></a>ax4.set_xticklabels(products_cost)</span>
<span id="cb33-40"><a href="#cb33-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-41"><a href="#cb33-41" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb33-42"><a href="#cb33-42" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb33-43"><a href="#cb33-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-44"><a href="#cb33-44" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Key Insights:"</span>)</span>
<span id="cb33-45"><a href="#cb33-45" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"• Lower cost → lower price → higher share → higher markup"</span>)</span>
<span id="cb33-46"><a href="#cb33-46" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"• Efficient firm's advantage is PARTIALLY offset by higher markup"</span>)</span>
<span id="cb33-47"><a href="#cb33-47" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"• Price differences are SMALLER than cost differences:"</span>)</span>
<span id="cb33-48"><a href="#cb33-48" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Cost gap (Inefficient - Efficient): </span><span class="sc">{</span>costs_cost[<span class="dv">2</span>] <span class="op">-</span> costs_cost[<span class="dv">0</span>]<span class="sc">:.2f}</span><span class="ss">"</span>)</span>
<span id="cb33-49"><a href="#cb33-49" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Price gap (Inefficient - Efficient): </span><span class="sc">{</span>result_cost<span class="sc">.</span>prices[<span class="dv">2</span>] <span class="op">-</span> result_cost<span class="sc">.</span>prices[<span class="dv">0</span>]<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb33-50"><a href="#cb33-50" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  → Efficient firm captures some cost advantage as profit"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="cost-differentiation-figure" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="solve_opm_files/figure-html/cost-differentiation-figure-output-1.png" width="1523" height="371" class="figure-img"></p>
<figcaption>Cost Differentiation: Lower Cost → Lower Price → Higher Share → Higher Markup</figcaption>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
Key Insights:
• Lower cost → lower price → higher share → higher markup
• Efficient firm's advantage is PARTIALLY offset by higher markup
• Price differences are SMALLER than cost differences:
  Cost gap (Inefficient - Efficient): 0.40
  Price gap (Inefficient - Efficient): 0.3069
  → Efficient firm captures some cost advantage as profit</code></pre>
</div>
</div>
</section>
<section id="scenario-4-vertical-differentiation" class="level3">
<h3 class="anchored" data-anchor-id="scenario-4-vertical-differentiation">Scenario 4: Vertical Differentiation</h3>
<div id="vertical-differentiation-setup" class="cell" data-execution_count="15">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load scenario from config (DRY principle)</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>sc_vert <span class="op">=</span> config.SCENARIOS[<span class="st">"vertical"</span>]</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>delta_vert <span class="op">=</span> sc_vert[<span class="st">"delta"</span>]</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>costs_vert <span class="op">=</span> sc_vert[<span class="st">"costs"</span>]</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>ownership_vert <span class="op">=</span> sc_vert[<span class="st">"ownership"</span>]</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>alpha_vert <span class="op">=</span> sc_vert[<span class="st">"alpha"</span>]</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Solve equilibrium</span></span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>result_vert <span class="op">=</span> solve_equilibrium_prices(</span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>    delta<span class="op">=</span>delta_vert,</span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>    alpha<span class="op">=</span>alpha_vert,</span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a>    costs<span class="op">=</span>costs_vert,</span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a>    ownership<span class="op">=</span>ownership_vert,</span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">60</span>)</span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"SCENARIO 4: VERTICAL DIFFERENTIATION"</span>)</span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"δ and c positively correlated (higher quality costs more)"</span>)</span>
<span id="cb35-19"><a href="#cb35-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">60</span>)</span>
<span id="cb35-20"><a href="#cb35-20" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>()</span>
<span id="cb35-21"><a href="#cb35-21" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Setup:"</span>)</span>
<span id="cb35-22"><a href="#cb35-22" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Mean utilities (δ):  </span><span class="sc">{</span>delta_vert<span class="sc">}</span><span class="ss">  (quality gradient)"</span>)</span>
<span id="cb35-23"><a href="#cb35-23" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Marginal costs (c):  </span><span class="sc">{</span>costs_vert<span class="sc">}</span><span class="ss">  (correlated with quality)"</span>)</span>
<span id="cb35-24"><a href="#cb35-24" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Price sensitivity:   α = </span><span class="sc">{</span>alpha_vert<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb35-25"><a href="#cb35-25" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>()</span>
<span id="cb35-26"><a href="#cb35-26" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Equilibrium Results:"</span>)</span>
<span id="cb35-27"><a href="#cb35-27" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"-"</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb35-28"><a href="#cb35-28" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span><span class="st">'Product'</span><span class="sc">:&lt;12}</span><span class="ss"> </span><span class="sc">{</span><span class="st">'Quality (δ)'</span><span class="sc">:&lt;12}</span><span class="ss"> </span><span class="sc">{</span><span class="st">'Cost (c)'</span><span class="sc">:&lt;12}</span><span class="ss"> </span><span class="sc">{</span><span class="st">'Share'</span><span class="sc">:&lt;12}</span><span class="ss"> </span><span class="sc">{</span><span class="st">'Markup'</span><span class="sc">:&lt;12}</span><span class="ss"> </span><span class="sc">{</span><span class="st">'Price'</span><span class="sc">:&lt;12}</span><span class="ss">"</span>)</span>
<span id="cb35-29"><a href="#cb35-29" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"-"</span> <span class="op">*</span> <span class="dv">70</span>)</span>
<span id="cb35-30"><a href="#cb35-30" aria-hidden="true" tabindex="-1"></a>labels_vert <span class="op">=</span> [<span class="st">'Economy'</span>, <span class="st">'Standard'</span>, <span class="st">'Premium'</span>]</span>
<span id="cb35-31"><a href="#cb35-31" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">3</span>):</span>
<span id="cb35-32"><a href="#cb35-32" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>labels_vert[j]<span class="sc">:&lt;12}</span><span class="ss"> </span><span class="sc">{</span>delta_vert[j]<span class="sc">:&lt;12.1f}</span><span class="ss"> </span><span class="sc">{</span>costs_vert[j]<span class="sc">:&lt;12.2f}</span><span class="ss"> </span><span class="sc">{</span>result_vert<span class="sc">.</span>shares[j]<span class="sc">:&lt;12.4f}</span><span class="ss"> </span><span class="sc">{</span>result_vert<span class="sc">.</span>markups[j]<span class="sc">:&lt;12.4f}</span><span class="ss"> </span><span class="sc">{</span>result_vert<span class="sc">.</span>prices[j]<span class="sc">:&lt;12.4f}</span><span class="ss">"</span>)</span>
<span id="cb35-33"><a href="#cb35-33" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"-"</span> <span class="op">*</span> <span class="dv">70</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>============================================================
SCENARIO 4: VERTICAL DIFFERENTIATION
δ and c positively correlated (higher quality costs more)
============================================================

Setup:
  Mean utilities (δ):  [0.5 1.  2. ]  (quality gradient)
  Marginal costs (c):  [0.3 0.5 0.8]  (correlated with quality)
  Price sensitivity:   α = 1.0

Equilibrium Results:
----------------------------------------------------------------------
Product      Quality (δ)  Cost (c)     Share        Markup       Price       
----------------------------------------------------------------------
Economy      0.5          0.30         0.1429       1.1667       1.4667      
Standard     1.0          0.50         0.1823       1.2229       1.7229      
Premium      2.0          0.80         0.2993       1.4271       2.2271      
----------------------------------------------------------------------</code></pre>
</div>
</div>
<div id="cell-vertical-differentiation-figure" class="cell" data-execution_count="16">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create visualization comparing all three products</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">4</span>, figsize<span class="op">=</span>(<span class="dv">16</span>, <span class="dv">4</span>))</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>products_vert <span class="op">=</span> [<span class="st">'Economy</span><span class="ch">\n</span><span class="st">(δ=0.5, c=0.3)'</span>, <span class="st">'Standard</span><span class="ch">\n</span><span class="st">(δ=1.0, c=0.5)'</span>, <span class="st">'Premium</span><span class="ch">\n</span><span class="st">(δ=2.0, c=0.8)'</span>]</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> np.arange(<span class="bu">len</span>(products_vert))</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>colors_vert <span class="op">=</span> [<span class="st">'#3498db'</span>, <span class="st">'#9b59b6'</span>, <span class="st">'#e74c3c'</span>]</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Panel A: Quality vs Cost</span></span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>ax1 <span class="op">=</span> axes[<span class="dv">0</span>]</span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>width <span class="op">=</span> <span class="fl">0.35</span></span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>bars1a <span class="op">=</span> ax1.bar(x <span class="op">-</span> width<span class="op">/</span><span class="dv">2</span>, delta_vert, width, label<span class="op">=</span><span class="st">'Quality (δ)'</span>, color<span class="op">=</span><span class="st">'steelblue'</span>, alpha<span class="op">=</span><span class="fl">0.8</span>)</span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a>bars1b <span class="op">=</span> ax1.bar(x <span class="op">+</span> width<span class="op">/</span><span class="dv">2</span>, costs_vert, width, label<span class="op">=</span><span class="st">'Cost (c)'</span>, color<span class="op">=</span><span class="st">'coral'</span>, alpha<span class="op">=</span><span class="fl">0.8</span>)</span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a>ax1.set_ylabel(<span class="st">'Value'</span>)</span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a>ax1.set_title(<span class="st">'A. Quality vs Cost'</span>)</span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a>ax1.set_xticks(x)</span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a>ax1.set_xticklabels([<span class="st">'Economy'</span>, <span class="st">'Standard'</span>, <span class="st">'Premium'</span>])</span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a>ax1.legend()</span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-19"><a href="#cb37-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Panel B: Market Shares</span></span>
<span id="cb37-20"><a href="#cb37-20" aria-hidden="true" tabindex="-1"></a>ax2 <span class="op">=</span> axes[<span class="dv">1</span>]</span>
<span id="cb37-21"><a href="#cb37-21" aria-hidden="true" tabindex="-1"></a>bars2 <span class="op">=</span> ax2.bar(x, result_vert.shares, color<span class="op">=</span>colors_vert, alpha<span class="op">=</span><span class="fl">0.8</span>, edgecolor<span class="op">=</span><span class="st">'black'</span>)</span>
<span id="cb37-22"><a href="#cb37-22" aria-hidden="true" tabindex="-1"></a>ax2.set_ylabel(<span class="st">'Market Share (s)'</span>)</span>
<span id="cb37-23"><a href="#cb37-23" aria-hidden="true" tabindex="-1"></a>ax2.set_title(<span class="st">'B. Market Shares'</span>)</span>
<span id="cb37-24"><a href="#cb37-24" aria-hidden="true" tabindex="-1"></a>ax2.set_xticks(x)</span>
<span id="cb37-25"><a href="#cb37-25" aria-hidden="true" tabindex="-1"></a>ax2.set_xticklabels([<span class="st">'Economy'</span>, <span class="st">'Standard'</span>, <span class="st">'Premium'</span>])</span>
<span id="cb37-26"><a href="#cb37-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-27"><a href="#cb37-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Panel C: Markups</span></span>
<span id="cb37-28"><a href="#cb37-28" aria-hidden="true" tabindex="-1"></a>ax3 <span class="op">=</span> axes[<span class="dv">2</span>]</span>
<span id="cb37-29"><a href="#cb37-29" aria-hidden="true" tabindex="-1"></a>bars3 <span class="op">=</span> ax3.bar(x, result_vert.markups, color<span class="op">=</span>colors_vert, alpha<span class="op">=</span><span class="fl">0.8</span>, edgecolor<span class="op">=</span><span class="st">'black'</span>)</span>
<span id="cb37-30"><a href="#cb37-30" aria-hidden="true" tabindex="-1"></a>ax3.set_ylabel(<span class="st">'Markup (η)'</span>)</span>
<span id="cb37-31"><a href="#cb37-31" aria-hidden="true" tabindex="-1"></a>ax3.set_title(<span class="st">'C. Markups'</span>)</span>
<span id="cb37-32"><a href="#cb37-32" aria-hidden="true" tabindex="-1"></a>ax3.set_xticks(x)</span>
<span id="cb37-33"><a href="#cb37-33" aria-hidden="true" tabindex="-1"></a>ax3.set_xticklabels([<span class="st">'Economy'</span>, <span class="st">'Standard'</span>, <span class="st">'Premium'</span>])</span>
<span id="cb37-34"><a href="#cb37-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-35"><a href="#cb37-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Panel D: Price Decomposition</span></span>
<span id="cb37-36"><a href="#cb37-36" aria-hidden="true" tabindex="-1"></a>ax4 <span class="op">=</span> axes[<span class="dv">3</span>]</span>
<span id="cb37-37"><a href="#cb37-37" aria-hidden="true" tabindex="-1"></a>bars4a <span class="op">=</span> ax4.bar(x, costs_vert, color<span class="op">=</span><span class="st">'lightgray'</span>, alpha<span class="op">=</span><span class="fl">0.8</span>, edgecolor<span class="op">=</span><span class="st">'black'</span>, label<span class="op">=</span><span class="st">'Cost'</span>)</span>
<span id="cb37-38"><a href="#cb37-38" aria-hidden="true" tabindex="-1"></a>bars4b <span class="op">=</span> ax4.bar(x, result_vert.markups, bottom<span class="op">=</span>costs_vert, color<span class="op">=</span>colors_vert, alpha<span class="op">=</span><span class="fl">0.8</span>, edgecolor<span class="op">=</span><span class="st">'black'</span>, label<span class="op">=</span><span class="st">'Markup'</span>)</span>
<span id="cb37-39"><a href="#cb37-39" aria-hidden="true" tabindex="-1"></a>ax4.set_ylabel(<span class="st">'Price (p = c + η)'</span>)</span>
<span id="cb37-40"><a href="#cb37-40" aria-hidden="true" tabindex="-1"></a>ax4.set_title(<span class="st">'D. Price Decomposition'</span>)</span>
<span id="cb37-41"><a href="#cb37-41" aria-hidden="true" tabindex="-1"></a>ax4.set_xticks(x)</span>
<span id="cb37-42"><a href="#cb37-42" aria-hidden="true" tabindex="-1"></a>ax4.set_xticklabels([<span class="st">'Economy'</span>, <span class="st">'Standard'</span>, <span class="st">'Premium'</span>])</span>
<span id="cb37-43"><a href="#cb37-43" aria-hidden="true" tabindex="-1"></a>ax4.legend()</span>
<span id="cb37-44"><a href="#cb37-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-45"><a href="#cb37-45" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb37-46"><a href="#cb37-46" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb37-47"><a href="#cb37-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-48"><a href="#cb37-48" aria-hidden="true" tabindex="-1"></a><span class="co"># Analysis</span></span>
<span id="cb37-49"><a href="#cb37-49" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Price Premium Analysis:"</span>)</span>
<span id="cb37-50"><a href="#cb37-50" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"-"</span> <span class="op">*</span> <span class="dv">60</span>)</span>
<span id="cb37-51"><a href="#cb37-51" aria-hidden="true" tabindex="-1"></a>price_gap <span class="op">=</span> result_vert.prices[<span class="dv">2</span>] <span class="op">-</span> result_vert.prices[<span class="dv">0</span>]</span>
<span id="cb37-52"><a href="#cb37-52" aria-hidden="true" tabindex="-1"></a>cost_gap <span class="op">=</span> costs_vert[<span class="dv">2</span>] <span class="op">-</span> costs_vert[<span class="dv">0</span>]</span>
<span id="cb37-53"><a href="#cb37-53" aria-hidden="true" tabindex="-1"></a>markup_gap <span class="op">=</span> result_vert.markups[<span class="dv">2</span>] <span class="op">-</span> result_vert.markups[<span class="dv">0</span>]</span>
<span id="cb37-54"><a href="#cb37-54" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Premium vs Economy price gap:  </span><span class="sc">{</span>price_gap<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb37-55"><a href="#cb37-55" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Due to cost difference:      </span><span class="sc">{</span>cost_gap<span class="sc">:.4f}</span><span class="ss"> (</span><span class="sc">{</span><span class="dv">100</span><span class="op">*</span>cost_gap<span class="op">/</span>price_gap<span class="sc">:.1f}</span><span class="ss">%)"</span>)</span>
<span id="cb37-56"><a href="#cb37-56" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Due to markup difference:    </span><span class="sc">{</span>markup_gap<span class="sc">:.4f}</span><span class="ss"> (</span><span class="sc">{</span><span class="dv">100</span><span class="op">*</span>markup_gap<span class="op">/</span>price_gap<span class="sc">:.1f}</span><span class="ss">%)"</span>)</span>
<span id="cb37-57"><a href="#cb37-57" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>()</span>
<span id="cb37-58"><a href="#cb37-58" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Key Insight: Price gap EXCEEDS cost gap because premium products"</span>)</span>
<span id="cb37-59"><a href="#cb37-59" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"also have higher markups (due to higher market share → more market power)"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="vertical-differentiation-figure" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="solve_opm_files/figure-html/vertical-differentiation-figure-output-1.png" width="1523" height="371" class="figure-img"></p>
<figcaption>Vertical Differentiation: Economy vs Standard vs Premium Products</figcaption>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
Price Premium Analysis:
------------------------------------------------------------
Premium vs Economy price gap:  0.7604
  Due to cost difference:      0.5000 (65.8%)
  Due to markup difference:    0.2604 (34.2%)

Key Insight: Price gap EXCEEDS cost gap because premium products
also have higher markups (due to higher market share → more market power)</code></pre>
</div>
</div>
</section>
<section id="scenario-5-general-heterogeneous-products-1" class="level3">
<h3 class="anchored" data-anchor-id="scenario-5-general-heterogeneous-products-1">Scenario 5: General Heterogeneous Products</h3>
<div id="general-heterogeneous-setup" class="cell" data-execution_count="17">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load scenario from config (DRY principle)</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Product A: High quality, Low cost (Dominant)</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Product B: Low quality, High cost (Weak)</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Product C: Medium quality, Medium cost (Average)</span></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>sc_gen <span class="op">=</span> config.SCENARIOS[<span class="st">"general"</span>]</span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>delta_gen <span class="op">=</span> sc_gen[<span class="st">"delta"</span>]</span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>costs_gen <span class="op">=</span> sc_gen[<span class="st">"costs"</span>]</span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>ownership_gen <span class="op">=</span> sc_gen[<span class="st">"ownership"</span>]</span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>alpha_gen <span class="op">=</span> sc_gen[<span class="st">"alpha"</span>]</span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Solve equilibrium</span></span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a>result_gen <span class="op">=</span> solve_equilibrium_prices(</span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a>    delta<span class="op">=</span>delta_gen,</span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a>    alpha<span class="op">=</span>alpha_gen,</span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a>    costs<span class="op">=</span>costs_gen,</span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a>    ownership<span class="op">=</span>ownership_gen,</span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-19"><a href="#cb39-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">60</span>)</span>
<span id="cb39-20"><a href="#cb39-20" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"SCENARIO 5: GENERAL HETEROGENEOUS PRODUCTS"</span>)</span>
<span id="cb39-21"><a href="#cb39-21" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"δ and c vary independently"</span>)</span>
<span id="cb39-22"><a href="#cb39-22" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">60</span>)</span>
<span id="cb39-23"><a href="#cb39-23" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>()</span>
<span id="cb39-24"><a href="#cb39-24" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Setup:"</span>)</span>
<span id="cb39-25"><a href="#cb39-25" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Product A (Dominant): δ=</span><span class="sc">{</span>delta_gen[<span class="dv">0</span>]<span class="sc">}</span><span class="ss">, c=</span><span class="sc">{</span>costs_gen[<span class="dv">0</span>]<span class="sc">}</span><span class="ss"> (high quality, low cost)"</span>)</span>
<span id="cb39-26"><a href="#cb39-26" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Product B (Weak):     δ=</span><span class="sc">{</span>delta_gen[<span class="dv">1</span>]<span class="sc">}</span><span class="ss">, c=</span><span class="sc">{</span>costs_gen[<span class="dv">1</span>]<span class="sc">}</span><span class="ss"> (low quality, high cost)"</span>)</span>
<span id="cb39-27"><a href="#cb39-27" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Product C (Average):  δ=</span><span class="sc">{</span>delta_gen[<span class="dv">2</span>]<span class="sc">}</span><span class="ss">, c=</span><span class="sc">{</span>costs_gen[<span class="dv">2</span>]<span class="sc">}</span><span class="ss"> (medium quality, medium cost)"</span>)</span>
<span id="cb39-28"><a href="#cb39-28" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>()</span>
<span id="cb39-29"><a href="#cb39-29" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Equilibrium Results:"</span>)</span>
<span id="cb39-30"><a href="#cb39-30" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"-"</span> <span class="op">*</span> <span class="dv">80</span>)</span>
<span id="cb39-31"><a href="#cb39-31" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span><span class="st">'Product'</span><span class="sc">:&lt;12}</span><span class="ss"> </span><span class="sc">{</span><span class="st">'Quality (δ)'</span><span class="sc">:&lt;12}</span><span class="ss"> </span><span class="sc">{</span><span class="st">'Cost (c)'</span><span class="sc">:&lt;10}</span><span class="ss"> </span><span class="sc">{</span><span class="st">'Share'</span><span class="sc">:&lt;12}</span><span class="ss"> </span><span class="sc">{</span><span class="st">'Markup'</span><span class="sc">:&lt;12}</span><span class="ss"> </span><span class="sc">{</span><span class="st">'Price'</span><span class="sc">:&lt;10}</span><span class="ss"> </span><span class="sc">{</span><span class="st">'Profit/unit'</span><span class="sc">:&lt;12}</span><span class="ss">"</span>)</span>
<span id="cb39-32"><a href="#cb39-32" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"-"</span> <span class="op">*</span> <span class="dv">80</span>)</span>
<span id="cb39-33"><a href="#cb39-33" aria-hidden="true" tabindex="-1"></a>labels_gen <span class="op">=</span> [<span class="st">'Dominant'</span>, <span class="st">'Weak'</span>, <span class="st">'Average'</span>]</span>
<span id="cb39-34"><a href="#cb39-34" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">3</span>):</span>
<span id="cb39-35"><a href="#cb39-35" aria-hidden="true" tabindex="-1"></a>    profit_per_unit <span class="op">=</span> result_gen.markups[j]  <span class="co"># π/q = (p-c) = η</span></span>
<span id="cb39-36"><a href="#cb39-36" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>labels_gen[j]<span class="sc">:&lt;12}</span><span class="ss"> </span><span class="sc">{</span>delta_gen[j]<span class="sc">:&lt;12.1f}</span><span class="ss"> </span><span class="sc">{</span>costs_gen[j]<span class="sc">:&lt;10.2f}</span><span class="ss"> </span><span class="sc">{</span>result_gen<span class="sc">.</span>shares[j]<span class="sc">:&lt;12.4f}</span><span class="ss"> </span><span class="sc">{</span>result_gen<span class="sc">.</span>markups[j]<span class="sc">:&lt;12.4f}</span><span class="ss"> </span><span class="sc">{</span>result_gen<span class="sc">.</span>prices[j]<span class="sc">:&lt;10.4f}</span><span class="ss"> </span><span class="sc">{</span>profit_per_unit<span class="sc">:&lt;12.4f}</span><span class="ss">"</span>)</span>
<span id="cb39-37"><a href="#cb39-37" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"-"</span> <span class="op">*</span> <span class="dv">80</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>============================================================
SCENARIO 5: GENERAL HETEROGENEOUS PRODUCTS
δ and c vary independently
============================================================

Setup:
  Product A (Dominant): δ=2.0, c=0.3 (high quality, low cost)
  Product B (Weak):     δ=0.5, c=0.7 (low quality, high cost)
  Product C (Average):  δ=1.0, c=0.5 (medium quality, medium cost)

Equilibrium Results:
--------------------------------------------------------------------------------
Product      Quality (δ)  Cost (c)   Share        Markup       Price      Profit/unit 
--------------------------------------------------------------------------------
Dominant     2.0          0.30       0.3814       1.6165       1.9165     1.6165      
Weak         0.5          0.70       0.0951       1.1051       1.8051     1.1051      
Average      1.0          0.50       0.1727       1.2087       1.7087     1.2087      
--------------------------------------------------------------------------------</code></pre>
</div>
</div>
<div id="cell-general-heterogeneous-figure" class="cell" data-execution_count="18">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create comprehensive visualization</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> plt.figure(figsize<span class="op">=</span>(<span class="dv">16</span>, <span class="dv">8</span>))</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Top row: Product characteristics and outcomes</span></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>ax1 <span class="op">=</span> fig.add_subplot(<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">1</span>)</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>ax2 <span class="op">=</span> fig.add_subplot(<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">2</span>)</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>ax3 <span class="op">=</span> fig.add_subplot(<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">3</span>)</span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Bottom row: Scatter plots and profit analysis</span></span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a>ax4 <span class="op">=</span> fig.add_subplot(<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>)</span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a>ax5 <span class="op">=</span> fig.add_subplot(<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">5</span>)</span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a>ax6 <span class="op">=</span> fig.add_subplot(<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">6</span>)</span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a>products_gen <span class="op">=</span> [<span class="st">'Dominant</span><span class="ch">\n</span><span class="st">(δ=2, c=0.3)'</span>, <span class="st">'Weak</span><span class="ch">\n</span><span class="st">(δ=0.5, c=0.7)'</span>, <span class="st">'Average</span><span class="ch">\n</span><span class="st">(δ=1, c=0.5)'</span>]</span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> np.arange(<span class="bu">len</span>(products_gen))</span>
<span id="cb41-16"><a href="#cb41-16" aria-hidden="true" tabindex="-1"></a>colors_gen <span class="op">=</span> [<span class="st">'#27ae60'</span>, <span class="st">'#e74c3c'</span>, <span class="st">'#3498db'</span>]  <span class="co"># Green, Red, Blue</span></span>
<span id="cb41-17"><a href="#cb41-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-18"><a href="#cb41-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Panel A: Quality and Cost comparison</span></span>
<span id="cb41-19"><a href="#cb41-19" aria-hidden="true" tabindex="-1"></a>width <span class="op">=</span> <span class="fl">0.35</span></span>
<span id="cb41-20"><a href="#cb41-20" aria-hidden="true" tabindex="-1"></a>bars1a <span class="op">=</span> ax1.bar(x <span class="op">-</span> width<span class="op">/</span><span class="dv">2</span>, delta_gen, width, label<span class="op">=</span><span class="st">'Quality (δ)'</span>, color<span class="op">=</span><span class="st">'steelblue'</span>, alpha<span class="op">=</span><span class="fl">0.8</span>)</span>
<span id="cb41-21"><a href="#cb41-21" aria-hidden="true" tabindex="-1"></a>bars1b <span class="op">=</span> ax1.bar(x <span class="op">+</span> width<span class="op">/</span><span class="dv">2</span>, costs_gen, width, label<span class="op">=</span><span class="st">'Cost (c)'</span>, color<span class="op">=</span><span class="st">'coral'</span>, alpha<span class="op">=</span><span class="fl">0.8</span>)</span>
<span id="cb41-22"><a href="#cb41-22" aria-hidden="true" tabindex="-1"></a>ax1.set_ylabel(<span class="st">'Value'</span>)</span>
<span id="cb41-23"><a href="#cb41-23" aria-hidden="true" tabindex="-1"></a>ax1.set_title(<span class="st">'A. Quality vs Cost'</span>)</span>
<span id="cb41-24"><a href="#cb41-24" aria-hidden="true" tabindex="-1"></a>ax1.set_xticks(x)</span>
<span id="cb41-25"><a href="#cb41-25" aria-hidden="true" tabindex="-1"></a>ax1.set_xticklabels([<span class="st">'Dominant'</span>, <span class="st">'Weak'</span>, <span class="st">'Average'</span>])</span>
<span id="cb41-26"><a href="#cb41-26" aria-hidden="true" tabindex="-1"></a>ax1.legend()</span>
<span id="cb41-27"><a href="#cb41-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-28"><a href="#cb41-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Panel B: Market Shares</span></span>
<span id="cb41-29"><a href="#cb41-29" aria-hidden="true" tabindex="-1"></a>bars2 <span class="op">=</span> ax2.bar(x, result_gen.shares, color<span class="op">=</span>colors_gen, alpha<span class="op">=</span><span class="fl">0.8</span>, edgecolor<span class="op">=</span><span class="st">'black'</span>)</span>
<span id="cb41-30"><a href="#cb41-30" aria-hidden="true" tabindex="-1"></a>ax2.set_ylabel(<span class="st">'Market Share (s)'</span>)</span>
<span id="cb41-31"><a href="#cb41-31" aria-hidden="true" tabindex="-1"></a>ax2.set_title(<span class="st">'B. Market Shares'</span>)</span>
<span id="cb41-32"><a href="#cb41-32" aria-hidden="true" tabindex="-1"></a>ax2.set_xticks(x)</span>
<span id="cb41-33"><a href="#cb41-33" aria-hidden="true" tabindex="-1"></a>ax2.set_xticklabels([<span class="st">'Dominant'</span>, <span class="st">'Weak'</span>, <span class="st">'Average'</span>])</span>
<span id="cb41-34"><a href="#cb41-34" aria-hidden="true" tabindex="-1"></a>ax2.set_ylim(<span class="dv">0</span>, <span class="fl">0.6</span>)</span>
<span id="cb41-35"><a href="#cb41-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-36"><a href="#cb41-36" aria-hidden="true" tabindex="-1"></a><span class="co"># Panel C: Prices</span></span>
<span id="cb41-37"><a href="#cb41-37" aria-hidden="true" tabindex="-1"></a>bars3 <span class="op">=</span> ax3.bar(x, result_gen.prices, color<span class="op">=</span>colors_gen, alpha<span class="op">=</span><span class="fl">0.8</span>, edgecolor<span class="op">=</span><span class="st">'black'</span>)</span>
<span id="cb41-38"><a href="#cb41-38" aria-hidden="true" tabindex="-1"></a>ax3.axhline(y<span class="op">=</span>np.mean(costs_gen), color<span class="op">=</span><span class="st">'gray'</span>, linestyle<span class="op">=</span><span class="st">':'</span>, alpha<span class="op">=</span><span class="fl">0.7</span>, label<span class="op">=</span><span class="st">'Avg cost'</span>)</span>
<span id="cb41-39"><a href="#cb41-39" aria-hidden="true" tabindex="-1"></a>ax3.set_ylabel(<span class="st">'Price (p)'</span>)</span>
<span id="cb41-40"><a href="#cb41-40" aria-hidden="true" tabindex="-1"></a>ax3.set_title(<span class="st">'C. Equilibrium Prices'</span>)</span>
<span id="cb41-41"><a href="#cb41-41" aria-hidden="true" tabindex="-1"></a>ax3.set_xticks(x)</span>
<span id="cb41-42"><a href="#cb41-42" aria-hidden="true" tabindex="-1"></a>ax3.set_xticklabels([<span class="st">'Dominant'</span>, <span class="st">'Weak'</span>, <span class="st">'Average'</span>])</span>
<span id="cb41-43"><a href="#cb41-43" aria-hidden="true" tabindex="-1"></a>ax3.legend()</span>
<span id="cb41-44"><a href="#cb41-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-45"><a href="#cb41-45" aria-hidden="true" tabindex="-1"></a><span class="co"># Panel D: Quality-Share scatter</span></span>
<span id="cb41-46"><a href="#cb41-46" aria-hidden="true" tabindex="-1"></a>ax4.scatter(delta_gen, result_gen.shares, s<span class="op">=</span><span class="dv">200</span>, c<span class="op">=</span>colors_gen, alpha<span class="op">=</span><span class="fl">0.8</span>, edgecolors<span class="op">=</span><span class="st">'black'</span>, linewidths<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb41-47"><a href="#cb41-47" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> j, label <span class="kw">in</span> <span class="bu">enumerate</span>([<span class="st">'Dominant'</span>, <span class="st">'Weak'</span>, <span class="st">'Average'</span>]):</span>
<span id="cb41-48"><a href="#cb41-48" aria-hidden="true" tabindex="-1"></a>    ax4.annotate(label, (delta_gen[j], result_gen.shares[j]), textcoords<span class="op">=</span><span class="st">"offset points"</span>, xytext<span class="op">=</span>(<span class="dv">0</span>,<span class="dv">10</span>), ha<span class="op">=</span><span class="st">'center'</span>)</span>
<span id="cb41-49"><a href="#cb41-49" aria-hidden="true" tabindex="-1"></a>ax4.set_xlabel(<span class="st">'Quality (δ)'</span>)</span>
<span id="cb41-50"><a href="#cb41-50" aria-hidden="true" tabindex="-1"></a>ax4.set_ylabel(<span class="st">'Market Share (s)'</span>)</span>
<span id="cb41-51"><a href="#cb41-51" aria-hidden="true" tabindex="-1"></a>ax4.set_title(<span class="st">'D. Quality vs Share'</span>)</span>
<span id="cb41-52"><a href="#cb41-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-53"><a href="#cb41-53" aria-hidden="true" tabindex="-1"></a><span class="co"># Panel E: Share-Markup scatter</span></span>
<span id="cb41-54"><a href="#cb41-54" aria-hidden="true" tabindex="-1"></a>ax5.scatter(result_gen.shares, result_gen.markups, s<span class="op">=</span><span class="dv">200</span>, c<span class="op">=</span>colors_gen, alpha<span class="op">=</span><span class="fl">0.8</span>, edgecolors<span class="op">=</span><span class="st">'black'</span>, linewidths<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb41-55"><a href="#cb41-55" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> j, label <span class="kw">in</span> <span class="bu">enumerate</span>([<span class="st">'Dominant'</span>, <span class="st">'Weak'</span>, <span class="st">'Average'</span>]):</span>
<span id="cb41-56"><a href="#cb41-56" aria-hidden="true" tabindex="-1"></a>    ax5.annotate(label, (result_gen.shares[j], result_gen.markups[j]), textcoords<span class="op">=</span><span class="st">"offset points"</span>, xytext<span class="op">=</span>(<span class="dv">0</span>,<span class="dv">10</span>), ha<span class="op">=</span><span class="st">'center'</span>)</span>
<span id="cb41-57"><a href="#cb41-57" aria-hidden="true" tabindex="-1"></a><span class="co"># Add theoretical line: η = 1/(α(1-s))</span></span>
<span id="cb41-58"><a href="#cb41-58" aria-hidden="true" tabindex="-1"></a>s_line <span class="op">=</span> np.linspace(<span class="fl">0.05</span>, <span class="fl">0.5</span>, <span class="dv">50</span>)</span>
<span id="cb41-59"><a href="#cb41-59" aria-hidden="true" tabindex="-1"></a>eta_line <span class="op">=</span> <span class="dv">1</span> <span class="op">/</span> (alpha_gen <span class="op">*</span> (<span class="dv">1</span> <span class="op">-</span> s_line))</span>
<span id="cb41-60"><a href="#cb41-60" aria-hidden="true" tabindex="-1"></a>ax5.plot(s_line, eta_line, <span class="st">'k--'</span>, alpha<span class="op">=</span><span class="fl">0.5</span>, label<span class="op">=</span><span class="st">'η = 1/(α(1-s))'</span>)</span>
<span id="cb41-61"><a href="#cb41-61" aria-hidden="true" tabindex="-1"></a>ax5.set_xlabel(<span class="st">'Market Share (s)'</span>)</span>
<span id="cb41-62"><a href="#cb41-62" aria-hidden="true" tabindex="-1"></a>ax5.set_ylabel(<span class="st">'Markup (η)'</span>)</span>
<span id="cb41-63"><a href="#cb41-63" aria-hidden="true" tabindex="-1"></a>ax5.set_title(<span class="st">'E. Share vs Markup'</span>)</span>
<span id="cb41-64"><a href="#cb41-64" aria-hidden="true" tabindex="-1"></a>ax5.legend()</span>
<span id="cb41-65"><a href="#cb41-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-66"><a href="#cb41-66" aria-hidden="true" tabindex="-1"></a><span class="co"># Panel F: Profit analysis (share × markup)</span></span>
<span id="cb41-67"><a href="#cb41-67" aria-hidden="true" tabindex="-1"></a>profit_share <span class="op">=</span> result_gen.shares <span class="op">*</span> result_gen.markups  <span class="co"># Proportional to profit</span></span>
<span id="cb41-68"><a href="#cb41-68" aria-hidden="true" tabindex="-1"></a>bars6 <span class="op">=</span> ax6.bar(x, profit_share, color<span class="op">=</span>colors_gen, alpha<span class="op">=</span><span class="fl">0.8</span>, edgecolor<span class="op">=</span><span class="st">'black'</span>)</span>
<span id="cb41-69"><a href="#cb41-69" aria-hidden="true" tabindex="-1"></a>ax6.set_ylabel(<span class="st">'Share × Markup (∝ Profit)'</span>)</span>
<span id="cb41-70"><a href="#cb41-70" aria-hidden="true" tabindex="-1"></a>ax6.set_title(<span class="st">'F. Relative Profitability'</span>)</span>
<span id="cb41-71"><a href="#cb41-71" aria-hidden="true" tabindex="-1"></a>ax6.set_xticks(x)</span>
<span id="cb41-72"><a href="#cb41-72" aria-hidden="true" tabindex="-1"></a>ax6.set_xticklabels([<span class="st">'Dominant'</span>, <span class="st">'Weak'</span>, <span class="st">'Average'</span>])</span>
<span id="cb41-73"><a href="#cb41-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-74"><a href="#cb41-74" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb41-75"><a href="#cb41-75" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb41-76"><a href="#cb41-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-77"><a href="#cb41-77" aria-hidden="true" tabindex="-1"></a><span class="co"># Summary analysis</span></span>
<span id="cb41-78"><a href="#cb41-78" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Product Positioning Analysis:"</span>)</span>
<span id="cb41-79"><a href="#cb41-79" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"-"</span> <span class="op">*</span> <span class="dv">60</span>)</span>
<span id="cb41-80"><a href="#cb41-80" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span><span class="st">'Product'</span><span class="sc">:&lt;12}</span><span class="ss"> </span><span class="sc">{</span><span class="st">'Position'</span><span class="sc">:&lt;35}</span><span class="ss"> </span><span class="sc">{</span><span class="st">'Profit Rank'</span><span class="sc">:&lt;15}</span><span class="ss">"</span>)</span>
<span id="cb41-81"><a href="#cb41-81" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"-"</span> <span class="op">*</span> <span class="dv">60</span>)</span>
<span id="cb41-82"><a href="#cb41-82" aria-hidden="true" tabindex="-1"></a>profit_ranks <span class="op">=</span> np.argsort(result_gen.shares <span class="op">*</span> result_gen.markups)[::<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb41-83"><a href="#cb41-83" aria-hidden="true" tabindex="-1"></a>positions <span class="op">=</span> [</span>
<span id="cb41-84"><a href="#cb41-84" aria-hidden="true" tabindex="-1"></a>    <span class="st">'High δ, Low c → Best of both worlds'</span>,</span>
<span id="cb41-85"><a href="#cb41-85" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Low δ, High c → Worst of both worlds'</span>,</span>
<span id="cb41-86"><a href="#cb41-86" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Med δ, Med c → Middle ground'</span></span>
<span id="cb41-87"><a href="#cb41-87" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb41-88"><a href="#cb41-88" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> rank, j <span class="kw">in</span> <span class="bu">enumerate</span>(profit_ranks):</span>
<span id="cb41-89"><a href="#cb41-89" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>labels_gen[j]<span class="sc">:&lt;12}</span><span class="ss"> </span><span class="sc">{</span>positions[j]<span class="sc">:&lt;35}</span><span class="ss"> #</span><span class="sc">{</span>rank<span class="op">+</span><span class="dv">1</span><span class="sc">:&lt;15}</span><span class="ss">"</span>)</span>
<span id="cb41-90"><a href="#cb41-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-91"><a href="#cb41-91" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>()</span>
<span id="cb41-92"><a href="#cb41-92" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Key Insights:"</span>)</span>
<span id="cb41-93"><a href="#cb41-93" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"• Dominant product (high quality, low cost) captures largest share AND highest markup"</span>)</span>
<span id="cb41-94"><a href="#cb41-94" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"• Weak product (low quality, high cost) struggles: low share, low markup"</span>)</span>
<span id="cb41-95"><a href="#cb41-95" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"• Product positioning (δ, c) determines competitive success"</span>)</span>
<span id="cb41-96"><a href="#cb41-96" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"• No simple ordering when quality and cost vary independently"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>/var/folders/d3/gbc4lhx97wnfr46nrykcgcym0000gn/T/ipykernel_46947/1559422546.py:74: UserWarning: Glyph 8733 (\N{PROPORTIONAL TO}) missing from font(s) Arial.
  plt.tight_layout()
/Users/kissshot894/Documents/HKUST/RA/AI_Practice/.venv/lib/python3.12/site-packages/IPython/core/pylabtools.py:170: UserWarning: Glyph 8733 (\N{PROPORTIONAL TO}) missing from font(s) Arial.
  fig.canvas.print_figure(bytes_io, **kw)</code></pre>
</div>
<div class="cell-output cell-output-display">
<div id="general-heterogeneous-figure" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="solve_opm_files/figure-html/general-heterogeneous-figure-output-2.png" width="1523" height="754" class="figure-img"></p>
<figcaption>General Heterogeneous Products: Dominant vs Weak vs Average Positioning</figcaption>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
Product Positioning Analysis:
------------------------------------------------------------
Product      Position                            Profit Rank    
------------------------------------------------------------
Dominant     High δ, Low c → Best of both worlds #1              
Average      Med δ, Med c → Middle ground        #2              
Weak         Low δ, High c → Worst of both worlds #3              

Key Insights:
• Dominant product (high quality, low cost) captures largest share AND highest markup
• Weak product (low quality, high cost) struggles: low share, low markup
• Product positioning (δ, c) determines competitive success
• No simple ordering when quality and cost vary independently</code></pre>
</div>
</div>
<div id="scenario-comparison" class="cell" data-execution_count="19">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare equilibrium outcomes across scenarios</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">80</span>)</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"SUMMARY: COMPARING ALL DIFFERENTIATION SCENARIOS"</span>)</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">80</span>)</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>()</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Collect results</span></span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>scenarios <span class="op">=</span> {</span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Symmetric (Baseline)'</span>: {</span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a>        <span class="st">'delta'</span>: delta, <span class="st">'costs'</span>: costs,</span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a>        <span class="st">'result'</span>: result</span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Quality Only (Sc.2)'</span>: {</span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a>        <span class="st">'delta'</span>: delta_quality, <span class="st">'costs'</span>: costs_quality,</span>
<span id="cb44-15"><a href="#cb44-15" aria-hidden="true" tabindex="-1"></a>        <span class="st">'result'</span>: result_quality</span>
<span id="cb44-16"><a href="#cb44-16" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb44-17"><a href="#cb44-17" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Cost Only (Sc.3)'</span>: {</span>
<span id="cb44-18"><a href="#cb44-18" aria-hidden="true" tabindex="-1"></a>        <span class="st">'delta'</span>: delta_cost, <span class="st">'costs'</span>: costs_cost,</span>
<span id="cb44-19"><a href="#cb44-19" aria-hidden="true" tabindex="-1"></a>        <span class="st">'result'</span>: result_cost</span>
<span id="cb44-20"><a href="#cb44-20" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb44-21"><a href="#cb44-21" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Vertical (Sc.4)'</span>: {</span>
<span id="cb44-22"><a href="#cb44-22" aria-hidden="true" tabindex="-1"></a>        <span class="st">'delta'</span>: delta_vert, <span class="st">'costs'</span>: costs_vert,</span>
<span id="cb44-23"><a href="#cb44-23" aria-hidden="true" tabindex="-1"></a>        <span class="st">'result'</span>: result_vert</span>
<span id="cb44-24"><a href="#cb44-24" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb44-25"><a href="#cb44-25" aria-hidden="true" tabindex="-1"></a>    <span class="st">'General (Sc.5)'</span>: {</span>
<span id="cb44-26"><a href="#cb44-26" aria-hidden="true" tabindex="-1"></a>        <span class="st">'delta'</span>: delta_gen, <span class="st">'costs'</span>: costs_gen,</span>
<span id="cb44-27"><a href="#cb44-27" aria-hidden="true" tabindex="-1"></a>        <span class="st">'result'</span>: result_gen</span>
<span id="cb44-28"><a href="#cb44-28" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb44-29"><a href="#cb44-29" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb44-30"><a href="#cb44-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-31"><a href="#cb44-31" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span><span class="st">'Scenario'</span><span class="sc">:&lt;25}</span><span class="ss"> </span><span class="sc">{</span><span class="st">'δ range'</span><span class="sc">:&lt;15}</span><span class="ss"> </span><span class="sc">{</span><span class="st">'c range'</span><span class="sc">:&lt;15}</span><span class="ss"> </span><span class="sc">{</span><span class="st">'Price range'</span><span class="sc">:&lt;15}</span><span class="ss"> </span><span class="sc">{</span><span class="st">'Share range'</span><span class="sc">:&lt;15}</span><span class="ss"> </span><span class="sc">{</span><span class="st">'HHI'</span><span class="sc">:&lt;10}</span><span class="ss">"</span>)</span>
<span id="cb44-32"><a href="#cb44-32" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"-"</span> <span class="op">*</span> <span class="dv">95</span>)</span>
<span id="cb44-33"><a href="#cb44-33" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> name, data <span class="kw">in</span> scenarios.items():</span>
<span id="cb44-34"><a href="#cb44-34" aria-hidden="true" tabindex="-1"></a>    d_range <span class="op">=</span> <span class="ss">f"[</span><span class="sc">{</span><span class="bu">min</span>(data[<span class="st">'delta'</span>])<span class="sc">:.1f}</span><span class="ss">, </span><span class="sc">{</span><span class="bu">max</span>(data[<span class="st">'delta'</span>])<span class="sc">:.1f}</span><span class="ss">]"</span></span>
<span id="cb44-35"><a href="#cb44-35" aria-hidden="true" tabindex="-1"></a>    c_range <span class="op">=</span> <span class="ss">f"[</span><span class="sc">{</span><span class="bu">min</span>(data[<span class="st">'costs'</span>])<span class="sc">:.1f}</span><span class="ss">, </span><span class="sc">{</span><span class="bu">max</span>(data[<span class="st">'costs'</span>])<span class="sc">:.1f}</span><span class="ss">]"</span></span>
<span id="cb44-36"><a href="#cb44-36" aria-hidden="true" tabindex="-1"></a>    p_range <span class="op">=</span> <span class="ss">f"[</span><span class="sc">{</span><span class="bu">min</span>(data[<span class="st">'result'</span>].prices)<span class="sc">:.2f}</span><span class="ss">, </span><span class="sc">{</span><span class="bu">max</span>(data[<span class="st">'result'</span>].prices)<span class="sc">:.2f}</span><span class="ss">]"</span></span>
<span id="cb44-37"><a href="#cb44-37" aria-hidden="true" tabindex="-1"></a>    s_range <span class="op">=</span> <span class="ss">f"[</span><span class="sc">{</span><span class="bu">min</span>(data[<span class="st">'result'</span>].shares)<span class="sc">:.3f}</span><span class="ss">, </span><span class="sc">{</span><span class="bu">max</span>(data[<span class="st">'result'</span>].shares)<span class="sc">:.3f}</span><span class="ss">]"</span></span>
<span id="cb44-38"><a href="#cb44-38" aria-hidden="true" tabindex="-1"></a>    hhi <span class="op">=</span> np.<span class="bu">sum</span>(data[<span class="st">'result'</span>].shares<span class="op">**</span><span class="dv">2</span>) <span class="op">*</span> <span class="dv">10000</span></span>
<span id="cb44-39"><a href="#cb44-39" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>name<span class="sc">:&lt;25}</span><span class="ss"> </span><span class="sc">{</span>d_range<span class="sc">:&lt;15}</span><span class="ss"> </span><span class="sc">{</span>c_range<span class="sc">:&lt;15}</span><span class="ss"> </span><span class="sc">{</span>p_range<span class="sc">:&lt;15}</span><span class="ss"> </span><span class="sc">{</span>s_range<span class="sc">:&lt;15}</span><span class="ss"> </span><span class="sc">{</span>hhi<span class="sc">:&lt;10.0f}</span><span class="ss">"</span>)</span>
<span id="cb44-40"><a href="#cb44-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-41"><a href="#cb44-41" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>()</span>
<span id="cb44-42"><a href="#cb44-42" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Observations:"</span>)</span>
<span id="cb44-43"><a href="#cb44-43" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"• Symmetric: All products identical → equal prices, shares, markups"</span>)</span>
<span id="cb44-44"><a href="#cb44-44" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"• Quality Only: Price dispersion driven by markup differences"</span>)</span>
<span id="cb44-45"><a href="#cb44-45" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"• Cost Only: Price dispersion driven by cost differences"</span>)</span>
<span id="cb44-46"><a href="#cb44-46" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"• Vertical: Price dispersion from both cost AND markup differences"</span>)</span>
<span id="cb44-47"><a href="#cb44-47" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"• General: Complex interactions; dominant positioning wins"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>================================================================================
SUMMARY: COMPARING ALL DIFFERENTIATION SCENARIOS
================================================================================

Scenario                  δ range         c range         Price range     Share range     HHI       
-----------------------------------------------------------------------------------------------
Symmetric (Baseline)      [1.0, 1.0]      [0.5, 0.5]      [1.74, 1.74]    [0.196, 0.196]  1152      
Quality Only (Sc.2)       [0.5, 2.0]      [0.5, 0.5]      [1.63, 2.03]    [0.116, 0.348]  1656      
Cost Only (Sc.3)          [1.0, 1.0]      [0.3, 0.7]      [1.59, 1.90]    [0.167, 0.227]  1175      
Vertical (Sc.4)           [0.5, 2.0]      [0.3, 0.8]      [1.47, 2.23]    [0.143, 0.299]  1432      
General (Sc.5)            [0.5, 2.0]      [0.3, 0.7]      [1.71, 1.92]    [0.095, 0.381]  1843      

Observations:
• Symmetric: All products identical → equal prices, shares, markups
• Quality Only: Price dispersion driven by markup differences
• Cost Only: Price dispersion driven by cost differences
• Vertical: Price dispersion from both cost AND markup differences
• General: Complex interactions; dominant positioning wins</code></pre>
</div>
</div>
</section>
</section>
<section id="diagnosis-evaluation-against-io-theory" class="level2">
<h2 class="anchored" data-anchor-id="diagnosis-evaluation-against-io-theory">Diagnosis: Evaluation Against IO Theory</h2>
<p>This section evaluates the numerical results against established Industrial Organization theory and economic intuition.</p>
<div id="diagnosis-markup-formula" class="cell" data-execution_count="20">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">80</span>)</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"DIAGNOSIS 1: MARKUP FORMULA VERIFICATION"</span>)</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">80</span>)</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>()</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Theoretical Prediction (Logit Demand, Single-Product Firms):"</span>)</span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"  Markup: η_j = 1 / [α(1 - s_j)]"</span>)</span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"  → Lerner Index: L_j = η_j/p_j = 1 / [α(1 - s_j)p_j]"</span>)</span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>()</span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Verification across all scenarios:"</span>)</span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"-"</span> <span class="op">*</span> <span class="dv">80</span>)</span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span><span class="st">'Scenario'</span><span class="sc">:&lt;25}</span><span class="ss"> </span><span class="sc">{</span><span class="st">'Max |η - η_theory|'</span><span class="sc">:&lt;20}</span><span class="ss"> </span><span class="sc">{</span><span class="st">'Status'</span><span class="sc">:&lt;15}</span><span class="ss">"</span>)</span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"-"</span> <span class="op">*</span> <span class="dv">80</span>)</span>
<span id="cb46-13"><a href="#cb46-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-14"><a href="#cb46-14" aria-hidden="true" tabindex="-1"></a>all_pass <span class="op">=</span> <span class="va">True</span></span>
<span id="cb46-15"><a href="#cb46-15" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> name, data <span class="kw">in</span> scenarios.items():</span>
<span id="cb46-16"><a href="#cb46-16" aria-hidden="true" tabindex="-1"></a>    res <span class="op">=</span> data[<span class="st">'result'</span>]</span>
<span id="cb46-17"><a href="#cb46-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Skip scenarios with non-diagonal ownership</span></span>
<span id="cb46-18"><a href="#cb46-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> name <span class="op">==</span> <span class="st">'Symmetric (Baseline)'</span>:</span>
<span id="cb46-19"><a href="#cb46-19" aria-hidden="true" tabindex="-1"></a>        alpha_used <span class="op">=</span> alpha</span>
<span id="cb46-20"><a href="#cb46-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb46-21"><a href="#cb46-21" aria-hidden="true" tabindex="-1"></a>        alpha_used <span class="op">=</span> <span class="fl">1.0</span></span>
<span id="cb46-22"><a href="#cb46-22" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb46-23"><a href="#cb46-23" aria-hidden="true" tabindex="-1"></a>    eta_theory <span class="op">=</span> <span class="dv">1</span> <span class="op">/</span> (alpha_used <span class="op">*</span> (<span class="dv">1</span> <span class="op">-</span> res.shares))</span>
<span id="cb46-24"><a href="#cb46-24" aria-hidden="true" tabindex="-1"></a>    max_error <span class="op">=</span> np.<span class="bu">max</span>(np.<span class="bu">abs</span>(res.markups <span class="op">-</span> eta_theory))</span>
<span id="cb46-25"><a href="#cb46-25" aria-hidden="true" tabindex="-1"></a>    status <span class="op">=</span> <span class="st">'✓ PASS'</span> <span class="cf">if</span> max_error <span class="op">&lt;</span> <span class="fl">1e-6</span> <span class="cf">else</span> <span class="st">'✗ FAIL'</span></span>
<span id="cb46-26"><a href="#cb46-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> max_error <span class="op">&gt;=</span> <span class="fl">1e-6</span>:</span>
<span id="cb46-27"><a href="#cb46-27" aria-hidden="true" tabindex="-1"></a>        all_pass <span class="op">=</span> <span class="va">False</span></span>
<span id="cb46-28"><a href="#cb46-28" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>name<span class="sc">:&lt;25}</span><span class="ss"> </span><span class="sc">{</span>max_error<span class="sc">:&lt;20.2e}</span><span class="ss"> </span><span class="sc">{</span>status<span class="sc">:&lt;15}</span><span class="ss">"</span>)</span>
<span id="cb46-29"><a href="#cb46-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-30"><a href="#cb46-30" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"-"</span> <span class="op">*</span> <span class="dv">80</span>)</span>
<span id="cb46-31"><a href="#cb46-31" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Overall: </span><span class="sc">{</span><span class="st">'✓ All scenarios match theory'</span> <span class="cf">if</span> all_pass <span class="cf">else</span> <span class="st">'✗ Some scenarios fail'</span><span class="sc">}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>================================================================================
DIAGNOSIS 1: MARKUP FORMULA VERIFICATION
================================================================================

Theoretical Prediction (Logit Demand, Single-Product Firms):
  Markup: η_j = 1 / [α(1 - s_j)]
  → Lerner Index: L_j = η_j/p_j = 1 / [α(1 - s_j)p_j]

Verification across all scenarios:
--------------------------------------------------------------------------------
Scenario                  Max |η - η_theory|   Status         
--------------------------------------------------------------------------------
Symmetric (Baseline)      2.27e-12             ✓ PASS         
Quality Only (Sc.2)       4.35e-11             ✓ PASS         
Cost Only (Sc.3)          2.21e-11             ✓ PASS         
Vertical (Sc.4)           3.82e-11             ✓ PASS         
General (Sc.5)            5.18e-11             ✓ PASS         
--------------------------------------------------------------------------------
Overall: ✓ All scenarios match theory</code></pre>
</div>
</div>
<div id="diagnosis-comparative-statics" class="cell" data-execution_count="21">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>()</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">80</span>)</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"DIAGNOSIS 2: COMPARATIVE STATICS CONSISTENCY"</span>)</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">80</span>)</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>()</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Theoretical Predictions from IO Literature:"</span>)</span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>()</span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Test 1: Higher α → lower markups</span></span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Test 1: ∂η/∂α &lt; 0 (Higher price sensitivity → lower markups)"</span>)</span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a>alpha_test_vals <span class="op">=</span> [<span class="fl">0.5</span>, <span class="fl">1.0</span>, <span class="fl">2.0</span>]</span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a>markups_by_alpha <span class="op">=</span> []</span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> a <span class="kw">in</span> alpha_test_vals:</span>
<span id="cb48-14"><a href="#cb48-14" aria-hidden="true" tabindex="-1"></a>    res <span class="op">=</span> solve_equilibrium_prices(delta, a, costs, ownership)</span>
<span id="cb48-15"><a href="#cb48-15" aria-hidden="true" tabindex="-1"></a>    markups_by_alpha.append(np.mean(res.markups))</span>
<span id="cb48-16"><a href="#cb48-16" aria-hidden="true" tabindex="-1"></a>decreasing <span class="op">=</span> <span class="bu">all</span>(markups_by_alpha[i] <span class="op">&gt;</span> markups_by_alpha[i<span class="op">+</span><span class="dv">1</span>] <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(markups_by_alpha)<span class="op">-</span><span class="dv">1</span>))</span>
<span id="cb48-17"><a href="#cb48-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  α = </span><span class="sc">{</span>alpha_test_vals<span class="sc">}</span><span class="ss"> → η = </span><span class="sc">{</span>[<span class="ss">f'</span><span class="sc">{</span>m<span class="sc">:.3f}</span><span class="ss">'</span> <span class="cf">for</span> m <span class="kw">in</span> markups_by_alpha]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb48-18"><a href="#cb48-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Monotonically decreasing: </span><span class="sc">{</span><span class="st">'✓ YES'</span> <span class="cf">if</span> decreasing <span class="cf">else</span> <span class="st">'✗ NO'</span><span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb48-19"><a href="#cb48-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>()</span>
<span id="cb48-20"><a href="#cb48-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-21"><a href="#cb48-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Test 2: More competitors → lower markups</span></span>
<span id="cb48-22"><a href="#cb48-22" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Test 2: ∂η/∂J &lt; 0 (More competitors → lower markups)"</span>)</span>
<span id="cb48-23"><a href="#cb48-23" aria-hidden="true" tabindex="-1"></a>J_test_vals <span class="op">=</span> [<span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">10</span>]</span>
<span id="cb48-24"><a href="#cb48-24" aria-hidden="true" tabindex="-1"></a>markups_by_J <span class="op">=</span> []</span>
<span id="cb48-25"><a href="#cb48-25" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> J_t <span class="kw">in</span> J_test_vals:</span>
<span id="cb48-26"><a href="#cb48-26" aria-hidden="true" tabindex="-1"></a>    res <span class="op">=</span> solve_equilibrium_prices(np.ones(J_t), <span class="fl">1.0</span>, np.ones(J_t)<span class="op">*</span><span class="fl">0.5</span>, np.eye(J_t))</span>
<span id="cb48-27"><a href="#cb48-27" aria-hidden="true" tabindex="-1"></a>    markups_by_J.append(np.mean(res.markups))</span>
<span id="cb48-28"><a href="#cb48-28" aria-hidden="true" tabindex="-1"></a>decreasing_J <span class="op">=</span> <span class="bu">all</span>(markups_by_J[i] <span class="op">&gt;</span> markups_by_J[i<span class="op">+</span><span class="dv">1</span>] <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(markups_by_J)<span class="op">-</span><span class="dv">1</span>))</span>
<span id="cb48-29"><a href="#cb48-29" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  J = </span><span class="sc">{</span>J_test_vals<span class="sc">}</span><span class="ss"> → η = </span><span class="sc">{</span>[<span class="ss">f'</span><span class="sc">{</span>m<span class="sc">:.3f}</span><span class="ss">'</span> <span class="cf">for</span> m <span class="kw">in</span> markups_by_J]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb48-30"><a href="#cb48-30" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Monotonically decreasing: </span><span class="sc">{</span><span class="st">'✓ YES'</span> <span class="cf">if</span> decreasing_J <span class="cf">else</span> <span class="st">'✗ NO'</span><span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb48-31"><a href="#cb48-31" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>()</span>
<span id="cb48-32"><a href="#cb48-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-33"><a href="#cb48-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Test 3: Competitive limit</span></span>
<span id="cb48-34"><a href="#cb48-34" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Test 3: lim(J→∞) η = 1/α (Competitive limit)"</span>)</span>
<span id="cb48-35"><a href="#cb48-35" aria-hidden="true" tabindex="-1"></a>J_large <span class="op">=</span> <span class="dv">50</span></span>
<span id="cb48-36"><a href="#cb48-36" aria-hidden="true" tabindex="-1"></a>res_large <span class="op">=</span> solve_equilibrium_prices(np.ones(J_large), <span class="fl">1.0</span>, np.ones(J_large)<span class="op">*</span><span class="fl">0.5</span>, np.eye(J_large))</span>
<span id="cb48-37"><a href="#cb48-37" aria-hidden="true" tabindex="-1"></a>eta_limit <span class="op">=</span> np.mean(res_large.markups)</span>
<span id="cb48-38"><a href="#cb48-38" aria-hidden="true" tabindex="-1"></a>eta_theory_limit <span class="op">=</span> <span class="fl">1.0</span>  <span class="co"># 1/α with α=1</span></span>
<span id="cb48-39"><a href="#cb48-39" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  J = </span><span class="sc">{</span>J_large<span class="sc">}</span><span class="ss">: η = </span><span class="sc">{</span>eta_limit<span class="sc">:.4f}</span><span class="ss">, theory = 1/α = </span><span class="sc">{</span>eta_theory_limit<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb48-40"><a href="#cb48-40" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Close to limit: </span><span class="sc">{</span><span class="st">'✓ YES'</span> <span class="cf">if</span> <span class="bu">abs</span>(eta_limit <span class="op">-</span> eta_theory_limit) <span class="op">&lt;</span> <span class="fl">0.1</span> <span class="cf">else</span> <span class="st">'✗ NO'</span><span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb48-41"><a href="#cb48-41" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>()</span>
<span id="cb48-42"><a href="#cb48-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-43"><a href="#cb48-43" aria-hidden="true" tabindex="-1"></a><span class="co"># Test 4: Merger increases prices</span></span>
<span id="cb48-44"><a href="#cb48-44" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Test 4: Merger → higher prices (Internalization of cannibalization)"</span>)</span>
<span id="cb48-45"><a href="#cb48-45" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Pre-merger prices:  </span><span class="sc">{</span>result_pre<span class="sc">.</span>prices<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb48-46"><a href="#cb48-46" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Post-merger prices: </span><span class="sc">{</span>result_post<span class="sc">.</span>prices<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb48-47"><a href="#cb48-47" aria-hidden="true" tabindex="-1"></a>prices_increased <span class="op">=</span> <span class="bu">all</span>(result_post.prices <span class="op">&gt;=</span> result_pre.prices <span class="op">-</span> <span class="fl">1e-6</span>)</span>
<span id="cb48-48"><a href="#cb48-48" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  All prices weakly increase: </span><span class="sc">{</span><span class="st">'✓ YES'</span> <span class="cf">if</span> prices_increased <span class="cf">else</span> <span class="st">'✗ NO'</span><span class="sc">}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
================================================================================
DIAGNOSIS 2: COMPARATIVE STATICS CONSISTENCY
================================================================================

Theoretical Predictions from IO Literature:

Test 1: ∂η/∂α &lt; 0 (Higher price sensitivity → lower markups)
  α = [0.5, 1.0, 2.0] → η = ['2.543', '1.244', '0.595']
  Monotonically decreasing: ✓ YES

Test 2: ∂η/∂J &lt; 0 (More competitors → lower markups)
  J = [2, 5, 10] → η = ['1.308', '1.168', '1.093']
  Monotonically decreasing: ✓ YES

Test 3: lim(J→∞) η = 1/α (Competitive limit)
  J = 50: η = 1.0197, theory = 1/α = 1.0000
  Close to limit: ✓ YES

Test 4: Merger → higher prices (Internalization of cannibalization)
  Pre-merger prices:  [1.74368421 1.74368421 1.74368421]
  Post-merger prices: [2.00167899 2.00167899 1.76758492]
  All prices weakly increase: ✓ YES</code></pre>
</div>
</div>
<div id="diagnosis-economic-intuition" class="cell" data-execution_count="22">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>()</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">80</span>)</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"DIAGNOSIS 3: ECONOMIC INTUITION CHECKS"</span>)</span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">80</span>)</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>()</span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Intuition 1: Quality Premium</span></span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Intuition 1: Higher quality → higher price (Quality Premium)"</span>)</span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"  Scenario 2 (Quality Only):"</span>)</span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> j, label <span class="kw">in</span> <span class="bu">enumerate</span>([<span class="st">'Low'</span>, <span class="st">'Medium'</span>, <span class="st">'High'</span>]):</span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"    </span><span class="sc">{</span>label<span class="sc">}</span><span class="ss"> quality (δ=</span><span class="sc">{</span>delta_quality[j]<span class="sc">}</span><span class="ss">): p = </span><span class="sc">{</span>result_quality<span class="sc">.</span>prices[j]<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a>quality_premium <span class="op">=</span> result_quality.prices[<span class="dv">2</span>] <span class="op">&gt;</span> result_quality.prices[<span class="dv">1</span>] <span class="op">&gt;</span> result_quality.prices[<span class="dv">0</span>]</span>
<span id="cb50-13"><a href="#cb50-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Price ordering matches quality ordering: </span><span class="sc">{</span><span class="st">'✓ YES'</span> <span class="cf">if</span> quality_premium <span class="cf">else</span> <span class="st">'✗ NO'</span><span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb50-14"><a href="#cb50-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>()</span>
<span id="cb50-15"><a href="#cb50-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-16"><a href="#cb50-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Intuition 2: Cost Pass-Through &lt; 100%</span></span>
<span id="cb50-17"><a href="#cb50-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Intuition 2: Cost pass-through &lt; 100% (Firms absorb some cost changes)"</span>)</span>
<span id="cb50-18"><a href="#cb50-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"  Scenario 3 (Cost Only):"</span>)</span>
<span id="cb50-19"><a href="#cb50-19" aria-hidden="true" tabindex="-1"></a>cost_diff <span class="op">=</span> costs_cost[<span class="dv">2</span>] <span class="op">-</span> costs_cost[<span class="dv">0</span>]</span>
<span id="cb50-20"><a href="#cb50-20" aria-hidden="true" tabindex="-1"></a>price_diff <span class="op">=</span> result_cost.prices[<span class="dv">2</span>] <span class="op">-</span> result_cost.prices[<span class="dv">0</span>]</span>
<span id="cb50-21"><a href="#cb50-21" aria-hidden="true" tabindex="-1"></a>passthrough <span class="op">=</span> price_diff <span class="op">/</span> cost_diff</span>
<span id="cb50-22"><a href="#cb50-22" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"    Cost difference (Inefficient - Efficient): </span><span class="sc">{</span>cost_diff<span class="sc">:.2f}</span><span class="ss">"</span>)</span>
<span id="cb50-23"><a href="#cb50-23" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"    Price difference: </span><span class="sc">{</span>price_diff<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb50-24"><a href="#cb50-24" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"    Implied pass-through: </span><span class="sc">{</span>passthrough<span class="sc">:.2%}</span><span class="ss">"</span>)</span>
<span id="cb50-25"><a href="#cb50-25" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Pass-through &lt; 100%: </span><span class="sc">{</span><span class="st">'✓ YES'</span> <span class="cf">if</span> passthrough <span class="op">&lt;</span> <span class="dv">1</span> <span class="cf">else</span> <span class="st">'✗ NO'</span><span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb50-26"><a href="#cb50-26" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>()</span>
<span id="cb50-27"><a href="#cb50-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-28"><a href="#cb50-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Intuition 3: Vertical differentiation price gap &gt; cost gap</span></span>
<span id="cb50-29"><a href="#cb50-29" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Intuition 3: Premium price gap &gt; cost gap (Premium markup effect)"</span>)</span>
<span id="cb50-30"><a href="#cb50-30" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"  Scenario 4 (Vertical):"</span>)</span>
<span id="cb50-31"><a href="#cb50-31" aria-hidden="true" tabindex="-1"></a>cost_gap_vert <span class="op">=</span> costs_vert[<span class="dv">2</span>] <span class="op">-</span> costs_vert[<span class="dv">0</span>]</span>
<span id="cb50-32"><a href="#cb50-32" aria-hidden="true" tabindex="-1"></a>price_gap_vert <span class="op">=</span> result_vert.prices[<span class="dv">2</span>] <span class="op">-</span> result_vert.prices[<span class="dv">0</span>]</span>
<span id="cb50-33"><a href="#cb50-33" aria-hidden="true" tabindex="-1"></a>markup_gap_vert <span class="op">=</span> result_vert.markups[<span class="dv">2</span>] <span class="op">-</span> result_vert.markups[<span class="dv">0</span>]</span>
<span id="cb50-34"><a href="#cb50-34" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"    Cost gap (Premium - Economy): </span><span class="sc">{</span>cost_gap_vert<span class="sc">:.2f}</span><span class="ss">"</span>)</span>
<span id="cb50-35"><a href="#cb50-35" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"    Price gap: </span><span class="sc">{</span>price_gap_vert<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb50-36"><a href="#cb50-36" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"    Markup gap: </span><span class="sc">{</span>markup_gap_vert<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb50-37"><a href="#cb50-37" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Price gap &gt; Cost gap: </span><span class="sc">{</span><span class="st">'✓ YES'</span> <span class="cf">if</span> price_gap_vert <span class="op">&gt;</span> cost_gap_vert <span class="cf">else</span> <span class="st">'✗ NO'</span><span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb50-38"><a href="#cb50-38" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>()</span>
<span id="cb50-39"><a href="#cb50-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-40"><a href="#cb50-40" aria-hidden="true" tabindex="-1"></a><span class="co"># Intuition 4: Dominant firm has highest profit</span></span>
<span id="cb50-41"><a href="#cb50-41" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Intuition 4: Dominant positioning (high δ, low c) → highest profit"</span>)</span>
<span id="cb50-42"><a href="#cb50-42" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"  Scenario 5 (General):"</span>)</span>
<span id="cb50-43"><a href="#cb50-43" aria-hidden="true" tabindex="-1"></a>profits_gen <span class="op">=</span> result_gen.shares <span class="op">*</span> result_gen.markups</span>
<span id="cb50-44"><a href="#cb50-44" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> j, label <span class="kw">in</span> <span class="bu">enumerate</span>([<span class="st">'Dominant'</span>, <span class="st">'Weak'</span>, <span class="st">'Average'</span>]):</span>
<span id="cb50-45"><a href="#cb50-45" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"    </span><span class="sc">{</span>label<span class="sc">}</span><span class="ss">: δ=</span><span class="sc">{</span>delta_gen[j]<span class="sc">}</span><span class="ss">, c=</span><span class="sc">{</span>costs_gen[j]<span class="sc">}</span><span class="ss"> → profit ∝ </span><span class="sc">{</span>profits_gen[j]<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb50-46"><a href="#cb50-46" aria-hidden="true" tabindex="-1"></a>dominant_wins <span class="op">=</span> profits_gen[<span class="dv">0</span>] <span class="op">&gt;</span> profits_gen[<span class="dv">1</span>] <span class="kw">and</span> profits_gen[<span class="dv">0</span>] <span class="op">&gt;</span> profits_gen[<span class="dv">2</span>]</span>
<span id="cb50-47"><a href="#cb50-47" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Dominant has highest profit: </span><span class="sc">{</span><span class="st">'✓ YES'</span> <span class="cf">if</span> dominant_wins <span class="cf">else</span> <span class="st">'✗ NO'</span><span class="sc">}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
================================================================================
DIAGNOSIS 3: ECONOMIC INTUITION CHECKS
================================================================================

Intuition 1: Higher quality → higher price (Quality Premium)
  Scenario 2 (Quality Only):
    Low quality (δ=0.5): p = 1.6313
    Medium quality (δ=1.0): p = 1.7139
    High quality (δ=2.0): p = 2.0336
  Price ordering matches quality ordering: ✓ YES

Intuition 2: Cost pass-through &lt; 100% (Firms absorb some cost changes)
  Scenario 3 (Cost Only):
    Cost difference (Inefficient - Efficient): 0.40
    Price difference: 0.3069
    Implied pass-through: 76.72%
  Pass-through &lt; 100%: ✓ YES

Intuition 3: Premium price gap &gt; cost gap (Premium markup effect)
  Scenario 4 (Vertical):
    Cost gap (Premium - Economy): 0.50
    Price gap: 0.7604
    Markup gap: 0.2604
  Price gap &gt; Cost gap: ✓ YES

Intuition 4: Dominant positioning (high δ, low c) → highest profit
  Scenario 5 (General):
    Dominant: δ=2.0, c=0.3 → profit ∝ 0.6165
    Weak: δ=0.5, c=0.7 → profit ∝ 0.1051
    Average: δ=1.0, c=0.5 → profit ∝ 0.2087
  Dominant has highest profit: ✓ YES</code></pre>
</div>
</div>
<div id="diagnosis-summary" class="cell" data-execution_count="23">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>()</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">80</span>)</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"DIAGNOSIS SUMMARY: IO THEORY CONSISTENCY"</span>)</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">80</span>)</span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>()</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>checks <span class="op">=</span> [</span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"Markup formula η = 1/[α(1-s)]"</span>, all_pass),</span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"∂η/∂α &lt; 0 (price sensitivity)"</span>, decreasing),</span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"∂η/∂J &lt; 0 (competition)"</span>, decreasing_J),</span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"lim(J→∞) η → 1/α"</span>, <span class="bu">abs</span>(eta_limit <span class="op">-</span> eta_theory_limit) <span class="op">&lt;</span> <span class="fl">0.1</span>),</span>
<span id="cb52-12"><a href="#cb52-12" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"Merger raises prices"</span>, prices_increased),</span>
<span id="cb52-13"><a href="#cb52-13" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"Quality → Price premium"</span>, quality_premium),</span>
<span id="cb52-14"><a href="#cb52-14" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"Cost pass-through &lt; 100%"</span>, passthrough <span class="op">&lt;</span> <span class="dv">1</span>),</span>
<span id="cb52-15"><a href="#cb52-15" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"Premium price gap &gt; cost gap"</span>, price_gap_vert <span class="op">&gt;</span> cost_gap_vert),</span>
<span id="cb52-16"><a href="#cb52-16" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"Dominant firm highest profit"</span>, dominant_wins),</span>
<span id="cb52-17"><a href="#cb52-17" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb52-18"><a href="#cb52-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-19"><a href="#cb52-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span><span class="st">'Check'</span><span class="sc">:&lt;45}</span><span class="ss"> </span><span class="sc">{</span><span class="st">'Result'</span><span class="sc">:&lt;10}</span><span class="ss">"</span>)</span>
<span id="cb52-20"><a href="#cb52-20" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"-"</span> <span class="op">*</span> <span class="dv">55</span>)</span>
<span id="cb52-21"><a href="#cb52-21" aria-hidden="true" tabindex="-1"></a>passed <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb52-22"><a href="#cb52-22" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> check, result <span class="kw">in</span> checks:</span>
<span id="cb52-23"><a href="#cb52-23" aria-hidden="true" tabindex="-1"></a>    status <span class="op">=</span> <span class="st">'✓ PASS'</span> <span class="cf">if</span> result <span class="cf">else</span> <span class="st">'✗ FAIL'</span></span>
<span id="cb52-24"><a href="#cb52-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> result:</span>
<span id="cb52-25"><a href="#cb52-25" aria-hidden="true" tabindex="-1"></a>        passed <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb52-26"><a href="#cb52-26" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>check<span class="sc">:&lt;45}</span><span class="ss"> </span><span class="sc">{</span>status<span class="sc">:&lt;10}</span><span class="ss">"</span>)</span>
<span id="cb52-27"><a href="#cb52-27" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"-"</span> <span class="op">*</span> <span class="dv">55</span>)</span>
<span id="cb52-28"><a href="#cb52-28" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Total: </span><span class="sc">{</span>passed<span class="sc">}</span><span class="ss">/</span><span class="sc">{</span><span class="bu">len</span>(checks)<span class="sc">}</span><span class="ss"> checks passed"</span>)</span>
<span id="cb52-29"><a href="#cb52-29" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>()</span>
<span id="cb52-30"><a href="#cb52-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-31"><a href="#cb52-31" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> passed <span class="op">==</span> <span class="bu">len</span>(checks):</span>
<span id="cb52-32"><a href="#cb52-32" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"✓ ALL THEORETICAL PREDICTIONS VERIFIED"</span>)</span>
<span id="cb52-33"><a href="#cb52-33" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"  The solver correctly implements Bertrand-Nash equilibrium"</span>)</span>
<span id="cb52-34"><a href="#cb52-34" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"  with logit demand and produces results consistent with IO theory."</span>)</span>
<span id="cb52-35"><a href="#cb52-35" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb52-36"><a href="#cb52-36" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"⚠ SOME CHECKS FAILED - Review implementation"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
================================================================================
DIAGNOSIS SUMMARY: IO THEORY CONSISTENCY
================================================================================

Check                                         Result    
-------------------------------------------------------
Markup formula η = 1/[α(1-s)]                 ✓ PASS    
∂η/∂α &lt; 0 (price sensitivity)                 ✓ PASS    
∂η/∂J &lt; 0 (competition)                       ✓ PASS    
lim(J→∞) η → 1/α                              ✓ PASS    
Merger raises prices                          ✓ PASS    
Quality → Price premium                       ✓ PASS    
Cost pass-through &lt; 100%                      ✓ PASS    
Premium price gap &gt; cost gap                  ✓ PASS    
Dominant firm highest profit                  ✓ PASS    
-------------------------------------------------------
Total: 9/9 checks passed

✓ ALL THEORETICAL PREDICTIONS VERIFIED
  The solver correctly implements Bertrand-Nash equilibrium
  with logit demand and produces results consistent with IO theory.</code></pre>
</div>
</div>
<div id="diagnosis-references" class="cell" data-execution_count="24">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>()</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">80</span>)</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"THEORETICAL REFERENCES"</span>)</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">80</span>)</span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>()</span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Key Results Verified:"</span>)</span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>()</span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"1. Markup Formula (Berry, 1994; Nevo, 2001)"</span>)</span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"   η_j = 1/[α(1-s_j)] for single-product firms with logit demand"</span>)</span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"   Source: First-order condition of profit maximization"</span>)</span>
<span id="cb54-11"><a href="#cb54-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>()</span>
<span id="cb54-12"><a href="#cb54-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"2. Competitive Limit (Tirole, 1988)"</span>)</span>
<span id="cb54-13"><a href="#cb54-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"   As J → ∞, s_j → 0, so η_j → 1/α"</span>)</span>
<span id="cb54-14"><a href="#cb54-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"   Interpretation: Perfect competition eliminates market power"</span>)</span>
<span id="cb54-15"><a href="#cb54-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>()</span>
<span id="cb54-16"><a href="#cb54-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"3. Merger Effects (Werden &amp; Froeb, 1994)"</span>)</span>
<span id="cb54-17"><a href="#cb54-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"   Horizontal merger internalizes cannibalization between products"</span>)</span>
<span id="cb54-18"><a href="#cb54-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"   Results in higher prices for merged products and competitors"</span>)</span>
<span id="cb54-19"><a href="#cb54-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>()</span>
<span id="cb54-20"><a href="#cb54-20" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"4. Pass-Through (Weyl &amp; Fabinger, 2013)"</span>)</span>
<span id="cb54-21"><a href="#cb54-21" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"   With logit demand: ρ = 1 - s &lt; 1"</span>)</span>
<span id="cb54-22"><a href="#cb54-22" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"   Higher market share → lower pass-through (absorb more cost)"</span>)</span>
<span id="cb54-23"><a href="#cb54-23" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>()</span>
<span id="cb54-24"><a href="#cb54-24" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"5. Vertical Differentiation (Shaked &amp; Sutton, 1982)"</span>)</span>
<span id="cb54-25"><a href="#cb54-25" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"   Quality leaders charge premium beyond cost difference"</span>)</span>
<span id="cb54-26"><a href="#cb54-26" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"   Premium includes both cost and markup components"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
================================================================================
THEORETICAL REFERENCES
================================================================================

Key Results Verified:

1. Markup Formula (Berry, 1994; Nevo, 2001)
   η_j = 1/[α(1-s_j)] for single-product firms with logit demand
   Source: First-order condition of profit maximization

2. Competitive Limit (Tirole, 1988)
   As J → ∞, s_j → 0, so η_j → 1/α
   Interpretation: Perfect competition eliminates market power

3. Merger Effects (Werden &amp; Froeb, 1994)
   Horizontal merger internalizes cannibalization between products
   Results in higher prices for merged products and competitors

4. Pass-Through (Weyl &amp; Fabinger, 2013)
   With logit demand: ρ = 1 - s &lt; 1
   Higher market share → lower pass-through (absorb more cost)

5. Vertical Differentiation (Shaked &amp; Sutton, 1982)
   Quality leaders charge premium beyond cost difference
   Premium includes both cost and markup components</code></pre>
</div>
</div>
</section>
<section id="conclusion" class="level2">
<h2 class="anchored" data-anchor-id="conclusion">Conclusion</h2>
<div id="conclusion" class="cell" data-execution_count="25">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">50</span>)</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"SOLVER VALIDATION COMPLETE"</span>)</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">50</span>)</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>()</span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"✓ Equilibrium converged"</span>)</span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"✓ Markups match analytical formula: η = 1/(α(1-s))"</span>)</span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"✓ FOC residuals ≈ 0"</span>)</span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"✓ Comparative statics consistent with theory:"</span>)</span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"  - Higher α → lower markups"</span>)</span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"  - More competitors → lower markups"</span>)</span>
<span id="cb56-11"><a href="#cb56-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"  - Merger → higher prices for merged products"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>==================================================
SOLVER VALIDATION COMPLETE
==================================================

✓ Equilibrium converged
✓ Markups match analytical formula: η = 1/(α(1-s))
✓ FOC residuals ≈ 0
✓ Comparative statics consistent with theory:
  - Higher α → lower markups
  - More competitors → lower markups
  - Merger → higher prices for merged products</code></pre>
</div>
</div>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>